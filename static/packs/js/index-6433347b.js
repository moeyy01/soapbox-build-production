import{q as y,_ as e,a8 as i,G as u,K as w,af as L,c as Y,u as S,f as V,aB as X,eZ as ee,e_ as ae,e$ as te,r as b,f0 as se,p as oe,H as M,aI as x,dt as H,N as A,c9 as z,cB as ie,f1 as ne,f2 as $,f3 as ce,f4 as le,c8 as de,f5 as re,ak as R,al as v,f6 as p,f7 as F,c7 as q,f8 as ue,f9 as ge,n as D,C as P,c6 as me,fa as he,cA as k,b9 as B,d as fe,bF as j,fb as pe,a$ as W,am as G,ac as ve,fc as be,fd as Me,fe as _e,R as we,a1 as O,ff as ye,fg as T,fh as Ce}from"../index-961d4ed1.js";import{C as ke,a as xe,b as Ne,c as Se}from"./chat-search-input-5b40be23.js";import{u as K}from"./accounts-a5e55437.js";import{u as De}from"./useDebounce-0a090d55.js";import"./index-c72bc579.js";import"./mood-smile-6a052395.js";import"./lodash-d2d72341.js";import"./pull-to-refresh-b67e1521.js";const Ie=()=>{const s=y();return e(i,{space:6,alignItems:"center",justifyContent:"center",className:"h-full p-6"},void 0,e(i,{space:2,className:"max-w-sm"},void 0,e(u,{size:"2xl",weight:"bold",tag:"h2",align:"center"},void 0,e(w,{id:"chats.main.blankslate.title",defaultMessage:"No messages yet"})),e(u,{size:"sm",theme:"muted",align:"center"},void 0,e(w,{id:"chats.main.blankslate.subtitle",defaultMessage:"Search for someone to chat with"}))),e(L,{theme:"primary",onClick:()=>{s.push("/chats/new")}},void 0,e(w,{id:"chats.main.blankslate.new_chat",defaultMessage:"Message someone"})))},Re=()=>{const s=y();return e(i,{space:6,alignItems:"center",justifyContent:"center",className:"h-full p-6"},void 0,e(i,{space:2,className:"max-w-sm"},void 0,e(u,{size:"2xl",weight:"bold",tag:"h2",align:"center"},void 0,e(w,{id:"chats.main.blankslate_with_chats.title",defaultMessage:"Select a chat"})),e(u,{size:"sm",theme:"muted",align:"center"},void 0,e(w,{id:"chats.main.blankslate_with_chats.subtitle",defaultMessage:"Select from one of your open chats or create a new message."}))),e(L,{theme:"primary",onClick:()=>{s.push("/chats/new")}},void 0,e(w,{id:"chats.main.blankslate.new_chat",defaultMessage:"Message someone"})))},o=D({blockMessage:{id:"chat_settings.block.message",defaultMessage:"Blocking will prevent this profile from direct messaging you and viewing your content. You can unblock later."},blockHeading:{id:"chat_settings.block.heading",defaultMessage:"Block @{acct}"},blockConfirm:{id:"chat_settings.block.confirm",defaultMessage:"Block"},unblockMessage:{id:"chat_settings.unblock.message",defaultMessage:"Unblocking will allow this profile to direct message you and view your content."},unblockHeading:{id:"chat_settings.unblock.heading",defaultMessage:"Unblock @{acct}"},unblockConfirm:{id:"chat_settings.unblock.confirm",defaultMessage:"Unblock"},leaveMessage:{id:"chat_settings.leave.message",defaultMessage:"Are you sure you want to leave this chat? Messages will be deleted for you and this chat will be removed from your inbox."},leaveHeading:{id:"chat_settings.leave.heading",defaultMessage:"Leave Chat"},leaveConfirm:{id:"chat_settings.leave.confirm",defaultMessage:"Leave Chat"},blockUser:{id:"chat_settings.options.block_user",defaultMessage:"Block @{acct}"},unblockUser:{id:"chat_settings.options.unblock_user",defaultMessage:"Unblock @{acct}"},reportUser:{id:"chat_settings.options.report_user",defaultMessage:"Report @{acct}"},leaveChat:{id:"chat_settings.options.leave_chat",defaultMessage:"Leave Chat"},autoDeleteLabel:{id:"chat_settings.auto_delete.label",defaultMessage:"Auto-delete messages"},autoDeleteHint:{id:"chat_settings.auto_delete.hint",defaultMessage:"Sent messages will auto-delete after the time period selected"},autoDelete2Minutes:{id:"chat_settings.auto_delete.2minutes",defaultMessage:"2 minutes"},autoDelete7Days:{id:"chat_settings.auto_delete.7days",defaultMessage:"7 days"},autoDelete14Days:{id:"chat_settings.auto_delete.14days",defaultMessage:"14 days"},autoDelete30Days:{id:"chat_settings.auto_delete.30days",defaultMessage:"30 days"},autoDelete90Days:{id:"chat_settings.auto_delete.90days",defaultMessage:"90 days"},autoDeleteMessage:{id:"chat_window.auto_delete_label",defaultMessage:"Auto-delete after {day, plural, one {# day} other {# days}}"},autoDeleteMessageTooltip:{id:"chat_window.auto_delete_tooltip",defaultMessage:"Chat messages are set to auto-delete after {day, plural, one {# day} other {# days}} upon sending."}}),Le=()=>{const s=Y(),a=S(),d=V(),c=y(),{chatId:g}=X(),{data:t}=ee(g),{currentChatId:n}=ae(),{chatsQuery:{data:l,isLoading:h}}=te(),r=b.useRef(null),{deleteChat:_,updateChat:f}=se(t==null?void 0:t.id),m=E=>f.mutate({message_expiration:E}),I=oe(E=>{var U;return E.getIn(["relationships",(U=t==null?void 0:t.account)==null?void 0:U.id,"blocking"])}),Q=()=>{s(P("CONFIRM",{heading:a.formatMessage(o.blockHeading,{acct:t==null?void 0:t.account.acct}),message:a.formatMessage(o.blockMessage),confirm:a.formatMessage(o.blockConfirm),confirmationTheme:"primary",onConfirm:()=>s(me(t==null?void 0:t.account.id))}))},Z=()=>{s(P("CONFIRM",{heading:a.formatMessage(o.unblockHeading,{acct:t==null?void 0:t.account.acct}),message:a.formatMessage(o.unblockMessage),confirm:a.formatMessage(o.unblockConfirm),confirmationTheme:"primary",onConfirm:()=>s(he(t==null?void 0:t.account.id))}))},J=()=>{s(P("CONFIRM",{heading:a.formatMessage(o.leaveHeading),message:a.formatMessage(o.leaveMessage),confirm:a.formatMessage(o.leaveConfirm),confirmationTheme:"primary",onConfirm:()=>{_.mutate(void 0,{onSuccess(){c.push("/chats")}})}}))};return h?null:!n&&l&&l.length>0?e(Re,{}):n?t?e(i,{className:"h-full overflow-hidden"},void 0,e(M,{alignItems:"center",justifyContent:"between",space:2,className:"w-full p-4"},void 0,e(M,{alignItems:"center",space:2,className:"overflow-hidden"},void 0,e(M,{alignItems:"center"},void 0,e(x,{src:H,className:"mr-2 h-7 w-7 sm:mr-0 sm:hidden",onClick:()=>c.push("/chats")}),e(A,{to:`/@${t.account.acct}`},void 0,e(z,{src:t.account.avatar,size:40,className:"flex-none"}))),e(i,{alignItems:"start",className:"h-11 overflow-hidden"},void 0,e("div",{className:"flex w-full grow items-center space-x-1"},void 0,e(A,{to:`/@${t.account.acct}`},void 0,e(u,{weight:"bold",size:"sm",align:"left",truncate:!0},void 0,t.account.display_name||`@${t.account.username}`)),t.account.verified&&e(ie,{})),t.message_expiration&&e(ne,{text:a.formatMessage(o.autoDeleteMessageTooltip,{day:$(t.message_expiration)})},void 0,e(u,{align:"left",size:"sm",weight:"medium",theme:"primary",truncate:!0,className:"w-full cursor-help"},void 0,a.formatMessage(o.autoDeleteMessage,{day:$(t.message_expiration)}))))),e(ce,{},void 0,e(le,{as:x,src:de,iconClassName:"h-5 w-5 text-gray-600",children:null}),e(re,{className:"w-80"},void 0,e(i,{space:4,className:"px-6 py-5"},void 0,e(M,{alignItems:"center",space:3},void 0,e(z,{src:t.account.avatar_static,size:50}),e(i,{},void 0,e(u,{weight:"semibold"},void 0,t.account.display_name),e(u,{size:"sm",theme:"primary"},void 0,"@",t.account.acct))),d.chatsExpiration&&e(R,{},void 0,e(v,{label:a.formatMessage(o.autoDeleteLabel),hint:a.formatMessage(o.autoDeleteHint)}),e(v,{label:a.formatMessage(o.autoDelete7Days),onSelect:()=>m(p.SEVEN),isSelected:t.message_expiration===p.SEVEN}),e(v,{label:a.formatMessage(o.autoDelete14Days),onSelect:()=>m(p.FOURTEEN),isSelected:t.message_expiration===p.FOURTEEN}),e(v,{label:a.formatMessage(o.autoDelete30Days),onSelect:()=>m(p.THIRTY),isSelected:t.message_expiration===p.THIRTY}),e(v,{label:a.formatMessage(o.autoDelete90Days),onSelect:()=>m(p.NINETY),isSelected:t.message_expiration===p.NINETY})),e(i,{space:2},void 0,e(F,{as:"button",onSelect:I?Z:Q,className:"!px-0 hover:!bg-transparent"},void 0,e("div",{className:"flex w-full items-center space-x-2 text-sm font-bold text-primary-500 dark:text-accent-blue"},void 0,e(q,{src:ue,className:"h-5 w-5"}),e("span",{},void 0,a.formatMessage(I?o.unblockUser:o.blockUser,{acct:t.account.acct})))),d.chatsDelete&&e(F,{as:"button",onSelect:J,className:"!px-0 hover:!bg-transparent"},void 0,e("div",{className:"flex w-full items-center space-x-2 text-sm font-bold text-danger-600 dark:text-danger-500"},void 0,e(q,{src:ge,className:"h-5 w-5"}),e("span",{},void 0,a.formatMessage(o.leaveChat))))))))),e("div",{className:"h-full overflow-hidden"},void 0,e(ke,{className:"h-full",chat:t,inputRef:r}))):null:e(Ie,{})},Ee=D({title:{id:"chat.new_message.title",defaultMessage:"New Message"}}),Pe=()=>{const s=S(),a=y();return e(i,{className:"h-full space-y-4"},void 0,e(i,{className:"grow px-4 pt-6 sm:px-6"},void 0,e(M,{alignItems:"center"},void 0,e(x,{src:H,className:"mr-2 h-7 w-7 sm:mr-0 sm:hidden",onClick:()=>a.push("/chats")}),e(k,{title:s.formatMessage(Ee.title)}))),e(xe,{isMainPage:!0}))},C=D({title:{id:"chat.page_settings.title",defaultMessage:"Message Settings"},preferences:{id:"chat.page_settings.preferences",defaultMessage:"Preferences"},privacy:{id:"chat.page_settings.privacy",defaultMessage:"Privacy"},acceptingMessageLabel:{id:"chat.page_settings.accepting_messages.label",defaultMessage:"Allow users to start a new chat with you"},playSoundsLabel:{id:"chat.page_settings.play_sounds.label",defaultMessage:"Play a sound when you receive a message"},submit:{id:"chat.page_settings.submit",defaultMessage:"Save"}}),Te=()=>{var _;const{account:s}=B(),a=S(),d=y(),c=Y(),g=fe(),t=K(),[n,l]=b.useState({chats_onboarded:!0,accepts_chat_messages:((_=s==null?void 0:s.pleroma)==null?void 0:_.accepts_chat_messages)===!0}),h=(f,m)=>{c(ve(f,m,{showAlert:!0}))},r=f=>{f.preventDefault(),t.mutate(n)};return e(i,{className:"h-full space-y-8 px-4 py-6 sm:p-6"},void 0,e(M,{alignItems:"center"},void 0,e(x,{src:H,className:"mr-2 h-7 w-7 sm:mr-0 sm:hidden",onClick:()=>d.push("/chats")}),e(k,{title:a.formatMessage(C.title)})),e(j,{onSubmit:r},void 0,e(k,{title:a.formatMessage(C.preferences)}),e(R,{},void 0,e(v,{label:a.formatMessage(C.playSoundsLabel)},void 0,e(pe,{settings:g,settingPath:["chats","sound"],onChange:h}))),e(k,{title:a.formatMessage(C.privacy)}),e(W,{},void 0,e(R,{},void 0,e(v,{label:a.formatMessage(C.acceptingMessageLabel)},void 0,e(G,{checked:n.accepts_chat_messages,onChange:f=>l(m=>({...m,accepts_chat_messages:f.target.checked}))})))),e(L,{type:"submit",theme:"primary",disabled:t.isLoading},void 0,a.formatMessage(C.submit))))},He=D({title:{id:"column.chats",defaultMessage:"Messages"}}),Be=()=>{const s=S(),a=y(),d=V(),[c,g]=b.useState(""),t=De(c,300),n=r=>{a.push(`/chats/${r.id}`)},l=()=>{a.push("/chats/new")},h=()=>{a.push("/chats/settings")};return e(i,{space:4,className:"h-full"},void 0,e(i,{space:4,className:"px-4 pt-6"},void 0,e(M,{alignItems:"center",justifyContent:"between"},void 0,e(k,{title:s.formatMessage(He.title)}),e(M,{space:1},void 0,e(x,{src:be,iconClassName:"h-5 w-5 text-gray-600",onClick:h}),e(x,{src:Me,iconClassName:"h-5 w-5 text-gray-600",onClick:l}))),d.chatsSearch&&e(Ne,{value:c,onChange:r=>g(r.target.value),onClear:()=>g("")})),e(i,{className:"h-full grow"},void 0,e(Se,{onClickChat:n,searchValue:t})))},N=D({title:{id:"chat.welcome.title",defaultMessage:"Welcome to {br} Chats!"},subtitle:{id:"chat.welcome.subtitle",defaultMessage:"Exchange direct messages with other users."},acceptingMessageLabel:{id:"chat.welcome.accepting_messages.label",defaultMessage:"Allow users to start a new chat with you"},notice:{id:"chat.welcome.notice",defaultMessage:"You can change these settings later."},submit:{id:"chat.welcome.submit",defaultMessage:"Save & Continue"}}),Ue=()=>{var n;const{account:s}=B(),a=S(),d=K(),[c,g]=b.useState({chats_onboarded:!0,accepts_chat_messages:((n=s==null?void 0:s.pleroma)==null?void 0:n.accepts_chat_messages)===!0}),t=l=>{l.preventDefault(),d.mutate(c)};return e(i,{className:"h-full overflow-y-auto px-4 py-20 sm:px-0","data-testid":"chats-welcome"},void 0,e("div",{className:"mx-auto mb-2.5 w-full sm:w-3/5 xl:w-2/5"},void 0,e(u,{align:"center",weight:"bold",className:"mb-6 text-2xl leading-8 md:text-3xl"},void 0,a.formatMessage(N.title,{br:e("br",{})})),e(u,{align:"center",theme:"muted"},void 0,a.formatMessage(N.subtitle))),e(j,{onSubmit:t,className:"w-full space-y-8 sm:mx-auto sm:w-2/3 lg:w-3/5"},void 0,e(i,{space:2},void 0,e(k,{title:e(w,{id:"chat.page_settings.privacy",defaultMessage:"Privacy"})}),e(W,{},void 0,e(R,{},void 0,e(v,{label:a.formatMessage(N.acceptingMessageLabel)},void 0,e(G,{checked:c.accepts_chat_messages,onChange:l=>g(h=>({...h,accepts_chat_messages:l.target.checked}))}))))),e(u,{align:"center",theme:"muted"},void 0,a.formatMessage(N.notice)),e(L,{type:"submit",theme:"primary",block:!0,size:"lg",disabled:d.isLoading},void 0,a.formatMessage(N.submit))))},Ae=s=>{var _;const{account:a}=B(),d=y(),c=((_=a==null?void 0:a.source)==null?void 0:_.chats_onboarded)??!0,g=d.location.pathname,t=_e(g,{path:["/chats/settings","/chats/new","/chats/:chatId"],exact:!0}),n=b.useRef(null),[l,h]=b.useState("100%"),r=()=>{if(!n.current)return null;const{top:f}=n.current.getBoundingClientRect(),m=document.body.offsetHeight,I=document.body.clientWidth<976?-61:0;h(m-f+I)};return b.useLayoutEffect(()=>{r()},[n.current]),b.useEffect(()=>(window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}),[]),we.createElement("div",{ref:n,style:{height:l},className:"h-screen overflow-hidden bg-white text-gray-900 shadow-lg dark:bg-primary-900 dark:text-gray-100 dark:shadow-none sm:rounded-t-xl"},c?e("div",{className:"grid h-full grid-cols-9 overflow-hidden dark:divide-x-2 dark:divide-solid dark:divide-gray-800","data-testid":"chat-page"},void 0,e(i,{className:O("dark:inset col-span-9 overflow-hidden bg-gradient-to-r from-white to-gray-100 dark:bg-gray-900 dark:bg-none sm:col-span-3",{"hidden sm:block":t})},void 0,e(Be,{})),e(i,{className:O("col-span-9 h-full overflow-hidden sm:col-span-6",{"hidden sm:block":!t})},void 0,e(ye,{},void 0,e(T,{path:"/chats/new"},void 0,e(Pe,{})),e(T,{path:"/chats/settings"},void 0,e(Te,{})),e(T,{},void 0,e(Le,{}))))):e(Ue,{}))},We=s=>{let{params:a}=s;return e(Ce,{},void 0,e(Ae,{chatId:a==null?void 0:a.chatId}))};export{We as default};
