import{u as G,p as d,bM as le,bN as p,_ as e,G as T,a8 as S,n as I,K as A,c as z,bO as Q,am as $,bP as ue,bQ as ge,bR as P,bS as pe,bT as me,f as fe,ba as he,bU as be,r as b,bV as X,bG as H,H as D,bW as ve,af as V,bX as ye,bY as ke,bZ as Te,b_ as Me,R as Se,b$ as we,a1 as U,c0 as Ee,b4 as Re,a_ as xe,c1 as Ae,bv as Oe,c2 as _e,M as Ne,c3 as Y,c4 as Ce,c5 as He,c6 as Ge,ak as Ie,al as ze,c7 as Fe,c8 as Pe,c9 as Ue}from"../index-961d4ed1.js";import{G as We}from"./group-card-8dd35236.js";import{v as Be}from"./arrows-minimize-7c27a12c.js";import{n as W}from"./noop-33ff36b4.js";import"./group-header-image-9d6945b3.js";const _=I({accountEntity:{id:"report.confirmation.entity.account",defaultMessage:"account"},groupEntity:{id:"report.confirmation.entity.group",defaultMessage:"group"},title:{id:"report.confirmation.title",defaultMessage:"Thanks for submitting your report."},content:{id:"report.confirmation.content",defaultMessage:"If we find that this {entity} is violating the {link} we will take further action on the matter."}}),Z=e(A,{id:"shared.tos",defaultMessage:"Terms of Service"}),Le=i=>e("a",{href:i,target:"_blank",className:"text-primary-600 hover:text-primary-800 hover:underline dark:text-accent-blue dark:hover:text-accent-blue"},void 0,Z),N=()=>{const i=G(),c=d(t=>le(t).get("links")),o=d(t=>t.reports.new.entityType)===p.GROUP?i.formatMessage(_.groupEntity):i.formatMessage(_.accountEntity);return e(S,{space:1},void 0,e(T,{weight:"semibold",tag:"h1",size:"xl"},void 0,i.formatMessage(_.title)),e(T,{},void 0,i.formatMessage(_.content,{entity:o,link:c.get("termsOfService")?Le(c.get("termsOfService")):Z})))},$e=i=>{var E,y;let{id:c,disabled:s}=i;const o=z(),t=d(a=>a.statuses.get(c)),n=d(a=>a.reports.new.status_ids.includes(c)),v=a=>o(ue(c,a.target.checked));if(!t||t.reblog)return null;let w;if(t.media_attachments.size>0&&!t.media_attachments.some(a=>a.type==="unknown"))if(((E=t.media_attachments.get(0))==null?void 0:E.type)==="video"){const a=t.media_attachments.get(0);a&&(w=e(P,{fetchComponent:ge},void 0,m=>e(m,{preview:a.preview_url,blurhash:a.blurhash,src:a.url,alt:a.description,aspectRatio:a.meta.getIn(["original","aspect"]),width:239,height:110,inline:!0,sensitive:t.sensitive,onOpenVideo:W})))}else if(((y=t.media_attachments.get(0))==null?void 0:y.type)==="audio"){const a=t.media_attachments.get(0);a&&(w=e(P,{fetchComponent:pe},void 0,m=>e(m,{src:a.url,alt:a.description,inline:!0,sensitive:t.sensitive,onOpenAudio:W})))}else w=e(P,{fetchComponent:me},void 0,a=>e(a,{media:t.media_attachments,sensitive:t.sensitive,height:110,onOpenMedia:W}));return e("div",{className:"status-check-box"},void 0,e("div",{className:"status-check-box__status"},void 0,e(Q,{status:t}),w),e("div",{className:"status-check-box-toggle"},void 0,e($,{checked:n,onChange:v,disabled:s})))},O=I({addAdditionalStatuses:{id:"report.otherActions.addAdditional",defaultMessage:"Would you like to add additional statuses to this report?"},addMore:{id:"report.otherActions.addMore",defaultMessage:"Add more"},furtherActions:{id:"report.otherActions.furtherActions",defaultMessage:"Further actions:"},hideAdditonalStatuses:{id:"report.otherActions.hideAdditional",defaultMessage:"Hide additional statuses"},otherStatuses:{id:"report.otherActions.otherStatuses",defaultMessage:"Include other statuses?"}}),B=i=>{let{account:c}=i;const s=z(),o=fe(),t=G(),n=d(u=>he(u.timelines.get(`account:${c.id}:with_replies`).items).union(u.reports.new.status_ids)),v=d(u=>u.reports.new.block),w=d(u=>u.reports.new.forward),E=be(c)&&o.federating,y=d(u=>u.reports.new.isSubmitting),[a,m]=b.useState(!1),R=u=>{s(ke(u.target.checked))},x=u=>{s(Te(u.target.checked))};return b.useEffect(()=>{s(X())},[]),e(S,{space:4},void 0,o.reportMultipleStatuses&&e(S,{space:2},void 0,e(T,{tag:"h1",size:"xl",weight:"semibold"},void 0,t.formatMessage(O.otherStatuses)),e(H,{labelText:t.formatMessage(O.addAdditionalStatuses)},void 0,a?e(S,{space:2},void 0,e("div",{className:"divide-y divide-solid divide-gray-200 dark:divide-gray-800"},void 0,n.map(u=>e($e,{id:u},u))),e("div",{},void 0,e(V,{icon:Be,theme:"tertiary",size:"sm",onClick:()=>m(!1)},void 0,t.formatMessage(O.hideAdditonalStatuses)))):e(V,{icon:ye,theme:"tertiary",size:"sm",onClick:()=>m(!0)},void 0,t.formatMessage(O.addMore)))),e(S,{space:2},void 0,e(T,{tag:"h1",size:"xl",weight:"semibold"},void 0,t.formatMessage(O.furtherActions)),e(H,{labelText:e(A,{id:"report.block_hint",defaultMessage:"Do you also want to block this account?"})},void 0,e(D,{space:2,alignItems:"center"},void 0,e($,{checked:v,onChange:R,id:"report-block"}),e(T,{theme:"muted",tag:"label",size:"sm",htmlFor:"report-block"},void 0,e(A,{id:"report.block",defaultMessage:"Block {target}",values:{target:`@${c.acct}`}})))),E&&e(H,{labelText:e(A,{id:"report.forward_hint",defaultMessage:"The account is from another server. Send a copy of the report there as well?"})},void 0,e(D,{space:2,alignItems:"center"},void 0,e($,{checked:w,onChange:x,id:"report-forward",disabled:y}),e(T,{theme:"muted",tag:"label",size:"sm",htmlFor:"report-forward"},void 0,e(A,{id:"report.forward",defaultMessage:"Forward to {target}",values:{target:ve(c)}}))))))},L=I({placeholder:{id:"report.placeholder",defaultMessage:"Additional comments"},reasonForReporting:{id:"report.reason.title",defaultMessage:"Reason for reporting"}}),K=385,C=()=>{const i=z(),c=G(),s=b.useRef(null),[o,t]=b.useState(!1),[n,v]=b.useState(!0),w=d(r=>r.reports.new.entityType),E=d(r=>r.reports.new.comment),y=d(r=>r.rules.items),a=d(r=>r.reports.new.rule_ids),m=y.length>0,R=r=>{i(Ee(r.target.value))},x=()=>{if(s.current){const{scrollTop:r,scrollHeight:f,clientHeight:M}=s.current;r+M>f-24?t(!0):t(!1),r<24?v(!0):v(!1)}},u=r=>{let f="content";switch(w){case p.ACCOUNT:f="account";break;case p.STATUS:case p.CHAT_MESSAGE:f="content";break;case p.GROUP:f="group";break;default:f="content";break}return r.rule_type?r.rule_type===f:!0};return b.useEffect(()=>{i(X())},[]),b.useEffect(()=>{if(y.length>0&&s.current){const{clientHeight:r}=s.current;r<=K&&t(!0)}},[y,s.current]),e(S,{space:4},void 0,m&&e(S,{space:2},void 0,e(T,{size:"xl",weight:"semibold",tag:"h1"},void 0,c.formatMessage(L.reasonForReporting)),e("div",{className:"relative"},void 0,Se.createElement("div",{style:{maxHeight:K},className:"-space-y-px overflow-y-auto rounded-lg",onScroll:x,ref:s},y.filter(u).map((r,f)=>{const M=a.includes(String(r.id));return e("button",{"data-testid":`rule-${r.id}`,onClick:()=>i(we(r.id)),className:U({"relative border border-solid border-gray-200 dark:border-gray-800 hover:bg-gray-100 dark:hover:bg-primary-800/30 text-start w-full p-4 flex justify-between items-center cursor-pointer":!0,"rounded-tl-lg rounded-tr-lg":f===0,"rounded-bl-lg rounded-br-lg":f===y.length-1,"bg-gray-200 hover:bg-gray-200 dark:bg-primary-800/50":M})},f,e(S,{className:"mr-3"},void 0,e(T,{tag:"span",size:"sm",weight:"medium",theme:M?"primary":"default"},void 0,r.text),e(T,{tag:"span",theme:"muted",size:"sm"},void 0,r.subtext)),e("input",{name:"reason",type:"checkbox",value:r.id,checked:M,readOnly:!0,className:"h-4 w-4 rounded border-2 border-gray-300 text-primary-600 checked:bg-primary-500 focus:ring-primary-500 dark:border-gray-800 dark:bg-gray-900 dark:checked:bg-primary-500 dark:focus:ring-primary-500"}))})),e("div",{className:U("pointer-events-none absolute inset-x-0 top-0 flex justify-center rounded-t-lg bg-gradient-to-b from-white pb-12 pt-8 transition-opacity duration-500 dark:from-gray-900",{"opacity-0":n,"opacity-100":!n})}),e("div",{className:U("pointer-events-none absolute inset-x-0 bottom-0 flex justify-center rounded-b-lg bg-gradient-to-t from-white pb-8 pt-12 transition-opacity duration-500 dark:from-gray-900",{"opacity-0":o,"opacity-100":!o})}))),e(H,{labelText:c.formatMessage(L.placeholder)},void 0,e(Me,{placeholder:c.formatMessage(L.placeholder),value:E,onChange:R})))},k=I({blankslate:{id:"report.reason.blankslate",defaultMessage:"You have removed all statuses from being selected."},done:{id:"report.done",defaultMessage:"Done"},next:{id:"report.next",defaultMessage:"Next"},submit:{id:"report.submit",defaultMessage:"Submit"},reportContext:{id:"report.chatMessage.context",defaultMessage:"When reporting a userâ€™s message, the five messages before and five messages after the one selected will be passed along to our moderation team for context."},reportMessage:{id:"report.chatMessage.title",defaultMessage:"Report message"},reportGroup:{id:"report.group.title",defaultMessage:"Report Group"},cancel:{id:"common.cancel",defaultMessage:"Cancel"},previous:{id:"report.previous",defaultMessage:"Previous"}});var l=function(i){return i.ONE="ONE",i.TWO="TWO",i.THREE="THREE",i}(l||{});const De={[p.ACCOUNT]:{ONE:C,TWO:B,THREE:N},[p.CHAT_MESSAGE]:{ONE:C,TWO:B,THREE:N},[p.STATUS]:{ONE:C,TWO:B,THREE:N},[p.GROUP]:{ONE:C,TWO:null,THREE:N}},qe=i=>{let{statusId:c}=i;const s=d(o=>o.statuses.get(c));return s?e(S,{space:2,className:"rounded-lg bg-gray-100 p-4 dark:bg-gray-800"},void 0,e(Ne,{id:s.account,showProfileHoverCard:!1,withLinkToProfile:!1,timestamp:s.created_at,hideActions:!0}),e(Q,{status:s,collapsable:!0}),s.media_attachments.size>0&&e(_e,{media:s.media_attachments,sensitive:s.sensitive})):null},Xe=i=>{let{onClose:c}=i;const s=z(),o=G(),t=d(g=>g.reports.new.account_id),{account:n}=Re(t||void 0),v=d(g=>g.reports.new.entityType),w=d(g=>g.reports.new.block),E=d(g=>g.reports.new.isSubmitting),y=d(g=>g.rules.items),a=d(g=>g.reports.new.rule_ids),m=d(g=>g.reports.new.status_ids),R=d(g=>g.reports.new.chat_message),x=d(g=>g.reports.new.group),u=y.length>0,r=v===p.ACCOUNT,f=v===p.STATUS,M=v===p.GROUP,[h,F]=b.useState(l.ONE),q=()=>{s(Ce()).then(()=>F(l.THREE)).catch(g=>s(He(g))),w&&n&&s(Ge(n.id))},J=b.useCallback(()=>{switch(m.size){case 0:return e("div",{className:"flex w-full items-center justify-center rounded-lg bg-gray-100 p-4 dark:bg-gray-800"},void 0,e(T,{theme:"muted"},void 0,o.formatMessage(k.blankslate)));default:return e(qe,{statusId:m.first()})}},[m.size]),ee=b.useMemo(()=>{switch(h){case l.ONE:return o.formatMessage(k.cancel);default:return o.formatMessage(k.previous)}},[h]),te=()=>{switch(h){case l.ONE:c();break;case l.TWO:F(l.ONE);break}},se=b.useMemo(()=>{switch(h){case l.ONE:return M?o.formatMessage(k.submit):o.formatMessage(k.next);case l.TWO:return M?o.formatMessage(k.done):o.formatMessage(k.submit);case l.THREE:return o.formatMessage(k.done);default:return o.formatMessage(k.next)}},[h,M]),ae=()=>{switch(h){case l.ONE:M?q():F(l.TWO);break;case l.TWO:M?(s(Y()),c()):q();break;case l.THREE:s(Y()),c();break}},re=()=>{if(n)return e(S,{space:4},void 0,e(D,{alignItems:"center",space:4,className:"rounded-md border border-solid border-gray-400 p-4 dark:border-2 dark:border-gray-800"},void 0,e("div",{},void 0,e(Ue,{src:n.avatar,className:"h-8 w-8"})),e("div",{className:"grow rounded-md bg-gray-200 p-4 dark:bg-primary-800"},void 0,e(T,{dangerouslySetInnerHTML:{__html:R==null?void 0:R.content}}))),e(Ie,{},void 0,e(ze,{label:e(Fe,{src:Pe,className:"text-gray-600"})},void 0,e(T,{size:"sm"},void 0,o.formatMessage(k.reportContext)))))},oe=()=>{if(x)return e(We,{group:x})},ie=()=>{switch(v){case p.STATUS:return J();case p.CHAT_MESSAGE:return re();case p.GROUP:return h===l.TWO?null:oe();default:return null}},ne=()=>{switch(v){case p.CHAT_MESSAGE:return o.formatMessage(k.reportMessage);case p.GROUP:return o.formatMessage(k.reportGroup);default:return e(A,{id:"report.target",defaultMessage:"Reporting {target}",values:{target:e("strong",{},void 0,"@",n==null?void 0:n.acct)}})}},ce=b.useMemo(()=>h===l.THREE?!1:E||u&&a.isEmpty()||f&&m.size===0,[h,E,u,a,m.size,f]),de=b.useCallback(()=>{switch(h){case l.ONE:return .33;case l.TWO:return .66;case l.THREE:return 1;default:return 0}},[h]);if(b.useEffect(()=>{n!=null&&n.id&&s(xe(n.id,{withReplies:!0,maxId:null}))},[n==null?void 0:n.id]),!n)return null;const j=De[v][h];return e(Oe,{title:ne(),onClose:c,cancelText:ee,cancelAction:h===l.THREE?void 0:te,confirmationAction:ae,confirmationText:se,confirmationDisabled:ce,skipFocus:!0},void 0,e(S,{space:4},void 0,e(Ae,{progress:de()}),h!==l.THREE&&!r&&ie(),j&&e(j,{account:n})))};export{Xe as default};
