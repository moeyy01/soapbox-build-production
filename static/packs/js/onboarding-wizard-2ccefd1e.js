import{c as z,b9 as D,R as m,eu as K,_ as e,a$ as M,a8 as n,G as l,K as t,c9 as $,aE as U,a1 as R,c7 as A,bX as q,af as f,b0 as C,ey as G,ew as E,bq as P,n as I,u as V,bG as Y,b_ as J,ev as X,de as Z,bH as Q,t as ee,hc as te,b3 as ae,Z as se,M as oe,f as ie,H as re,iE as ne,iF as de}from"../index-961d4ed1.js";import{R as le}from"./index-c8dcab95.js";import{S as ce}from"./scrollable-list-74021d3b.js";import{b as ue}from"./suggestions-07efc620.js";import"./warning-07d0fac9.js";import"./index-c72bc579.js";import"./load-more-1869fbc1.js";const me=I({error:{id:"onboarding.error",defaultMessage:"An unexpected error occurred. Please try again or skip this step."}}),ge=b=>{let{onNext:i}=b;const r=z(),{account:o}=D(),a=m.useRef(null),[c,u]=m.useState(),[g,s]=m.useState(!1),[v,h]=m.useState(!0),d=o?K(o.avatar):!1,p=()=>{var y;(y=a.current)==null||y.click()},k=y=>{var N;const x=(N=y.target.files)==null?void 0:N.item(0);x&&G(x,16e4).then(S=>{const _=S?URL.createObjectURL(S):o==null?void 0:o.avatar;u(_),s(!0);const T=new FormData;T.append("avatar",x);const j=r(E(T));Promise.all([j]).then(()=>{h(!1),s(!1),i()}).catch(L=>{var F;s(!1),h(!1),u(null),((F=L.response)==null?void 0:F.status)===422?P.error(L.response.data.error.replace("Validation failed: ","")):P.error(me.error)})}).catch(console.error)};return e(C,{variant:"rounded",size:"xl"},void 0,e(M,{},void 0,e("div",{},void 0,e("div",{className:"-mx-4 mb-4 border-b border-solid border-gray-200 pb-4 dark:border-gray-900/50 sm:-mx-10 sm:pb-10"},void 0,e(n,{space:2},void 0,e(l,{size:"2xl",align:"center",weight:"bold"},void 0,e(t,{id:"onboarding.avatar.title",defaultMessage:"Choose a profile picture"})),e(l,{theme:"muted",align:"center"},void 0,e(t,{id:"onboarding.avatar.subtitle",defaultMessage:"Just have fun with it."})))),e("div",{className:"mx-auto sm:w-2/3 sm:pt-10 md:w-1/2"},void 0,e(n,{space:10},void 0,e("div",{className:"relative mx-auto rounded-full bg-gray-200"},void 0,o&&e($,{src:c||o.avatar,size:175}),g&&e("div",{className:"absolute inset-0 flex items-center justify-center rounded-full bg-white/80 dark:bg-primary-900/80"},void 0,e(U,{withText:!1})),e("button",{onClick:p,type:"button",className:R({"absolute bottom-3 right-2 p-1 bg-primary-600 rounded-full ring-2 ring-white dark:ring-primary-900 hover:bg-primary-700":!0,"opacity-50 pointer-events-none":g}),disabled:g},void 0,e(A,{src:q,className:"h-5 w-5 text-white"})),m.createElement("input",{type:"file",className:"hidden",ref:a,onChange:k})),e(n,{justifyContent:"center",space:2},void 0,e(f,{block:!0,theme:"primary",type:"button",onClick:i,disabled:d&&v||g},void 0,g?e(t,{id:"onboarding.saving",defaultMessage:"Saving…"}):e(t,{id:"onboarding.next",defaultMessage:"Next"})),v&&e(f,{block:!0,theme:"tertiary",type:"button",onClick:i},void 0,e(t,{id:"onboarding.skip",defaultMessage:"Skip for now"}))))))))},B=I({bioPlaceholder:{id:"onboarding.bio.placeholder",defaultMessage:"Tell the world a little about yourself…"},error:{id:"onboarding.error",defaultMessage:"An unexpected error occurred. Please try again or skip this step."}}),pe=b=>{var p;let{onNext:i}=b;const r=V(),o=z(),{account:a}=D(),[c,u]=m.useState(((p=a==null?void 0:a.source)==null?void 0:p.note)??""),[g,s]=m.useState(!1),[v,h]=m.useState([]),d=()=>{s(!0);const k=o(E({note:c}));Promise.all([k]).then(()=>{s(!1),i()}).catch(y=>{var w;s(!1),((w=y.response)==null?void 0:w.status)===422?h([y.response.data.error.replace("Validation failed: ","")]):P.error(B.error)})};return e(C,{variant:"rounded",size:"xl"},void 0,e(M,{},void 0,e("div",{},void 0,e("div",{className:"-mx-4 mb-4 border-b border-solid border-gray-200 pb-4 dark:border-gray-800 sm:-mx-10 sm:pb-10"},void 0,e(n,{space:2},void 0,e(l,{size:"2xl",align:"center",weight:"bold"},void 0,e(t,{id:"onboarding.note.title",defaultMessage:"Write a short bio"})),e(l,{theme:"muted",align:"center"},void 0,e(t,{id:"onboarding.note.subtitle",defaultMessage:"You can always edit this later."})))),e(n,{space:5},void 0,e("div",{className:"mx-auto sm:w-2/3 sm:pt-10"},void 0,e(Y,{hintText:e(t,{id:"onboarding.bio.hint",defaultMessage:"Max 500 characters"}),labelText:e(t,{id:"edit_profile.fields.bio_label",defaultMessage:"Bio"}),errors:v},void 0,e(J,{onChange:k=>u(k.target.value),placeholder:r.formatMessage(B.bioPlaceholder),value:c,maxLength:500}))),e("div",{className:"mx-auto sm:w-2/3 md:w-1/2"},void 0,e(n,{justifyContent:"center",space:2},void 0,e(f,{block:!0,theme:"primary",type:"submit",disabled:g,onClick:d},void 0,g?e(t,{id:"onboarding.saving",defaultMessage:"Saving…"}):e(t,{id:"onboarding.next",defaultMessage:"Next"})),e(f,{block:!0,theme:"tertiary",type:"button",onClick:i},void 0,e(t,{id:"onboarding.skip",defaultMessage:"Skip for now"}))))))))},be="/packs/assets/confetti-ad45ba10.svg",ve=b=>{let{onComplete:i}=b;return e(C,{variant:"rounded",size:"xl"},void 0,e(M,{},void 0,e(n,{space:2},void 0,e(A,{strokeWidth:1,src:be,className:"mx-auto h-16 w-16 text-primary-600 dark:text-primary-400"}),e(l,{size:"2xl",align:"center",weight:"bold"},void 0,e(t,{id:"onboarding.finished.title",defaultMessage:"Onboarding complete"})),e(l,{theme:"muted",align:"center"},void 0,e(t,{id:"onboarding.finished.message",defaultMessage:"We are very excited to welcome you to our community! Tap the button below to get started."}))),e("div",{className:"mx-auto pt-10 sm:w-2/3 md:w-1/2"},void 0,e(n,{justifyContent:"center",space:2},void 0,e(f,{block:!0,theme:"primary",onClick:i},void 0,e(t,{id:"onboarding.view_feed",defaultMessage:"View Feed"}))))))},H=I({header:{id:"account.header.alt",defaultMessage:"Profile header"},error:{id:"onboarding.error",defaultMessage:"An unexpected error occurred. Please try again or skip this step."}}),he=b=>{let{onNext:i}=b;const r=V(),o=z(),{account:a}=D(),c=m.useRef(null),[u,g]=m.useState(),[s,v]=m.useState(!1),[h,d]=m.useState(!0),p=a?X(a.header):!1,k=()=>{var w;(w=c.current)==null||w.click()},y=w=>{var S;const N=(S=w.target.files)==null?void 0:S.item(0);N&&G(N,2073600).then(_=>{const T=_?URL.createObjectURL(_):a==null?void 0:a.header;g(T),v(!0);const j=new FormData;j.append("header",_);const L=o(E(j));Promise.all([L]).then(()=>{d(!1),v(!1),i()}).catch(F=>{var O;v(!1),d(!1),g(null),((O=F.response)==null?void 0:O.status)===422?P.error(F.response.data.error.replace("Validation failed: ","")):P.error(H.error)})}).catch(console.error)};return e(C,{variant:"rounded",size:"xl"},void 0,e(M,{},void 0,e("div",{},void 0,e("div",{className:"-mx-4 mb-4 border-b border-solid border-gray-200 pb-4 dark:border-gray-800 sm:-mx-10 sm:pb-10"},void 0,e(n,{space:2},void 0,e(l,{size:"2xl",align:"center",weight:"bold"},void 0,e(t,{id:"onboarding.header.title",defaultMessage:"Pick a cover image"})),e(l,{theme:"muted",align:"center"},void 0,e(t,{id:"onboarding.header.subtitle",defaultMessage:"This will be shown at the top of your profile."})))),e("div",{className:"mx-auto sm:w-2/3 sm:pt-10 md:w-1/2"},void 0,e(n,{space:10},void 0,e("div",{className:"rounded-lg border border-solid border-gray-200 dark:border-gray-800"},void 0,e("div",{role:"button",className:"relative flex h-24 items-center justify-center rounded-t-md bg-gray-200 dark:bg-gray-800"},void 0,u||(a==null?void 0:a.header)&&e(Z,{src:u||a.header,alt:r.formatMessage(H.header),className:"absolute inset-0 rounded-t-md object-cover"}),s&&e("div",{className:"absolute inset-0 flex items-center justify-center rounded-t-md bg-white/80 dark:bg-primary-900/80"},void 0,e(U,{withText:!1})),e("button",{onClick:k,type:"button",className:R({"absolute -top-3 -right-3 p-1 bg-primary-600 rounded-full ring-2 ring-white dark:ring-primary-900 hover:bg-primary-700":!0,"opacity-50 pointer-events-none":s}),disabled:s},void 0,e(A,{src:q,className:"h-5 w-5 text-white"})),m.createElement("input",{type:"file",className:"hidden",ref:c,onChange:y})),e("div",{className:"flex flex-col px-4 pb-4"},void 0,a&&e($,{src:a.avatar,size:64,className:"-mt-8 mb-2 ring-2 ring-white dark:ring-primary-800"}),e(l,{weight:"bold",size:"sm"},void 0,a==null?void 0:a.display_name),e(l,{theme:"muted",size:"sm"},void 0,"@",a==null?void 0:a.username))),e(n,{justifyContent:"center",space:2},void 0,e(f,{block:!0,theme:"primary",type:"button",onClick:i,disabled:p&&h||s},void 0,s?e(t,{id:"onboarding.saving",defaultMessage:"Saving…"}):e(t,{id:"onboarding.next",defaultMessage:"Next"})),h&&e(f,{block:!0,theme:"tertiary",type:"button",onClick:i},void 0,e(t,{id:"onboarding.skip",defaultMessage:"Skip for now"}))))))))},W=I({usernamePlaceholder:{id:"onboarding.display_name.placeholder",defaultMessage:"Eg. John Smith"},error:{id:"onboarding.error",defaultMessage:"An unexpected error occurred. Please try again or skip this step."}}),fe=b=>{let{onNext:i}=b;const r=V(),o=z(),{account:a}=D(),[c,u]=m.useState((a==null?void 0:a.display_name)||""),[g,s]=m.useState(!1),[v,h]=m.useState([]),k=!(c.trim().length>0)||c.length>30,y=m.useMemo(()=>{const x=30-c.length;return`${x} ${x===1?"character remaining":"characters remaining"}`},[c]),w=()=>{s(!0);const x=o(E({display_name:c}));Promise.all([x]).then(()=>{s(!1),i()}).catch(N=>{var S;s(!1),((S=N.response)==null?void 0:S.status)===422?h([N.response.data.error.replace("Validation failed: ","")]):P.error(W.error)})};return e(C,{variant:"rounded",size:"xl"},void 0,e(M,{},void 0,e("div",{},void 0,e("div",{className:"-mx-4 mb-4 border-b border-solid border-gray-200 pb-4 dark:border-gray-800 sm:-mx-10 sm:pb-10"},void 0,e(n,{space:2},void 0,e(l,{size:"2xl",align:"center",weight:"bold"},void 0,e(t,{id:"onboarding.display_name.title",defaultMessage:"Choose a display name"})),e(l,{theme:"muted",align:"center"},void 0,e(t,{id:"onboarding.display_name.subtitle",defaultMessage:"You can always edit this later."})))),e("div",{className:"mx-auto sm:w-2/3 sm:pt-10 md:w-1/2"},void 0,e(n,{space:5},void 0,e(Y,{hintText:y,labelText:e(t,{id:"onboarding.display_name.label",defaultMessage:"Display name"}),errors:v},void 0,e(Q,{onChange:x=>u(x.target.value),placeholder:r.formatMessage(W.usernamePlaceholder),type:"text",value:c,maxLength:30})),e(n,{justifyContent:"center",space:2},void 0,e(f,{block:!0,theme:"primary",type:"submit",disabled:k||g,onClick:w},void 0,g?e(t,{id:"onboarding.saving",defaultMessage:"Saving…"}):e(t,{id:"onboarding.next",defaultMessage:"Next"})),e(f,{block:!0,theme:"tertiary",type:"button",onClick:i},void 0,e(t,{id:"onboarding.skip",defaultMessage:"Skip for now"}))))))))},ye=b=>{let{onNext:i}=b;const{account:r}=D(),o=ee();return e(C,{variant:"rounded",size:"xl"},void 0,e(M,{},void 0,e(n,{space:2},void 0,e(A,{strokeWidth:1,src:te,className:"mx-auto h-16 w-16 text-primary-600 dark:text-primary-400"}),e(l,{size:"2xl",weight:"bold"},void 0,e(t,{id:"onboarding.fediverse.title",defaultMessage:"{siteTitle} is just one part of the Fediverse",values:{siteTitle:o.title}})),e(n,{space:4},void 0,e("div",{className:"border-b border-solid border-gray-200 pb-2 dark:border-gray-800 sm:pb-5"},void 0,e(n,{space:4},void 0,e(l,{theme:"muted"},void 0,e(t,{id:"onboarding.fediverse.message",defaultMessage:'The Fediverse is a social network made up of thousands of diverse and independently-run social media sites (aka "servers"). You can follow users — and like, repost, and reply to posts — from most other Fediverse servers, because they can communicate with {siteTitle}.',values:{siteTitle:o.title}})),e(l,{theme:"muted"},void 0,e(t,{id:"onboarding.fediverse.trailer",defaultMessage:"Because it is distributed and anyone can run their own server, the Fediverse is resilient and open. If you choose to join another server or set up your own, you can interact with the same people and continue on the same social graph."})))),r&&e("div",{className:"rounded-lg bg-primary-50 p-4 text-center dark:bg-gray-800"},void 0,e(ae,{account:r})),e(l,{theme:"muted"},void 0,e(t,{id:"onboarding.fediverse.its_you",defaultMessage:"This is you! Other people can follow you from other servers by using your full @-handle."})),e(l,{theme:"muted"},void 0,e(t,{id:"onboarding.fediverse.other_instances",defaultMessage:"When browsing your timeline, pay attention to the full username after the second @ symbol to know which server a post is from."})))),e("div",{className:"mx-auto pt-10 sm:w-2/3 md:w-1/2"},void 0,e(n,{justifyContent:"center",space:2},void 0,e(f,{block:!0,theme:"primary",onClick:i},void 0,e(t,{id:"onboarding.fediverse.next",defaultMessage:"Next"}))))))},xe=b=>{let{onNext:i}=b;const{data:r,fetchNextPage:o,hasNextPage:a,isFetching:c}=ue(),u=se(()=>c?null:o(),300),g=()=>r?e("div",{className:"flex flex-col sm:pb-10 sm:pt-4"},void 0,e(ce,{isLoading:c,scrollKey:"suggestions",onLoadMore:u,hasMore:a,useWindowScroll:!1,style:{height:320}},void 0,r.map(h=>e("div",{className:"py-2"},h.account.id,e(oe,{id:h.account.id,showProfileHoverCard:!1,withLinkToProfile:!1}))))):null,s=()=>e("div",{className:"my-2 rounded-lg bg-primary-50 p-8 text-center dark:bg-gray-800"},void 0,e(l,{},void 0,e(t,{id:"empty_column.follow_recommendations",defaultMessage:"Looks like no suggestions could be generated for you. You can try using search to look for people you might know or explore trending hashtags."})));return e(C,{variant:"rounded",size:"xl"},void 0,e(M,{},void 0,e("div",{},void 0,e("div",{className:"-mx-4 mb-4 border-b border-solid border-gray-200 pb-4 dark:border-gray-800 sm:-mx-10 sm:pb-10"},void 0,e(n,{space:2},void 0,e(l,{size:"2xl",align:"center",weight:"bold"},void 0,e(t,{id:"onboarding.suggestions.title",defaultMessage:"Suggested accounts"})),e(l,{theme:"muted",align:"center"},void 0,e(t,{id:"onboarding.suggestions.subtitle",defaultMessage:"Here are a few of the most popular accounts you might like."})))),(()=>!r||r.length===0?s():g())(),e("div",{className:"mx-auto sm:w-2/3 md:w-1/2"},void 0,e(n,{},void 0,e(n,{justifyContent:"center",space:2},void 0,e(f,{block:!0,theme:"primary",onClick:i},void 0,e(t,{id:"onboarding.done",defaultMessage:"Done"})),e(f,{block:!0,theme:"tertiary",type:"button",onClick:i},void 0,e(t,{id:"onboarding.skip",defaultMessage:"Skip for now"}))))))))},_e=()=>{const b=z(),i=ie(),[r,o]=m.useState(0),a=d=>{o(d)},c=()=>{o(d=>Math.max(0,d-1))},u=()=>{o(d=>Math.min(d+1,s.length-1))},g=()=>{b(de())},s=[e(ge,{onNext:u}),e(fe,{onNext:u}),e(pe,{onNext:u}),e(he,{onNext:u}),e(xe,{onNext:u})];i.federating&&s.push(e(ye,{onNext:u})),s.push(e(ve,{onComplete:g}));const v=d=>{let{key:p}=d;switch(p){case"ArrowLeft":c();break;case"ArrowRight":u();break}},h=d=>{o(d)};return m.useEffect(()=>(document.addEventListener("keyup",v),()=>{document.removeEventListener("keyup",v)}),[]),e("div",{"data-testid":"onboarding-wizard"},void 0,e(ne,{}),e("main",{className:"flex h-screen flex-col overflow-x-hidden"},void 0,e("div",{className:"flex h-full flex-col items-center justify-center"},void 0,e(le,{animateHeight:!0,index:r,onChangeIndex:a},void 0,s.map((d,p)=>e("div",{className:"w-full max-w-[100vw] py-6 sm:mx-auto sm:max-w-lg md:max-w-2xl"},p,e("div",{className:R({"transition-opacity ease-linear":!0,"opacity-0 duration-500":r!==p,"opacity-100 duration-75":r===p})},void 0,d)))),e(re,{space:3,alignItems:"center",justifyContent:"center",className:"relative"},void 0,s.map((d,p)=>e("button",{tabIndex:0,onClick:()=>h(p),className:R({"w-5 h-5 rounded-full focus:ring-primary-600 focus:ring-2 focus:ring-offset-2":!0,"bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-700/75 hover:bg-gray-400":p!==r,"bg-primary-600":p===r})},p))))))};export{_e as default};
