import{bk as L,j_ as j,bm as q,bn as U,r as d,u as B,t as J,dD as K,p as O,_ as t,aE as W,bF as $,R as l,ay as m,bG as I,K as p,bH as z,c7 as Q,d8 as V,b_ as X,bJ as Y,af as Z,a2 as ee,eu as ae,ev as te,n as se,bq as N}from"../index-961d4ed1.js";import{u as oe}from"./useGroupTags-ee20c38f.js";import{u as A}from"./useImageField-8e42d763.js";import{H as ne,A as re}from"./header-picker-3bbb9670.js";import{G as ie}from"./group-tags-field-a7f2a533.js";import"./photo-plus-d58838d9.js";import"./streamfield-e3bece9e.js";function de(a){const n=L(),{createEntity:o,...r}=j([U.GROUPS],e=>n.put(`/api/v1/groups/${a}`,e,{headers:{"Content-Type":"multipart/form-data"}}),{schema:q});return{updateGroup:o,...r}}function P(a){const[n,o]=d.useState(a),r=typeof a=="string",e=f=>{o(f.target.value)};return d.useEffect(()=>{r&&o(a)},[r]),{value:n||"",onChange:e}}const ce=a=>a&&ae(a)?void 0:a,ue=a=>a&&te(a)?void 0:a,g=se({heading:{id:"navigation_bar.edit_group",defaultMessage:"Edit Group"},groupNamePlaceholder:{id:"manage_group.fields.name_placeholder",defaultMessage:"Group Name"},groupDescriptionPlaceholder:{id:"manage_group.fields.description_placeholder",defaultMessage:"Description"},groupSaved:{id:"group.update.success",defaultMessage:"Group successfully saved"}}),_e=a=>{var G;let{params:{groupId:n}}=a;const o=B(),r=J(),{group:e,isLoading:f}=K(n),{updateGroup:D}=de(n),{invalidate:F}=oe(n),[v,b]=d.useState(!1),[c,u]=d.useState([""]),h=A({maxPixels:400*400,preview:ce(e==null?void 0:e.avatar)}),_=A({maxPixels:1920*1080,preview:ue(e==null?void 0:e.header)}),x=P(e==null?void 0:e.display_name),y=P(e==null?void 0:e.note_plain),R=Number(r.configuration.getIn(["groups","max_characters_name"])),w=Number(r.configuration.getIn(["groups","max_characters_description"])),E=(G=O(s=>s.instance.configuration.getIn(["media_attachments","supported_mime_types"])))==null?void 0:G.filter(s=>s.startsWith("image/")).toArray().join(",");async function C(){b(!0),await D({display_name:x.value,note:y.value,avatar:h.file===null?"":h.file,header:_.file===null?"":_.file,tags:c},{onSuccess(){F(),N.success(o.formatMessage(g.groupSaved))},onError(s){var S,M,T;const i=(M=(S=s.response)==null?void 0:S.data)==null?void 0:M.error;((T=s.response)==null?void 0:T.status)===422&&typeof i<"u"&&N.error(i)}}),b(!1)}const H=()=>{u([...c,""])},k=s=>{const i=[...c];i.splice(s,1),u(i)};return d.useEffect(()=>{e&&u(e.tags.map(s=>s.name))},[e==null?void 0:e.id]),f?t(W,{}):t(ee,{label:o.formatMessage(g.heading)},void 0,t($,{onSubmit:C},void 0,t("div",{className:"relative mb-12 flex"},void 0,l.createElement(ne,m({accept:E,disabled:v},_)),l.createElement(re,m({accept:E,disabled:v},h))),t(I,{labelText:t(p,{id:"manage_group.fields.name_label_optional",defaultMessage:"Group name"}),hintText:t(p,{id:"manage_group.fields.cannot_change_hint",defaultMessage:"This cannot be changed after the group is created."})},void 0,l.createElement(z,m({type:"text",placeholder:o.formatMessage(g.groupNamePlaceholder),maxLength:R},x,{append:t(Q,{className:"h-5 w-5 text-gray-600",src:V}),disabled:!0}))),t(I,{labelText:t(p,{id:"manage_group.fields.description_label",defaultMessage:"Description"})},void 0,l.createElement(X,m({autoComplete:"off",placeholder:o.formatMessage(g.groupDescriptionPlaceholder),maxLength:w},y))),t("div",{className:"pb-6"},void 0,t(ie,{tags:c,onChange:u,onAddItem:H,onRemoveItem:k})),t(Y,{},void 0,t(Z,{theme:"primary",type:"submit",disabled:v,block:!0},void 0,t(p,{id:"edit_profile.save",defaultMessage:"Save"})))))};export{_e as default};
