import{u as _,fX as ae,p as y,_ as e,T as te,n as M,c as w,b4 as se,a8 as f,G as b,H as S,fY as oe,fZ as ne,r as R,f_ as ie,eQ as W,f$ as re,g0 as de,N as I,R as C,ak as $,al as m,t as Q,K as r,dS as ce,bq as V,f as le,b9 as Y,g1 as ue,cA as q,aI as E,g2 as N,c7 as me,cj as pe,bO as ge,d3 as ve,cQ as J,U as he,aJ as X,g3 as fe,g4 as be,g5 as T,c9 as _e,af as Me,g6 as we,ck as xe,cl as Ce,g7 as ye,a2 as Re,ff as ke,fg as P}from"../index-961d4ed1.js";import{S as Z}from"./scrollable-list-74021d3b.js";import{A as Ae}from"./authorize-reject-buttons-6cf19ed4.js";import{v as j}from"./download-ac53125a.js";import{d as F}from"./download-2e3dfb39.js";import{v as ee}from"./dots-vertical-68cbc8e2.js";import{A as Se}from"./accordion-3de728a1.js";import"./index-c72bc579.js";import"./load-more-1869fbc1.js";import"./chevron-up-a2cf0d93.js";const z=M({dashboard:{id:"admin_nav.dashboard",defaultMessage:"Dashboard"},reports:{id:"admin_nav.reports",defaultMessage:"Reports"},waitlist:{id:"admin_nav.awaiting_approval",defaultMessage:"Waitlist"}}),Ne=()=>{const t=_(),a=ae(),o=y(n=>n.admin.awaitingApproval.count()),s=y(n=>n.admin.openReports.count()),i=[{name:"/soapbox/admin",text:t.formatMessage(z.dashboard),to:"/soapbox/admin"},{name:"/soapbox/admin/reports",text:t.formatMessage(z.reports),to:"/soapbox/admin/reports",count:s},{name:"/soapbox/admin/approval",text:t.formatMessage(z.waitlist),to:"/soapbox/admin/approval",count:o}];return e(te,{items:i,activeItem:a.path})},Ie=t=>{let{accountId:a}=t;const o=w(),{account:s}=se(a),i=y(c=>c.admin.users.get(a));if(!s)return null;const n=()=>o(oe([s.id])),d=()=>o(ne([s.id]));return e(S,{space:4,justifyContent:"between"},void 0,e(f,{space:1},void 0,e(b,{weight:"semibold"},void 0,"@",s.acct),e(b,{tag:"blockquote",size:"sm"},void 0,(i==null?void 0:i.invite_request)||"")),e(f,{justifyContent:"center"},void 0,e(Ae,{onAuthorize:n,onReject:d,countdown:3e3})))},$e=M({heading:{id:"column.admin.awaiting_approval",defaultMessage:"Awaiting Approval"},emptyMessage:{id:"admin.awaiting_approval.empty_message",defaultMessage:"There is nobody waiting for approval. When a new user signs up, you can review them here."}}),De=()=>{const t=_(),a=w(),o=y(d=>d.admin.awaitingApproval),[s,i]=R.useState(!0);R.useEffect(()=>{a(ie(["local","need_approval"])).then(()=>i(!1)).catch(()=>{})},[]);const n=s&&o.count()===0;return e(Z,{isLoading:s,showLoading:n,scrollKey:"awaiting-approval",emptyMessage:t.formatMessage($e.emptyMessage),className:"divide-y divide-solid divide-gray-200 dark:divide-gray-800"},void 0,o.map(d=>e("div",{className:"px-5 py-4"},d,e(Ie,{accountId:d}))))},Ue=()=>(t,a)=>W(a).get("/api/v1/pleroma/admin/email_list/subscribers.csv"),Le=()=>(t,a)=>W(a).get("/api/v1/pleroma/admin/email_list/unsubscribers.csv"),qe=()=>(t,a)=>W(a).get("/api/v1/pleroma/admin/email_list/combined.csv"),A=t=>{let{count:a,label:o,to:s="#",percent:i=!1}=t;return re(a)?e(I,{className:"flex cursor-pointer flex-col items-center space-y-2 rounded bg-gray-200 p-4 transition-transform hover:-translate-y-1 dark:bg-gray-800",to:s},void 0,e(b,{align:"center",size:"2xl",weight:"medium"},void 0,e(de,{value:a,style:i?"unit":void 0,unit:i?"percent":void 0})),e(b,{align:"center"},void 0,o)):null},Ee=t=>{let{children:a}=t;return e("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2 lg:grid-cols-3"},void 0,a)},Te=t=>{let{onChange:a,children:o}=t;const s=C.Children.map(o,i=>C.cloneElement(i,{onChange:a}));return e($,{},void 0,s)},H=t=>{let{label:a,hint:o,checked:s=!1,onChange:i,value:n}=t;return e(m,{label:a,hint:o},void 0,e("input",{type:"radio",checked:s,onChange:i,value:n,className:"h-4 w-4 border-gray-300 text-primary-600 focus:ring-primary-500"}))},Pe=M({saved:{id:"admin.dashboard.settings_saved",defaultMessage:"Settings saved!"}}),je=t=>[{group:":pleroma",key:":instance",value:{open:[{tuple:[":registrations_open",!0]},{tuple:[":account_approval_required",!1]}],approval:[{tuple:[":registrations_open",!0]},{tuple:[":account_approval_required",!0]}],closed:[{tuple:[":registrations_open",!1]}]}[t]}],Fe=t=>t.approval_required&&t.registrations?"approval":t.registrations?"open":"closed",ze=()=>{const t=_(),a=w(),o=Q(),s=Fe(o);return e(Te,{onChange:n=>{const d=je(n.target.value);a(ce(d)).then(()=>{V.success(t.formatMessage(Pe.saved))}).catch(()=>{})}},void 0,e(H,{label:e(r,{id:"admin.dashboard.registration_mode.open_label",defaultMessage:"Open"}),hint:e(r,{id:"admin.dashboard.registration_mode.open_hint",defaultMessage:"Anyone can join."}),checked:s==="open",value:"open"}),e(H,{label:e(r,{id:"admin.dashboard.registration_mode.approval_label",defaultMessage:"Approval Required"}),hint:e(r,{id:"admin.dashboard.registration_mode.approval_hint",defaultMessage:"Users can sign up, but their account only gets activated when an admin approves it."}),checked:s==="approval",value:"approval"}),e(H,{label:e(r,{id:"admin.dashboard.registration_mode.closed_label",defaultMessage:"Closed"}),hint:e(r,{id:"admin.dashboard.registration_mode.closed_hint",defaultMessage:"Nobody can sign up. You can still invite people."}),checked:s==="closed",value:"closed"}))},He=()=>{const t=w(),a=Q(),o=le(),{account:s}=Y(),i=g=>{t(Ue()).then(v=>{let{data:h}=v;F(h,"subscribers.csv")}).catch(()=>{}),g.preventDefault()},n=g=>{t(Le()).then(v=>{let{data:h}=v;F(h,"unsubscribers.csv")}).catch(()=>{}),g.preventDefault()},d=g=>{t(qe()).then(v=>{let{data:h}=v;F(h,"combined.csv")}).catch(()=>{}),g.preventDefault()},c=ue(a.version),x=a.stats.get("user_count"),u=a.stats.get("status_count"),D=a.stats.get("domain_count"),p=a.pleroma.getIn(["stats","mau"]),U=x&&p?Math.round(p/x*100):void 0;return s?e(f,{space:6,className:"mt-4"},void 0,e(Ee,{},void 0,e(A,{count:p,label:e(r,{id:"admin.dashcounters.mau_label",defaultMessage:"monthly active users"})}),e(A,{to:"/soapbox/admin/users",count:x,label:e(r,{id:"admin.dashcounters.user_count_label",defaultMessage:"total users"})}),e(A,{count:U,label:e(r,{id:"admin.dashcounters.retention_label",defaultMessage:"user retention"}),percent:!0}),e(A,{to:"/timeline/local",count:u,label:e(r,{id:"admin.dashcounters.status_count_label",defaultMessage:"posts"})}),e(A,{count:D,label:e(r,{id:"admin.dashcounters.domain_count_label",defaultMessage:"peers"})})),e($,{},void 0,s.admin&&e(m,{to:"/soapbox/config",label:e(r,{id:"navigation_bar.soapbox_config",defaultMessage:"Soapbox config"})}),e(m,{to:"/soapbox/admin/log",label:e(r,{id:"column.admin.moderation_log",defaultMessage:"Moderation Log"})}),o.announcements&&e(m,{to:"/soapbox/admin/announcements",label:e(r,{id:"column.admin.announcements",defaultMessage:"Announcements"})})),s.admin&&C.createElement(C.Fragment,null,e(q,{title:e(r,{id:"admin.dashboard.registration_mode_label",defaultMessage:"Registrations"})}),e(ze,{})),e(q,{title:e(r,{id:"admin.dashwidgets.software_header",defaultMessage:"Software"})}),e($,{},void 0,e(m,{label:e(r,{id:"admin.software.frontend",defaultMessage:"Frontend"})},void 0,e("a",{href:`${N.url}/tree/${N.ref}`,className:"flex items-center space-x-1 truncate",target:"_blank"},void 0,e("span",{},void 0,N.displayName," ",N.version),e(me,{className:"h-4 w-4",src:pe}))),e(m,{label:e(r,{id:"admin.software.backend",defaultMessage:"Backend"})},void 0,e("span",{},void 0,c.software+(c.build?`+${c.build}`:"")," ",c.version))),o.emailList&&s.admin&&C.createElement(C.Fragment,null,e(q,{title:e(r,{id:"admin.dashwidgets.email_list_header",defaultMessage:"Email list"})}),e($,{},void 0,e(m,{label:"subscribers.csv"},void 0,e(E,{src:j,onClick:i,iconClassName:"h-5 w-5"})),e(m,{label:"unsubscribers.csv"},void 0,e(E,{src:j,onClick:n,iconClassName:"h-5 w-5"})),e(m,{label:"combined.csv"},void 0,e(E,{src:j,onClick:d,iconClassName:"h-5 w-5"}))))):null},Be="/packs/assets/hourglass-empty-0fb26cd3.svg",O=M({viewStatus:{id:"admin.reports.actions.view_status",defaultMessage:"View post"},deleteStatus:{id:"admin.statuses.actions.delete_status",defaultMessage:"Delete post"}}),We=t=>{let{status:a}=t;const o=_(),s=w(),i=()=>{s(fe(o,a.id))},d=(()=>{const c=a.getIn(["account","acct"]);return[{text:o.formatMessage(O.viewStatus,{acct:`@${c}`}),to:`/@${c}/posts/${a.id}`,icon:he},{text:o.formatMessage(O.deleteStatus,{acct:`@${c}`}),action:i,icon:X,destructive:!0}]})();return e(S,{space:2,alignItems:"start"},void 0,e(f,{space:2,className:"overflow-hidden",grow:!0},void 0,e(ge,{status:a}),e(ve,{status:a})),e("div",{className:"flex-none"},void 0,e(J,{items:d,src:ee})))},B=M({reportClosed:{id:"admin.reports.report_closed_message",defaultMessage:"Report on @{name} was closed"},deactivateUser:{id:"admin.users.actions.deactivate_user",defaultMessage:"Deactivate @{name}"},deleteUser:{id:"admin.users.actions.delete_user",defaultMessage:"Delete @{name}"}}),Ge=t=>{let{id:a}=t;const o=_(),s=w(),i=R.useCallback(be(),[]),n=y(l=>i(l,a)),[d,c]=R.useState(!1);if(!n)return null;const x=n.account,u=n.target_account,D=()=>[{text:o.formatMessage(B.deactivateUser,{name:u.username}),action:U,icon:Be},{text:o.formatMessage(B.deleteUser,{name:u.username}),action:g,icon:X,destructive:!0}],p=()=>{s(we([n.id])).then(()=>{const l=o.formatMessage(B.reportClosed,{name:u.username});V.success(l)}).catch(()=>{})},U=()=>{const l=u.id;s(xe(o,l,()=>p()))},g=()=>{const l=u.id;s(Ce(o,l,()=>p()))},v=l=>{c(l)},h=D(),G=n.statuses,K=G.count(),k=u.acct,L=x.acct;return e(S,{space:3,className:"p-3"},n.id,e(T,{accountId:u.id,inline:!0},void 0,e(I,{to:`/@${k}`,title:k},void 0,e(_e,{src:u.avatar,size:32,className:"overflow-hidden"}))),e(f,{space:3,className:"overflow-hidden",grow:!0},void 0,e(b,{tag:"h4",weight:"bold"},void 0,e(r,{id:"admin.reports.report_title",defaultMessage:"Report on {acct}",values:{acct:e(T,{accountId:u.id,inline:!0},void 0,e(I,{to:`/@${k}`,title:k},void 0,"@",k))}})),K>0&&e(Se,{headline:`Reported posts (${K})`,expanded:d,onToggle:v},void 0,e(f,{space:4},void 0,G.map(l=>e(We,{report:n,status:l},l.id)))),e(f,{},void 0,(n.comment||"").length>0&&e(b,{tag:"blockquote",dangerouslySetInnerHTML:{__html:n.comment}}),e(S,{space:1},void 0,e(b,{theme:"muted",tag:"span"},void 0,"—"),e(T,{accountId:x.id,inline:!0},void 0,e(I,{to:`/@${L}`,title:L,className:"text-primary-600 hover:underline dark:text-accent-blue"},void 0,"@",L))))),e(S,{space:2,alignItems:"start",className:"flex-none"},void 0,e(Me,{onClick:p},void 0,e(r,{id:"admin.reports.actions.close",defaultMessage:"Close"})),e(J,{items:h,src:ee})))},Ke=M({heading:{id:"column.admin.reports",defaultMessage:"Reports"},modlog:{id:"column.admin.reports.menu.moderation_log",defaultMessage:"Moderation Log"},emptyMessage:{id:"admin.reports.empty_message",defaultMessage:"There are no open reports. If a user gets reported, they will show up here."}}),Oe=()=>{const t=_(),a=w(),[o,s]=R.useState(!0),i=y(d=>d.admin.openReports.toList());R.useEffect(()=>{a(ye()).then(()=>s(!1)).catch(()=>{})},[]);const n=o&&i.count()===0;return e(Z,{isLoading:o,showLoading:n,scrollKey:"admin-reports",emptyMessage:t.formatMessage(Ke.emptyMessage),className:"divide-y divide-solid divide-gray-200 dark:divide-gray-800"},void 0,i.map(d=>d&&e(Ge,{id:d},d)))},Qe=M({heading:{id:"column.admin.dashboard",defaultMessage:"Dashboard"}}),na=()=>{const t=_(),{account:a}=Y();return a?e(Re,{label:t.formatMessage(Qe.heading),withHeader:!1},void 0,e(Ne,{}),e(ke,{},void 0,e(P,{path:"/soapbox/admin",exact:!0,component:He}),e(P,{path:"/soapbox/admin/reports",exact:!0,component:Oe}),e(P,{path:"/soapbox/admin/approval",exact:!0,component:De}))):null};export{na as default};
