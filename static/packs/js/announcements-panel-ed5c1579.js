import{q as S,r as g,R as x,d as R,_ as o,g0 as w,dy as h,iQ as A,iR as b,j as F,a1 as M,iS as _,f as D,G as N,d4 as E,a8 as L,X as I,cG as Y,c as $,p as k,b0 as P,H,K,iT as T,iU as z}from"../index-961d4ed1.js";import{R as G}from"./index-c8dcab95.js";import{W as V}from"./widget-a1deeca4.js";import"./warning-07d0fac9.js";import"./arrow-right-b75290c7.js";const q=r=>{let{announcement:t}=r;const n=S(),u=g.useRef(null);g.useEffect(()=>{c()});const l=(a,e)=>{e.button===0&&!(e.ctrlKey||e.metaKey)&&(e.preventDefault(),e.stopPropagation(),n.push(`/@${a.acct}`))},d=(a,e)=>{a=a.replace(/^#/,"").toLowerCase(),e.button===0&&!(e.ctrlKey||e.metaKey)&&(e.preventDefault(),e.stopPropagation(),n.push(`/tags/${a}`))},s=(a,e)=>{e.button===0&&!(e.ctrlKey||e.metaKey)&&(e.preventDefault(),n.push(a))},c=()=>{if(!u.current)return;u.current.querySelectorAll("a").forEach(e=>{var f,i,v;if(e.classList.contains("status-link"))return;e.classList.add("status-link"),e.setAttribute("rel","nofollow noopener"),e.setAttribute("target","_blank");const m=t.mentions.find(p=>e.href===`${p.url}`);if(m)e.addEventListener("click",l.bind(e,m),!1),e.setAttribute("title",m.acct);else if(((f=e.textContent)==null?void 0:f.charAt(0))==="#"||((v=(i=e.previousSibling)==null?void 0:i.textContent)==null?void 0:v.charAt(e.previousSibling.textContent.length-1))==="#")e.addEventListener("click",d.bind(e,e.text),!1);else{const p=t.statuses.get(e.href);p&&e.addEventListener("click",s.bind(void 0,p),!1),e.setAttribute("title",e.href),e.classList.add("unhandled-link")}})};return x.createElement("div",{className:"translate text-sm",ref:u,dangerouslySetInnerHTML:{__html:t.contentHtml}})},j=r=>r<0?0:r<=1?r:"1+",W=r=>{let{value:t,obfuscate:n}=r;const u=R().get("reduceMotion"),[l,d]=g.useState(1),[s,c]=g.useState(t);g.useEffect(()=>{s!==void 0&&(t>s?d(1):t<s&&d(-1)),c(t)},[t]);const a=()=>({y:-1*l}),e=()=>({y:h(1*l,{damping:35,stiffness:400})});if(u)return n?x.createElement(x.Fragment,null,j(s)):o(w,{value:s});const m=[{key:`${s}`,data:s,style:{y:h(0,{damping:35,stiffness:400})}}];return o(A,{styles:m,willEnter:a,willLeave:e},void 0,f=>o("span",{className:"relative inline-flex flex-col items-stretch overflow-hidden"},void 0,f.map(i=>{let{key:v,data:p,style:y}=i;return o("span",{style:{position:l*y.y>0?"absolute":"static",transform:`translateY(${y.y*100}%)`}},v,n?j(p):o(w,{value:p}))})))},B=r=>{let{emoji:t,emojiMap:n,hovered:u}=r;const l=R().get("autoPlayGif");if(b[t]){const{filename:d,shortCode:s}=b[t],c=s?`:${s}:`:"";return o("img",{draggable:"false",className:"emojione m-0 block",alt:t,title:c,src:F(`packs/emoji/${d}.svg`)})}else if(n.get(t)){const d=l||u?n.getIn([t,"url"]):n.getIn([t,"static_url"]),s=`:${t}:`;return o("img",{draggable:"false",className:"emojione m-0 block",alt:s,title:s,src:d})}else return null},Q=r=>{let{announcementId:t,reaction:n,addReaction:u,removeReaction:l,emojiMap:d,style:s}=r;const[c,a]=g.useState(!1),e=()=>{n.me?l(t,n.name):u(t,n.name)},m=()=>a(!0),f=()=>a(!1);let i=n.name;return b[i]&&(i=b[i].shortCode),o("button",{className:M("flex shrink-0 items-center gap-1.5 rounded-sm bg-gray-100 px-1.5 py-1 transition-colors dark:bg-primary-900",{"bg-gray-200 dark:bg-primary-800":c,"bg-primary-200 dark:bg-primary-500":n.me}),onClick:e,onMouseEnter:m,onMouseLeave:f,title:`:${i}:`,style:s},void 0,o("span",{className:"block h-4 w-4"},void 0,o(B,{hovered:c,emoji:n.name,emojiMap:d})),o("span",{className:"block min-w-[9px] text-center text-xs font-medium text-primary-600 dark:text-white"},void 0,o(W,{value:n.count})))},U=r=>{let{announcementId:t,reactions:n,addReaction:u,removeReaction:l,emojiMap:d}=r;const s=R().get("reduceMotion"),c=i=>{u(t,i.native.replace(/:/g,""))},a=()=>({scale:s?1:0}),e=()=>({scale:s?0:h(0,{stiffness:170,damping:26})}),m=n.filter(i=>i.count>0),f=m.map(i=>({key:i.name,data:i,style:{scale:s?1:h(1,{stiffness:150,damping:13})}})).toArray();return o(A,{styles:f,willEnter:a,willLeave:e},void 0,i=>o("div",{className:M("flex flex-wrap items-center gap-1",{"reactions-bar--empty":m.isEmpty()})},void 0,i.map(v=>{let{key:p,data:y,style:C}=v;return o(Q,{reaction:y,style:{transform:`scale(${C.scale})`,position:C.scale<.5?"absolute":"static"},announcementId:t,addReaction:u,removeReaction:l,emojiMap:d},p)}),m.size<8&&o(_,{onPickEmoji:c})))},X=r=>{let{announcement:t,addReaction:n,removeReaction:u,emojiMap:l}=r;const d=D(),s=t.starts_at&&new Date(t.starts_at),c=t.ends_at&&new Date(t.ends_at),a=new Date,e=s&&c,m=e&&s.getFullYear()===c.getFullYear()&&c.getFullYear()===a.getFullYear(),f=e&&s.getDate()===c.getDate()&&s.getMonth()===c.getMonth()&&s.getFullYear()===c.getFullYear(),i=t.all_day;return o(L,{className:"w-full",space:2},void 0,e&&o(N,{theme:"muted"},void 0,o(E,{value:s,hour12:!0,year:m||s.getFullYear()===a.getFullYear()?void 0:"numeric",month:"short",day:"2-digit",hour:i?void 0:"numeric",minute:i?void 0:"2-digit"})," ","-"," ",o(E,{value:c,hour12:!0,year:m||c.getFullYear()===a.getFullYear()?void 0:"numeric",month:f?void 0:"short",day:f?void 0:"2-digit",hour:i?void 0:"numeric",minute:i?void 0:"2-digit"})),o(q,{announcement:t}),d.announcementsReactions&&o(U,{reactions:t.reactions,announcementId:t.id,addReaction:n,removeReaction:u,emojiMap:l}))},J=I([r=>r.custom_emojis],r=>r.reduce((t,n)=>t.set(n.get("shortcode"),n),Y())),se=()=>{const r=$(),t=k(a=>J(a)),[n,u]=g.useState(0),l=k(a=>a.announcements.items),d=(a,e)=>r(T(a,e)),s=(a,e)=>r(z(a,e));return l.size===0?null:o(V,{title:o(K,{id:"announcements.title",defaultMessage:"Announcements"})},void 0,o(P,{className:"relative",size:"md",variant:"rounded"},void 0,o(G,{animateHeight:!0,index:n,onChangeIndex:a=>{u(a%l.size)}},void 0,l.map(a=>o(X,{announcement:a,emojiMap:t,addReaction:d,removeReaction:s},a.id)).reverse()),l.size>1&&o(H,{space:2,alignItems:"center",justifyContent:"center",className:"relative"},void 0,l.map((a,e)=>o("button",{tabIndex:0,onClick:()=>u(e),className:M({"w-2 h-2 rounded-full focus:ring-primary-600 focus:ring-2 focus:ring-offset-2":!0,"bg-gray-200 hover:bg-gray-300":e!==n,"bg-primary-600":e===n})},e)))))};export{se as default};
