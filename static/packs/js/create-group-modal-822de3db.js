import{bk as V,j_ as Y,bn as J,bm as X,f as Z,cu as ee,u as I,_ as e,a8 as p,c9 as ae,G as l,dV as te,K as r,H as q,af as j,k2 as se,gW as re,jl as oe,bq as K,n as A,t as ne,p as ie,bG as G,b_ as de,bH as ce,bF as U,ey as le,R as D,ak as ue,al as z,r as C,bv as ge,k3 as me,jK as W}from"../index-961d4ed1.js";import{u as $}from"./useDebounce-0a090d55.js";import{u as L,H as pe,A as he}from"./header-picker-3bbb9670.js";import{G as fe}from"./group-tags-field-a7f2a533.js";import"./photo-plus-d58838d9.js";import"./streamfield-e3bece9e.js";function ve(){const t=V(),{createEntity:a,...s}=Y([J.GROUPS,"search",""],n=>t.post("/api/v1/groups",n,{headers:{"Content-Type":"multipart/form-data"}}),{schema:X});return{createGroup:a,...s}}const be={validation:t=>["group","validation",t]};function B(t=""){var c;const a=V(),s=Z(),n=async()=>{const{data:u}=await a.get("/api/v1/groups/validate",{params:{name:t}}).catch(m=>{if(m.response.status===422)return{data:m.response.data};throw m});return u},d=ee(be.validation(t),n,{enabled:s.groupsValidation&&!!t});return{...d,data:{...d.data,isValid:!((c=d.data)!=null&&c.error)}}}const _e=A({copied:{id:"copy.success",defaultMessage:"Copied to clipboard!"}}),ye=t=>{let{group:a}=t;const s=I(),n=()=>{oe(a==null?void 0:a.url,()=>{K.success(s.formatMessage(_e.copied))})},d=()=>{navigator.share({text:a==null?void 0:a.display_name,url:a==null?void 0:a.uri}).catch(c=>{c.name!=="AbortError"&&console.error(c)})};return a?e(p,{space:9},void 0,e(p,{space:3},void 0,e(p,{},void 0,e("label",{className:"dark:sm:shadow-inset relative h-24 w-full cursor-pointer overflow-hidden rounded-lg bg-primary-100 text-primary-500 dark:bg-gray-800 dark:text-accent-blue sm:h-36 sm:shadow"},void 0,a.header&&e("img",{className:"h-full w-full object-cover",src:a.header,alt:""})),e("label",{className:"mx-auto -mt-10 cursor-pointer rounded-full bg-primary-500 ring-2 ring-white dark:ring-primary-900"},void 0,a.avatar&&e(ae,{src:a.avatar,size:80}))),e(p,{},void 0,e(l,{size:"2xl",weight:"bold",align:"center"},void 0,a.display_name),e(l,{size:"md",className:"mx-auto max-w-sm [&_a]:text-primary-600 [&_a]:hover:underline [&_a]:dark:text-accent-blue",dangerouslySetInnerHTML:{__html:a.note_emojified}}))),e(te,{}),e(p,{space:4},void 0,e(l,{size:"3xl",weight:"bold",align:"center"},void 0,e(r,{id:"manage_group.confirmation.title",defaultMessage:"You’re all set!"})),e(p,{space:5},void 0,e(k,{number:1},void 0,e(l,{theme:"muted"},void 0,e(r,{id:"manage_group.confirmation.info_1",defaultMessage:"As the owner of this group, you can assign staff, delete posts and much more."}))),e(k,{number:2},void 0,e(l,{theme:"muted"},void 0,e(r,{id:"manage_group.confirmation.info_2",defaultMessage:"Post the group's first post and get the conversation started."}))),e(k,{number:3},void 0,e(l,{theme:"muted"},void 0,e(r,{id:"manage_group.confirmation.info_3",defaultMessage:"Share your new group with friends, family and followers to grow its membership."}))))),e(q,{space:2,justifyContent:"center"},void 0,"share"in navigator&&e(j,{onClick:d,theme:"transparent",icon:se,className:"text-primary-600"},void 0,e(r,{id:"manage_group.confirmation.share",defaultMessage:"Share this group"})),e(j,{onClick:n,theme:"transparent",icon:re,className:"text-primary-600"},void 0,e(r,{id:"manage_group.confirmation.copy",defaultMessage:"Copy link"})))):null},Me=t=>{let{number:a}=t;return e("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full border border-gray-200 dark:border-gray-800"},void 0,e(l,{theme:"primary",size:"sm",weight:"bold"},void 0,a))},k=t=>{let{number:a,children:s}=t;return e(q,{alignItems:"top",space:3},void 0,e(Me,{number:a}),e("div",{className:"mt-0.5"},void 0,s))},F=A({groupNamePlaceholder:{id:"manage_group.fields.name_placeholder",defaultMessage:"Group Name"},groupDescriptionPlaceholder:{id:"manage_group.fields.description_placeholder",defaultMessage:"Description"},hashtagPlaceholder:{id:"manage_group.fields.hashtag_placeholder",defaultMessage:"Add a topic"}}),xe=t=>{var b;let{params:a,onChange:s}=t;const n=I(),d=$,c=ne(),{display_name:u="",note:m="",tags:g=[""]}=a,_=d(u,300),{data:{isValid:T,message:w}}=B(_),N=L(a.avatar),E=L(a.header),v=(b=ie(i=>i.instance.configuration.getIn(["media_attachments","supported_mime_types"])))==null?void 0:b.filter(i=>i.startsWith("image/")).toArray().join(","),y=i=>f=>{s({...a,[i]:f.target.value})},M=(i,f)=>async R=>{const H=R?R[0]:void 0;if(H){const Q=await le(H,f);s({...a,[i]:Q})}},S=i=>()=>s({[i]:void 0}),O=i=>{s({...a,tags:i})},h=()=>{s({...a,tags:[...g,""]})},x=i=>{const f=[...g];f.splice(i,1),s({...a,tags:f})};return e(U,{},void 0,e("div",{className:"relative mb-12 flex"},void 0,e(pe,{src:E,accept:v,onChange:M("header",1920*1080),onClear:S("header")}),e(he,{src:N,accept:v,onChange:M("avatar",400*400)})),e(G,{labelText:e(r,{id:"manage_group.fields.name_label",defaultMessage:"Group name (required)"}),hintText:e(r,{id:"manage_group.fields.name_help",defaultMessage:"This cannot be changed after the group is created."}),errors:T?[]:[w]},void 0,e(ce,{type:"text",placeholder:n.formatMessage(F.groupNamePlaceholder),value:u,onChange:y("display_name"),maxLength:Number(c.configuration.getIn(["groups","max_characters_name"]))})),e(G,{labelText:e(r,{id:"manage_group.fields.description_label",defaultMessage:"Description"})},void 0,e(de,{autoComplete:"off",placeholder:n.formatMessage(F.groupDescriptionPlaceholder),value:m,onChange:y("note"),maxLength:Number(c.configuration.getIn(["groups","max_characters_description"]))})),e("div",{className:"pb-6"},void 0,e(fe,{tags:g,onChange:O,onAddItem:h,onRemoveItem:x})))},Ce=t=>{let{params:a,onChange:s}=t;const n=a.group_visibility||"everyone",d=c=>{s({...a,group_visibility:c})};return D.createElement(D.Fragment,null,e(p,{className:"mx-auto max-w-xs py-10",space:2},void 0,e(l,{size:"3xl",weight:"bold",align:"center"},void 0,e(r,{id:"manage_group.get_started",defaultMessage:"Let’s get started!"})),e(l,{theme:"muted",align:"center"},void 0,e(r,{id:"manage_group.tagline",defaultMessage:"Groups connect you with others based on shared interests."}))),e(U,{},void 0,e(G,{labelText:e(r,{id:"manage_group.privacy.label",defaultMessage:"Privacy settings"})},void 0,e(ue,{},void 0,e(z,{label:e(l,{weight:"medium"},void 0,e(r,{id:"manage_group.privacy.public.label",defaultMessage:"Public"})),hint:e(r,{id:"manage_group.privacy.public.hint",defaultMessage:"Discoverable. Anyone can join."}),onSelect:()=>d("everyone"),isSelected:n==="everyone"}),e(z,{label:e(l,{weight:"medium"},void 0,e(r,{id:"manage_group.privacy.private.label",defaultMessage:"Private (Owner approval required)"})),hint:e(r,{id:"manage_group.privacy.private.hint",defaultMessage:"Discoverable. Users can join after their request is approved."}),onSelect:()=>d("members_only"),isSelected:n==="members_only"}))),e(l,{size:"sm",theme:"muted",align:"center"},void 0,e(r,{id:"manage_group.privacy.hint",defaultMessage:"These settings cannot be changed later."}))))},P=A({next:{id:"manage_group.next",defaultMessage:"Next"},create:{id:"manage_group.create",defaultMessage:"Create Group"},done:{id:"manage_group.done",defaultMessage:"Done"}});var o=function(t){return t.ONE="ONE",t.TWO="TWO",t.THREE="THREE",t}(o||{});const Pe=t=>{let{onClose:a}=t;const s=I(),n=$,[d,c]=C.useState(null),[u,m]=C.useState({group_visibility:"everyone"}),[g,_]=C.useState(o.ONE),{createGroup:T,isSubmitting:w}=ve(),N=n(u.display_name||"",300),{data:{isValid:E}}=B(N),v=()=>{a("MANAGE_GROUP")},y=C.useMemo(()=>{switch(g){case o.THREE:return s.formatMessage(P.done);case o.TWO:return s.formatMessage(P.create);default:return s.formatMessage(P.next)}},[g]),M=()=>{switch(g){case o.ONE:_(o.TWO);break;case o.TWO:T(u,{onSuccess(h){_(o.THREE),c(h)},onError(h){var x;if(h instanceof me){const b=W.object({error:W.string()}).safeParse((x=h.response)==null?void 0:x.data);b.success&&K.error(b.data.error)}}});break;case o.THREE:v();break}},S=()=>{switch(g){case o.ONE:return e(Ce,{params:u,onChange:m});case o.TWO:return e(xe,{params:u,onChange:m});case o.THREE:return e(ye,{group:d})}};return e(ge,{title:(()=>{switch(g){case o.ONE:return e(r,{id:"navigation_bar.create_group",defaultMessage:"Create Group"});default:return u.group_visibility==="everyone"?e(r,{id:"navigation_bar.create_group.public",defaultMessage:"Create Public Group"}):e(r,{id:"navigation_bar.create_group.private",defaultMessage:"Create Private Group"})}})(),confirmationAction:M,confirmationText:y,confirmationDisabled:w||g===o.TWO&&!E,confirmationFullWidth:!0,onClose:v},void 0,e(p,{space:2},void 0,S()))};export{Pe as default};
