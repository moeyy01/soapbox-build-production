import{R as b,H as C,ay as P,_ as e,G as m,aI as B,cR as F,c as $,u as M,f as O,e_ as x,f0 as V,p as G,c7 as k,dt as E,a8 as p,f8 as W,f9 as j,ak as X,al as K,fT as Q,fU as Y,c9 as U,n as w,fR as u,C as I,c6 as J,fa as Z,f2 as H,r as L,N as z,cB as ee,f1 as te,c8 as ae,fd as q,a1 as se,af as oe,fV as ne,e$ as ie,K as ce,b9 as le,q as re,fh as de}from"../index-961d4ed1.js";import{u as ue}from"./useDebounce-0a090d55.js";import{C as ge,a as me,c as he,E as fe,b as pe}from"./chat-search-input-5b40be23.js";import{v as ve}from"./chevron-up-a2cf0d93.js";import"./index-c72bc579.js";import"./mood-smile-6a052395.js";import"./lodash-d2d72341.js";import"./pull-to-refresh-b67e1521.js";const N=s=>{const{isOpen:a,isToggleable:n=!0,onToggle:t,secondaryAction:c,secondaryActionIcon:o,title:h,unreadCount:d,...r}=s,f=n?"button":"div",i={};return n&&(i.onClick=t),b.createElement(C,P({},r,{alignItems:"center",justifyContent:"between",className:"h-16 rounded-t-xl px-4 py-3"}),b.createElement(f,P({className:"flex h-16 grow flex-row items-center space-x-1","data-testid":"title"},i),e(m,{weight:"semibold",tag:"div"},void 0,h),typeof d<"u"&&d>0&&e(C,{alignItems:"center",space:2},void 0,e(m,{weight:"semibold","data-testid":"unread-count"},void 0,"(",d,")"),e("div",{className:"h-2.5 w-2.5 rounded-full bg-accent-300"}))),e(C,{space:2,alignItems:"center"},void 0,c?e(B,{onClick:c,src:o,iconClassName:"h-5 w-5 text-gray-600"}):null,e(B,{onClick:t,src:a?F:ve,iconClassName:"h-5 w-5 text-gray-600"})))},l=w({blockMessage:{id:"chat_settings.block.message",defaultMessage:"Blocking will prevent this profile from direct messaging you and viewing your content. You can unblock later."},blockHeading:{id:"chat_settings.block.heading",defaultMessage:"Block @{acct}"},blockConfirm:{id:"chat_settings.block.confirm",defaultMessage:"Block"},unblockMessage:{id:"chat_settings.unblock.message",defaultMessage:"Unblocking will allow this profile to direct message you and view your content."},unblockHeading:{id:"chat_settings.unblock.heading",defaultMessage:"Unblock @{acct}"},unblockConfirm:{id:"chat_settings.unblock.confirm",defaultMessage:"Unblock"},leaveMessage:{id:"chat_settings.leave.message",defaultMessage:"Are you sure you want to leave this chat? Messages will be deleted for you and this chat will be removed from your inbox."},leaveHeading:{id:"chat_settings.leave.heading",defaultMessage:"Leave Chat"},leaveConfirm:{id:"chat_settings.leave.confirm",defaultMessage:"Leave Chat"},title:{id:"chat_settings.title",defaultMessage:"Chat Details"},blockUser:{id:"chat_settings.options.block_user",defaultMessage:"Block @{acct}"},unblockUser:{id:"chat_settings.options.unblock_user",defaultMessage:"Unblock @{acct}"},leaveChat:{id:"chat_settings.options.leave_chat",defaultMessage:"Leave Chat"},autoDeleteLabel:{id:"chat_settings.auto_delete.label",defaultMessage:"Auto-delete messages"},autoDeleteDays:{id:"chat_settings.auto_delete.days",defaultMessage:"{day, plural, one {# day} other {# days}}"}}),Ce=()=>{const s=$(),a=M(),n=O(),{chat:t,changeScreen:c,toggleChatPane:o}=x(),{deleteChat:h,updateChat:d}=V(t==null?void 0:t.id),r=g=>d.mutate({message_expiration:g}),f=G(g=>{var v;return g.getIn(["relationships",(v=t==null?void 0:t.account)==null?void 0:v.id,"blocking"])}),i=()=>{c(u.CHAT,t==null?void 0:t.id)},y=()=>{i(),o()},_=()=>{s(I("CONFIRM",{heading:a.formatMessage(l.blockHeading,{acct:t==null?void 0:t.account.acct}),message:a.formatMessage(l.blockMessage),confirm:a.formatMessage(l.blockConfirm),confirmationTheme:"primary",onConfirm:()=>s(J(t==null?void 0:t.account.id))}))},S=()=>{s(I("CONFIRM",{heading:a.formatMessage(l.unblockHeading,{acct:t==null?void 0:t.account.acct}),message:a.formatMessage(l.unblockMessage),confirm:a.formatMessage(l.unblockConfirm),confirmationTheme:"primary",onConfirm:()=>s(Z(t==null?void 0:t.account.id))}))},T=()=>{s(I("CONFIRM",{heading:a.formatMessage(l.leaveHeading),message:a.formatMessage(l.leaveMessage),confirm:a.formatMessage(l.leaveConfirm),confirmationTheme:"primary",onConfirm:()=>h.mutate()}))};return t?b.createElement(b.Fragment,null,e(N,{isOpen:!0,isToggleable:!1,onToggle:y,title:e(C,{alignItems:"center",space:2},void 0,e("button",{onClick:i},void 0,e(k,{src:E,className:"h-6 w-6 text-gray-600 dark:text-gray-400"})),e(m,{weight:"semibold"},void 0,a.formatMessage(l.title)))}),e(p,{space:4,className:"mx-auto w-5/6"},void 0,e(C,{alignItems:"center",space:3},void 0,e(U,{src:t.account.avatar_static,size:50}),e(p,{},void 0,e(m,{weight:"semibold"},void 0,t.account.display_name),e(m,{size:"sm",theme:"primary"},void 0,"@",t.account.acct))),n.chatsExpiration&&e(X,{},void 0,e(K,{label:a.formatMessage(l.autoDeleteLabel)},void 0,e(Q,{defaultValue:t.message_expiration,onChange:g=>r(Number(g.target.value))},void 0,Y.map(g=>{const v=H(g);return e("option",{value:g},g,a.formatMessage(l.autoDeleteDays,{day:v}))})))),e(p,{space:5},void 0,e("button",{onClick:f?S:_,className:"flex w-full items-center space-x-2 text-sm font-bold text-primary-600 dark:text-accent-blue"},void 0,e(k,{src:W,className:"h-5 w-5"}),e("span",{},void 0,a.formatMessage(f?l.unblockUser:l.blockUser,{acct:t.account.acct}))),n.chatsDelete&&e("button",{onClick:T,className:"flex w-full items-center space-x-2 text-sm font-bold text-danger-600"},void 0,e(k,{src:j,className:"h-5 w-5"}),e("span",{},void 0,a.formatMessage(l.leaveChat)))))):null},D=w({autoDeleteMessage:{id:"chat_window.auto_delete_label",defaultMessage:"Auto-delete after {day, plural, one {# day} other {# days}}"},autoDeleteMessageTooltip:{id:"chat_window.auto_delete_tooltip",defaultMessage:"Chat messages are set to auto-delete after {day, plural, one {# day} other {# days}} upon sending."}}),be=s=>{let{enabled:a,to:n,children:t}=s;return a?e(z,{to:n},void 0,t):b.createElement(b.Fragment,null,t)},ye=()=>{const s=M(),{chat:a,currentChatId:n,screen:t,changeScreen:c,isOpen:o,needsAcceptance:h,toggleChatPane:d}=x(),r=L.useRef(null),f=()=>{c(u.INBOX)},i=()=>{d(),c(u.SEARCH)},y=()=>{c(u.CHAT_SETTINGS,n)},_=()=>{if(!h)return o?y:i};return a?t===u.CHAT_SETTINGS?e(Ce,{}):b.createElement(b.Fragment,null,e(N,{title:e(C,{alignItems:"center",space:2},void 0,o&&e("button",{onClick:f},void 0,e(k,{src:E,className:"h-6 w-6 text-gray-600 dark:text-gray-400"})),e(C,{alignItems:"center",space:3},void 0,o&&e(z,{to:`/@${a.account.acct}`},void 0,e(U,{src:a.account.avatar,size:40})),e(p,{alignItems:"start"},void 0,e(be,{enabled:o,to:`/@${a.account.acct}`},void 0,e("div",{className:"flex grow items-center space-x-1"},void 0,e(m,{size:"sm",weight:"bold",truncate:!0},void 0,a.account.display_name||`@${a.account.acct}`),a.account.verified&&e(ee,{}))),a.message_expiration&&e(te,{text:s.formatMessage(D.autoDeleteMessageTooltip,{day:H(a.message_expiration)})},void 0,e(m,{size:"sm",weight:"medium",theme:"primary",truncate:!0,className:"cursor-help"},void 0,s.formatMessage(D.autoDeleteMessage,{day:H(a.message_expiration)})))))),secondaryAction:_(),secondaryActionIcon:o?ae:q,isToggleable:!o,isOpen:o,onToggle:d}),e(p,{className:"h-full grow overflow-hidden",space:2},void 0,e(ge,{chat:a,inputRef:r}))):null},_e=w({title:{id:"chat_search.title",defaultMessage:"Messages"}}),ke=()=>{const s=M(),{changeScreen:a,isOpen:n,toggleChatPane:t}=x();return e(N,{"data-testid":"pane-header",title:e(C,{alignItems:"center",space:2},void 0,e("button",{onClick:()=>{a(u.INBOX)}},void 0,e(k,{src:E,className:"h-6 w-6 text-gray-600 dark:text-gray-400"})),e(m,{size:"sm",weight:"bold",truncate:!0},void 0,s.formatMessage(_e.title))),isOpen:n,isToggleable:!1,onToggle:t})},A=s=>{let{isOpen:a=!1,index:n,children:t,main:c=!1}=s;const o=404*n+20;return e("div",{className:se("fixed bottom-0 right-1 z-[99] flex w-96 flex-col rounded-t-lg bg-white shadow-3xl dark:bg-gray-900",{"h-[550px] max-h-[100vh]":a,"h-16":!a}),style:{right:`${o}px`},"data-testid":"pane"},void 0,t)},R=w({title:{id:"chat_search.empty_results_blankslate.title",defaultMessage:"No messages yet"},body:{id:"chat_search.empty_results_blankslate.body",defaultMessage:"Search for someone to chat with."},action:{id:"chat_search.empty_results_blankslate.action",defaultMessage:"Message someone"}}),Me=s=>{let{onSearch:a}=s;const n=M();return e(p,{alignItems:"center",justifyContent:"center",className:"h-full grow","data-testid":"chat-pane-blankslate"},void 0,e(p,{space:4},void 0,e(p,{space:1,className:"mx-auto max-w-[80%]"},void 0,e(m,{size:"lg",weight:"bold",align:"center"},void 0,n.formatMessage(R.title)),e(m,{theme:"muted",align:"center"},void 0,n.formatMessage(R.body))),e("div",{className:"mx-auto"},void 0,e(oe,{theme:"primary",onClick:a},void 0,n.formatMessage(R.action)))))},xe=()=>{const s=O(),a=ue,{unreadChatsCount:n}=ne(),[t,c]=L.useState(),o=a(t,300),{screen:h,changeScreen:d,isOpen:r,toggleChatPane:f}=x(),{chatsQuery:{data:i,isLoading:y}}=ie(o),_=Number(o==null?void 0:o.length)>0,S=v=>{d(u.CHAT,v.id),c(void 0)},T=()=>{_&&c("")},g=()=>{if(_||Number(i==null?void 0:i.length)>0||y)return e(p,{space:4,className:"h-full grow"},void 0,s.chatsSearch&&e("div",{className:"px-4"},void 0,e(pe,{value:t||"",onChange:v=>c(v.target.value),onClear:T})),Number(i==null?void 0:i.length)>0||y?e(he,{searchValue:o,onClickChat:S}):e(fe,{}));if((i==null?void 0:i.length)===0)return e(Me,{onSearch:()=>{d(u.SEARCH)}})};return h===u.CHAT||h===u.CHAT_SETTINGS?e(A,{isOpen:r,index:0,main:!0},void 0,e(ye,{})):h===u.SEARCH?e(A,{isOpen:r,index:0,main:!0},void 0,e(ke,{}),r?e(me,{}):null):e(A,{isOpen:r,index:0,main:!0},void 0,e(N,{title:e(ce,{id:"column.chats",defaultMessage:"Chats"}),unreadCount:n,isOpen:r,onToggle:f,secondaryAction:()=>{d(u.SEARCH),c(void 0),r||f()},secondaryActionIcon:q}),r?g():null)},Ee=()=>{var o;const{account:s}=le(),t=!!re().location.pathname.match(/^\/chats/);return!(((o=s==null?void 0:s.source)==null?void 0:o.chats_onboarded)??!0)||t?null:e(de,{},void 0,e(xe,{}))};export{Ee as default};
