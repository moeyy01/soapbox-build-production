var qe=Object.defineProperty;var $e=(u,n,r)=>n in u?qe(u,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[n]=r;var q=(u,n,r)=>($e(u,typeof n!="symbol"?n+"":n,r),r);import{v as ze}from"./download-ac53125a.js";import{v as Be}from"./volume-08f8a8f1.js";import{u as Ke,r as a,Z as Ve,cn as X,R as C,a1 as Y,_ as c,I as J,dr as He,ds as Ue,n as Fe}from"../index-961d4ed1.js";import{g as ye,v as We,f as _e}from"./index-a24feb75.js";import"./arrows-minimize-7c27a12c.js";import"./media-aspect-ratio-df6a7bb1.js";const je=(u,n=1)=>{const[r,s,l]=u.match(/\w\w/g).map(v=>parseInt(v,16));return`rgba(${r}, ${s}, ${l}, ${n})`};class Ge{constructor(n){q(this,"tickSize");q(this,"canvas");q(this,"context");q(this,"analyser");this.tickSize=n}setCanvas(n){this.canvas=n,n&&(this.context=n.getContext("2d"))}setAudioContext(n,r){const s=n.createAnalyser();s.smoothingTimeConstant=.6,s.fftSize=2048,r.connect(s),this.analyser=s}getTickPoints(n){const r=[];for(let s=0;s<n;s++){const l=Math.PI*2*s/n;r.push({x:Math.cos(l),y:-Math.sin(l)})}return r}drawTick(n,r,s,l,v,k,f){const w=Math.ceil(n+l),b=Math.ceil(r+v),y=Math.ceil(n+k),g=Math.ceil(r+f),i=this.context.createLinearGradient(w,b,y,g),d=je(s,0);i.addColorStop(0,s),i.addColorStop(.6,s),i.addColorStop(1,d),this.context.beginPath(),this.context.strokeStyle=i,this.context.lineWidth=2,this.context.moveTo(w,b),this.context.lineTo(y,g),this.context.stroke()}getTicks(n,r,s,l){const v=this.getTickPoints(n),k=200,f=[],w=this.analyser?this.analyser.frequencyBinCount:0,b=new Uint8Array(w),y=[];this.analyser&&this.analyser.getByteFrequencyData(b),v.forEach((i,d)=>{const S=1-d/(v.length*2.5);let m=((b[d]||0)-k*S)*l;m<0&&(m=0);const $=s/(s-(r+m)),M=i.x*(s-r),E=i.y*(s-r),U=M*$,F=E*$;if(f.push({x1:M,y1:E,x2:U,y2:F}),d<20){let P=m/(200*l);P=P<1?1:P,y.push(P)}});const g=y.reduce((i,d)=>i+d,0)/y.length;return f.map(({x1:i,y1:d,x2:S,y2:m})=>({x1:i,y1:d,x2:S*g,y2:m*g}))}clear(n,r){this.context.clearRect(0,0,n,r)}draw(n,r,s,l,v){this.context.save(),this.getTicks(parseInt(360*v),this.tickSize,l,v).forEach(f=>{this.drawTick(n,r,s,f.x1,f.y1,f.x2,f.y2)}),this.context.restore()}}const p=Fe({play:{id:"video.play",defaultMessage:"Play"},pause:{id:"video.pause",defaultMessage:"Pause"},mute:{id:"video.mute",defaultMessage:"Mute sound"},unmute:{id:"video.unmute",defaultMessage:"Unmute sound"},download:{id:"video.download",defaultMessage:"Download file"}}),Q=10,we=180,tt=u=>{const{src:n,alt:r="",poster:s,accentColor:l,backgroundColor:v,foregroundColor:k,cacheWidth:f,fullscreen:w,autoPlay:b,editable:y,deployPictureInPicture:g=!1}=u,i=Ke(),[d,S]=a.useState(u.width),[m,$]=a.useState(u.height),[M,E]=a.useState(0),[U,F]=a.useState(0),[P,ee]=a.useState(void 0),[_,z]=a.useState(!0),[N,te]=a.useState(!1),[B,ne]=a.useState(.5),[be,oe]=a.useState(!1),[Me,re]=a.useState(!1),D=a.useRef(new Ge(Q)),T=a.useRef(null),x=a.useRef(null),t=a.useRef(null),W=a.useRef(null),j=a.useRef(null),L=a.useRef(null),se=()=>{var e,o,h;return{src:u.src,volume:(e=t.current)==null?void 0:e.volume,muted:(o=t.current)==null?void 0:o.muted,currentTime:(h=t.current)==null?void 0:h.currentTime,poster:u.poster,backgroundColor:u.backgroundColor,foregroundColor:u.foregroundColor,accentColor:u.accentColor}},ae=()=>{if(x.current){const e=x.current.offsetWidth,o=w?x.current.offsetHeight:e/(16/9);f&&f(e),S(e),$(o)}},R=()=>{var e,o;T.current||Te(),_?(e=t.current)==null||e.play():(o=t.current)==null||o.pause(),z(!_)},ue=Ve(()=>{x.current&&ae()},250,{trailing:!0}),xe=()=>{var e,o;z(!1),((e=T.current)==null?void 0:e.state)==="suspended"&&((o=T.current)==null||o.resume()),le()},Ce=()=>{var e;z(!0),(e=T.current)==null||e.suspend()},ke=()=>{if(t.current){const e=t.current.buffered.length-1;e>-1&&F(Math.ceil(t.current.buffered.end(e)/t.current.duration*100))}},ce=()=>{const e=!N;te(e),t.current&&(t.current.muted=e)},Ee=e=>{document.addEventListener("mousemove",A,!0),document.addEventListener("mouseup",K,!0),document.addEventListener("touchmove",A,!0),document.addEventListener("touchend",K,!0),A(e),e.preventDefault(),e.stopPropagation()},K=()=>{document.removeEventListener("mousemove",A,!0),document.removeEventListener("mouseup",K,!0),document.removeEventListener("touchmove",A,!0),document.removeEventListener("touchend",K,!0)},Pe=e=>{var o;document.addEventListener("mousemove",I,!0),document.addEventListener("mouseup",V,!0),document.addEventListener("touchmove",I,!0),document.addEventListener("touchend",V,!0),oe(!0),(o=t.current)==null||o.pause(),I(e),e.preventDefault(),e.stopPropagation()},V=()=>{var e;document.removeEventListener("mousemove",I,!0),document.removeEventListener("mouseup",V,!0),document.removeEventListener("touchmove",I,!0),document.removeEventListener("touchend",V,!0),oe(!1),(e=t.current)==null||e.play()},I=X(e=>{if(t.current&&W.current){const{x:o}=ye(W.current,e),h=t.current.duration*o;isNaN(h)||(E(h),t.current.currentTime=h)}},15),Ne=()=>{t.current&&(E(t.current.currentTime),ee(t.current.duration))},A=X(e=>{if(t.current&&j.current){const{x:o}=ye(j.current,e);isNaN(o)||(ne(o),t.current.volume=o)}},15),ie=X(()=>{if(!L.current||!t.current)return;const{top:e,height:o}=L.current.getBoundingClientRect(),h=e<=(window.innerHeight||document.documentElement.clientHeight)&&e+o>=0;!_&&!h&&(t.current.pause(),g&&g("audio",se()),z(!0))},150,{trailing:!0}),De=()=>{re(!0)},Le=()=>{re(!1)},Se=()=>{t.current&&(ee(t.current.duration),M&&(t.current.currentTime=M),B!==void 0&&(t.current.volume=B),N!==void 0&&(t.current.muted=N),b&&R())},Te=()=>{if(t.current){const e=window.AudioContext||window.webkitAudioContext,o=new e,h=o.createMediaElementSource(t.current);D.current.setAudioContext(o,h),h.connect(o.destination),T.current=o}},le=()=>{requestAnimationFrame(()=>{t.current&&(Ne(),de(),me(),_||le())})},de=()=>{var e;(e=D.current)==null||e.clear(d||0,m||0)},me=()=>{var e;(e=D.current)==null||e.draw(fe(),ve(),Z(),H(),G())},H=()=>((m||u.height||0)-we*G()*2)/2,G=()=>(m||u.height||0)/982,fe=()=>Math.floor((d||0)/2),ve=()=>Math.floor(H()+we*G()),Z=()=>l||"#ffffff",Re=()=>v||"#000000",Ie=()=>k||"#ffffff",he=e=>{if(t.current){const o=t.current.currentTime+e;isNaN(o)||(E(o),t.current.currentTime=o)}},ge=e=>{e.key===" "&&(e.preventDefault(),e.stopPropagation(),R())},Ae=e=>{switch(e.key){case"k":e.preventDefault(),e.stopPropagation(),R();break;case"m":e.preventDefault(),e.stopPropagation(),ce();break;case"j":e.preventDefault(),e.stopPropagation(),he(-10);break;case"l":e.preventDefault(),e.stopPropagation(),he(10);break}},O=()=>P||u.duration||0,pe=Math.min(M/O()*100,100);return a.useLayoutEffect(()=>{x.current&&ae()},[x.current]),a.useEffect(()=>{t.current&&(ne(t.current.volume),te(t.current.muted))},[t.current]),a.useEffect(()=>{L.current&&D.current&&D.current.setCanvas(L.current)},[L.current,D.current]),a.useEffect(()=>(window.addEventListener("scroll",ie),window.addEventListener("resize",ue,{passive:!0}),()=>{window.removeEventListener("scroll",ie),window.removeEventListener("resize",ue),!_&&t.current&&g&&g("audio",se())}),[]),a.useEffect(()=>{de(),me()},[n,d,m,l]),C.createElement("div",{className:Y("audio-player",{editable:y}),ref:x,style:{backgroundColor:Re(),color:Ie(),width:"100%",height:w?"100%":m||u.height},onMouseEnter:De,onMouseLeave:Le,tabIndex:0,onKeyDown:Ae,onClick:e=>e.stopPropagation()},C.createElement("audio",{src:n,ref:t,preload:"auto",onPlay:xe,onPause:Ce,onProgress:ke,onLoadedData:Se,crossOrigin:"anonymous"}),C.createElement("canvas",{role:"button",tabIndex:0,className:"audio-player__canvas absolute left-0 top-0 w-full",width:d,height:m,ref:L,onClick:R,onKeyDown:ge,title:r,"aria-label":r}),s&&c("img",{src:s,alt:"",className:"pointer-events-none absolute aspect-1 -translate-x-1/2 -translate-y-1/2 rounded-full object-cover",width:(H()-Q)*2,height:(H()-Q)*2,style:{left:fe(),top:ve()}}),C.createElement("div",{className:"video-player__seek",onMouseDown:Pe,ref:W},c("div",{className:"video-player__seek__buffer",style:{width:`${U}%`}}),c("div",{className:"video-player__seek__progress",style:{width:`${pe}%`,backgroundColor:l}}),c("span",{className:Y("video-player__seek__handle",{active:be}),tabIndex:0,style:{left:`${pe}%`,backgroundColor:l},onKeyDown:ge})),c("div",{className:"video-player__controls active"},void 0,c("div",{className:"video-player__buttons-bar"},void 0,c("div",{className:"video-player__buttons left"},void 0,c("button",{type:"button",title:i.formatMessage(_?p.play:p.pause),"aria-label":i.formatMessage(_?p.play:p.pause),className:"player-button",onClick:R},void 0,c(J,{src:_?He:We})),c("button",{type:"button",title:i.formatMessage(N?p.unmute:p.mute),"aria-label":i.formatMessage(N?p.unmute:p.mute),className:"player-button",onClick:ce},void 0,c(J,{src:N?Ue:Be})),C.createElement("div",{className:Y("video-player__volume",{active:Me}),ref:j,onMouseDown:Ee},c("div",{className:"video-player__volume__current",style:{width:`${B*100}%`,backgroundColor:Z()}}),c("span",{className:"video-player__volume__handle",tabIndex:0,style:{left:`${B*100}%`,backgroundColor:Z()}})),c("span",{className:"video-player__time"},void 0,c("span",{className:"video-player__time-current"},void 0,_e(Math.floor(M))),O()&&C.createElement(C.Fragment,null,c("span",{className:"video-player__time-sep"},void 0,"/"),c("span",{className:"video-player__time-total"},void 0,_e(Math.floor(O())))))),c("div",{className:"video-player__buttons right"},void 0,c("a",{title:i.formatMessage(p.download),"aria-label":i.formatMessage(p.download),className:"video-player__download__icon player-button",href:n,download:!0,target:"_blank"},void 0,c(J,{src:ze}))))))};export{tt as default};
