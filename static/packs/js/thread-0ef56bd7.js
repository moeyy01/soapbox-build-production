import{cU as Te,cV as we,cW as Oe,cX as Ne,cY as Ee,cZ as De,p as F,aV as ee,c as te,f as se,_ as e,H as P,K as h,L as He,a1 as N,G as U,c_ as ze,N as oe,c$ as Ae,Y as j,C as R,u as ae,r as y,d0 as Le,cN as qe,R as b,b3 as je,cM as Fe,a8 as E,d1 as Pe,bO as Ue,d2 as $e,d3 as Be,d4 as Ve,d5 as Ke,c7 as W,d6 as Qe,d7 as We,d8 as Ge,t as Ye,cA as Je,b0 as Xe,af as J,ba as D,ay as Ze,aQ as ne,X as ie,q as et,b9 as tt,d as st,d9 as X,J as ot,da as at,db as nt,dc as it,x as rt,y as lt,dd as ct,z as dt,A as ut,w as ft,D as pt,E as gt,B as vt}from"../index-961d4ed1.js";import{S as mt}from"./scrollable-list-74021d3b.js";import{P as ht}from"./pending-status-d95ac051.js";import{S as yt}from"./status-container-8c0c48ff.js";var Z=Te,bt=TypeError,St=function(r,o){if(!delete r[o])throw bt("Cannot delete property "+Z(o)+" of "+Z(r))},Mt=we,xt=Oe,Rt=Ne,_t=Ee,Ct=St,kt=De,It=[].unshift(0)!==1,Tt=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(r){return r instanceof TypeError}},wt=It||!Tt();Mt({target:"Array",proto:!0,arity:1,forced:wt},{unshift:function(o){var i=xt(this),c=Rt(i),s=arguments.length;if(s){kt(c+s);for(var l=c;l--;){var f=l+s;l in i?i[f]=i[l]:Ct(i,f)}for(var n=0;n<s;n++)i[n]=arguments[n]}return _t(i,c+s)}});const Ot=r=>{let{status:o}=r;const i=F(u=>{let{me:v}=u;return v}),{allowedEmoji:c}=ee(),s=te(),l=se(),{account:f}=o;if(!f||typeof f!="object")return null;const n=()=>{s(R("UNAUTHORIZED"))},m=(u,v)=>{s(R("REBLOGS",{username:u,statusId:v}))},k=(u,v)=>{s(R("FAVOURITES",{username:u,statusId:v}))},H=(u,v)=>{s(R("DISLIKES",{username:u,statusId:v}))},$=(u,v)=>{s(R("REACTIONS",{username:u,statusId:v}))},I=()=>Ae(j(o.pleroma.get("emoji_reactions")),o.favourites_count,o.favourited,c),d=u=>{u.preventDefault(),i?m(f.acct,o.id):n()},p=()=>o.reblogs_count?e(q,{count:o.reblogs_count,onClick:d},void 0,e(h,{id:"status.interactions.reblogs",defaultMessage:"{count, plural, one {Repost} other {Reposts}}",values:{count:o.reblogs_count}})):null,S=()=>o.quotes_count?e(q,{count:o.quotes_count,to:`/@${o.getIn(["account","acct"])}/posts/${o.id}/quotes`},void 0,e(h,{id:"status.interactions.quotes",defaultMessage:"{count, plural, one {Quote} other {Quotes}}",values:{count:o.quotes_count}})):null,_=u=>{u.preventDefault(),i?k(f.acct,o.id):n()},C=u=>{u.preventDefault(),i?H(f.acct,o.id):n()},M=()=>o.favourites_count?e(q,{count:o.favourites_count,onClick:l.exposableReactions?_:void 0},void 0,e(h,{id:"status.interactions.favourites",defaultMessage:"{count, plural, one {Like} other {Likes}}",values:{count:o.favourites_count}})):null,B=()=>{const u=o.dislikes_count;return u?e(q,{count:o.favourites_count,onClick:l.exposableReactions?C:void 0},void 0,e(h,{id:"status.interactions.dislikes",defaultMessage:"{count, plural, one {Dislike} other {Dislikes}}",values:{count:u}})):null},T=()=>{if(!i)return n();$(f.acct,o.id)},z=()=>{const u=I(),v=u.reduce((w,A)=>w+A.get("count"),0);return v?e(q,{count:v,onClick:l.exposableReactions?T:void 0},void 0,e(P,{space:.5,alignItems:"center"},void 0,u.take(3).map((w,A)=>e(He,{className:"h-4.5 w-4.5 flex-none",emoji:w.get("name"),src:w.get("url")},A)))):null};return e(P,{space:3},void 0,p(),S(),l.emojiReacts?z():M(),B())},q=r=>{let{count:o,children:i,onClick:c,to:s}=r;const l=se(),f=N({"text-gray-600 dark:text-gray-700":!0,"hover:underline":l.exposableReactions,"cursor-default":!l.exposableReactions}),n=e(P,{space:1,alignItems:"center"},void 0,e(U,{weight:"bold"},void 0,ze(o)),e(U,{tag:"div",theme:"muted"},void 0,i));return s?e(oe,{to:s,className:f},void 0,n):e("button",{type:"button",onClick:c,className:f},void 0,n)},Nt=r=>{let{status:o,onOpenCompareHistoryModal:i,onToggleMediaVisibility:c,showMedia:s,withMedia:l=!0}=r;const f=ae(),n=y.useRef(null),m=y.useRef(null),[k,H]=y.useState(208);y.useEffect(()=>{m.current&&H(m.current.getBoundingClientRect().height)},[m.current]);const $=()=>{i(o)},I=()=>{if(o.group)return e("div",{className:"mb-4"},void 0,e(Ke,{avatarSize:42,icon:e(W,{src:Qe,className:"h-4 w-4 text-primary-600 dark:text-accent-blue"}),text:e(h,{id:"status.group",defaultMessage:"Posted in {group}",values:{group:e(oe,{to:`/group/${o.group.slug}`,className:"hover:underline"},void 0,e("bdi",{className:"truncate"},void 0,e("strong",{className:"text-gray-800 dark:text-gray-200"},void 0,e("span",{dangerouslySetInnerHTML:{__html:o.group.display_name_html}}))))}})}))},d=Le(o);if(!d)return null;const{account:p}=d;if(!p||typeof p!="object")return null;const S=d.visibility==="self",_=d.hidden;let C=null,M;return d.quote&&(d.pleroma.get("quote_visible",!0)===!1?M=e("div",{className:"quoted-actualStatus-tombstone"},void 0,e("p",{},void 0,e(h,{id:"actualStatuses.quote_tombstone",defaultMessage:"Post is unavailable."}))):M=e(qe,{statusId:d.quote})),d.visibility==="direct"?C=e(W,{className:"h-4 w-4 text-gray-700 dark:text-gray-600",src:We}):d.visibility==="private"&&(C=e(W,{className:"h-4 w-4 text-gray-700 dark:text-gray-600",src:Ge})),e("div",{className:"border-box"},void 0,b.createElement("div",{ref:n,className:"detailed-actualStatus",tabIndex:-1},I(),e("div",{className:"mb-4"},void 0,e(je,{account:p,avatarSize:42,hideActions:!0,approvalStatus:d.approval_status},p.id)),e(Fe,{status:d}),e(E,{className:"relative z-0",style:{minHeight:S||_?Math.max(k,208)+12:void 0}},void 0,(S||_)&&b.createElement(Pe,{status:o,visible:s,onToggleVisibility:c,ref:m}),e(E,{space:4},void 0,e(Ue,{status:d,textSize:"lg",translatable:!0}),e($e,{status:d}),l&&(M||d.card||d.media_attachments.size>0)&&e(E,{space:4},void 0,e(Be,{status:d,showMedia:s,onToggleVisibility:c}),M))),e(P,{justifyContent:"between",alignItems:"center",className:"py-3",wrap:!0},void 0,e(Ot,{status:d}),e(P,{space:1,alignItems:"center"},void 0,C,e("span",{},void 0,e("a",{href:d.url,target:"_blank",rel:"noopener",className:"hover:underline"},void 0,e(U,{tag:"span",theme:"muted",size:"sm"},void 0,e(Ve,{value:new Date(d.created_at),hour12:!0,year:"numeric",month:"short",day:"2-digit",hour:"numeric",minute:"2-digit"}))),d.edited_at&&b.createElement(b.Fragment,null," · ",e("div",{className:"inline hover:underline",onClick:$,role:"button",tabIndex:0},void 0,e(U,{tag:"span",theme:"muted",size:"sm"},void 0,e(h,{id:"actualStatus.edited",defaultMessage:"Edited {date}",values:{date:f.formatDate(new Date(d.edited_at),{hour12:!0,month:"short",day:"2-digit",hour:"numeric",minute:"2-digit"})}})))))))))},Et=()=>{const r=Ye(),{displayCta:o}=ee();return o?e(Xe,{className:"space-y-6 px-6 py-12 text-center",variant:"rounded"},void 0,e(E,{},void 0,e(Je,{title:e(h,{id:"thread_login.title",defaultMessage:"Continue the conversation"})}),e(U,{},void 0,e(h,{id:"thread_login.message",defaultMessage:"Join {siteTitle} to get the full story and details.",values:{siteTitle:r.title}}))),e(E,{space:4,className:"mx-auto max-w-xs"},void 0,e(J,{theme:"tertiary",to:"/login",block:!0},void 0,e(h,{id:"thread_login.login",defaultMessage:"Log in"})),e(J,{to:"/signup",block:!0},void 0,e(h,{id:"thread_login.signup",defaultMessage:"Sign up"})))):null},Dt=r=>{const{id:o,focusedStatusId:i}=r,c=F(n=>n.contexts.inReplyTos.get(o)),s=F(n=>n.contexts.replies.get(o,D()).size),l=F(n=>!!n.statuses.get(o));return e("div",{className:"thread__status"},void 0,(()=>{const n=c&&c!==i,m=s>0;return n||m?e("div",{className:N("absolute left-5 z-[1] hidden w-0.5 bg-gray-200 rtl:left-auto rtl:right-5 dark:bg-primary-800",{"!block top-[calc(12px+42px)] h-[calc(100%-42px-8px-1rem)]":m})}):null})(),l?b.createElement(yt,Ze({},r,{showGroup:!1})):e(ne,{variant:"default"}))},Ht=ie([(r,o)=>o,r=>r.contexts.inReplyTos],(r,o)=>{let i=D(),c=r;for(;c&&!i.includes(c);)i=D([c]).union(i),c=o.get(c);return i}),zt=ie([(r,o)=>o,r=>r.contexts.replies],(r,o)=>{let i=D();const c=[r];for(;c.length>0;){const s=c.shift();if(!s)break;const l=o.get(s);if(i.includes(s))break;r!==s&&(i=i.union([s])),l&&l.reverse().forEach(f=>{c.unshift(f)})}return i}),Ft=r=>{const{handleLoadMore:o,itemClassName:i,next:c,status:s,useWindowScroll:l=!0,withMedia:f=!0}=r,n=te(),m=et(),k=ae(),{account:H}=tt(),I=st().get("displayMedia"),d=(s==null?void 0:s.visibility)==="self",{ancestorsIds:p,descendantsIds:S}=F(t=>{let a=D(),g=D();if(s){const x=s.id;a=Ht(t,t.contexts.inReplyTos.get(x)),g=zt(t,x),a=a.delete(x).subtract(g),g=g.delete(x).subtract(a)}return{status:s,ancestorsIds:a,descendantsIds:g}});let _=p.size;!l&&_!==0&&(_=p.size+1);const[C,M]=y.useState((s==null?void 0:s.visibility)==="self"?!1:X(s,I)),B=y.useRef(null),T=y.useRef(null),z=y.useRef(null),u=()=>{M(!C)},v=()=>{if(T.current){const t=T.current.querySelector(".emoji-react-selector .emoji-react-selector__emoji");t==null||t.focus()}},w=t=>{t.favourited?n(rt(t)):n(lt(t))},A=t=>n(ct(t)),G=t=>n(vt(t)),re=(t,a)=>{n((g,x)=>{const Ie=dt(x()).get("boostModal");t.reblogged?n(ut(t)):a&&a.shiftKey||!Ie?G(t):n(R("BOOST",{status:t,onReblog:G}))})},le=t=>n(ft(t)),ce=t=>{const a=s==null?void 0:s.media_attachments;if(t==null||t.preventDefault(),a&&a.size){const g=a.first();a.size===1&&g.type==="video"?n(R("VIDEO",{media:g,status:s})):n(R("MEDIA",{media:a,index:0,status:s}))}},de=t=>{t.hidden?n(pt(t.id)):n(gt(t.id))},ue=()=>{V(s.id)},fe=()=>{K(s.id)},pe=t=>{t==null||t.preventDefault(),A(s)},ge=()=>{w(s)},ve=()=>{re(s)},me=t=>{t==null||t.preventDefault();const{account:a}=s;!a||typeof a!="object"||le(a)},he=()=>{m.push(`/@${s.getIn(["account","acct"])}`)},ye=()=>{de(s)},be=()=>{u()},V=t=>{if(t===(s==null?void 0:s.id))O(p.size-1);else{let a=j(p).indexOf(t);a===-1?(a=j(S).indexOf(t),O(p.size+a)):O(a-1)}},K=t=>{if(t===(s==null?void 0:s.id))O(p.size+1);else{let a=j(p).indexOf(t);a===-1?(a=j(S).indexOf(t),O(p.size+a+2)):O(a+1)}},O=t=>{var a;l||(t=t+1),(a=z.current)==null||a.scrollIntoView({index:t,behavior:"smooth",done:()=>{var g,x;(x=(g=B.current)==null?void 0:g.querySelector(`[data-index="${t}"] .focusable`))==null||x.focus()}})},Se=t=>e("div",{className:"py-4 pb-8"},void 0,e(it,{id:t,onMoveUp:V,onMoveDown:K},t)),Me=t=>e(Dt,{id:t,focusedStatusId:s.id,onMoveUp:V,onMoveDown:K,contextType:"thread"},t),xe=t=>{const a=t.replace(/^末pending-/,"");return e(ht,{idempotencyKey:a,thread:!0},t)},Y=t=>t.map(a=>a.endsWith("-tombstone")?Se(a):a.startsWith("末pending-")?xe(a):Me(a));y.useEffect(()=>{M((s==null?void 0:s.visibility)==="self"?!1:X(s,I))},[s.id]),y.useEffect(()=>{var t;(t=z.current)==null||t.scrollToIndex({index:p.size,offset:-146}),setTimeout(()=>{var a,g;return(g=(a=T.current)==null?void 0:a.querySelector(".detailed-actualStatus"))==null?void 0:g.focus()},0)},[s.id,p.size]);const Re=t=>{n(R("COMPARE_HISTORY",{statusId:t.id}))},_e=p.size>0,Q=S.size>0,Ce={moveUp:ue,moveDown:fe,reply:pe,favourite:ge,boost:ve,mention:me,openProfile:he,toggleHidden:ye,toggleSensitive:be,openMedia:ce,react:v},ke=e("div",{className:N({"pb-4":Q})},s.id,e(ot,{handlers:Ce},void 0,b.createElement("div",{ref:T,className:"focusable relative",tabIndex:0,"aria-label":at(k,s)},e(Nt,{status:s,showMedia:C,withMedia:f,onToggleMediaVisibility:u,onOpenCompareHistoryModal:Re}),d?null:b.createElement(b.Fragment,null,e("hr",{className:"-mx-4 mb-2 max-w-[100vw] border-t-2 dark:border-gray-800"}),e(nt,{status:s,expandable:!1,space:"lg",withLabels:!0})))),Q&&e("hr",{className:"-mx-4 mt-2 max-w-[100vw] border-t-2 dark:border-gray-800"})),L=[];return l||L.push(e("div",{className:"h-4"},"padding")),_e&&L.push(...Y(p).toArray()),L.push(ke),Q&&L.push(...Y(S).toArray()),e(E,{space:2,className:N({"h-full":!l,"mt-2":l})},void 0,b.createElement("div",{ref:B,className:N("thread",{"h-full":!l})},b.createElement(mt,{id:"thread",ref:z,hasMore:!!c,onLoadMore:o,placeholderComponent:()=>e(ne,{variant:"slim"}),initialTopMostItemIndex:_,useWindowScroll:l,itemClassName:i,className:N({"h-full":!l})},L)),!H&&e(Et,{}))};export{Ft as T,Dt as a,zt as g};
