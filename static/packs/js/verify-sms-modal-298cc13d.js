import{c as L,u as U,t as k,p as h,iK as Y,r as o,_ as i,a8 as w,K as c,bv as Q,n as P,R as p,G as M,iL as q,iM as N,bG as G,iN as K,iO as O,bw as j,bq as l,iP as z}from"../index-961d4ed1.js";const r=P({verificationInvalid:{id:"sms_verification.invalid",defaultMessage:"Please enter a valid phone number."},verificationSuccess:{id:"sms_verification.success",defaultMessage:"A verification code has been sent to your phone number."},verificationFail:{id:"sms_verification.fail",defaultMessage:"Failed to send SMS message to your phone number."},verificationExpired:{id:"sms_verification.expired",defaultMessage:"Your SMS token has expired."},verifySms:{id:"sms_verification.modal.verify_sms",defaultMessage:"Verify SMS"},verifyNumber:{id:"sms_verification.modal.verify_number",defaultMessage:"Verify phone number"},verifyCode:{id:"sms_verification.modal.verify_code",defaultMessage:"Verify code"}});var e=function(t){return t.IDLE="IDLE",t.READY="READY",t.REQUESTED="REQUESTED",t.FAIL="FAIL",t.SUCCESS="SUCCESS",t}(e||{});const W=t=>{let{onClose:v}=t;const d=L(),a=U(),y=k(),E=h(s=>Y(s)),b=h(s=>s.verification.isLoading),[n,u]=o.useState(e.IDLE),[m,_]=o.useState(),[f,D]=o.useState(""),[R,I]=o.useState(!1),C=!!m,A=o.useCallback(s=>{_(s)},[]),S=s=>{if(s.preventDefault(),!C){u(e.IDLE),l.error(a.formatMessage(r.verificationInvalid));return}d(z(m)).then(()=>{l.success(a.formatMessage(r.verificationSuccess))}).finally(()=>u(e.REQUESTED)).catch(()=>{l.error(a.formatMessage(r.verificationFail))})},T=s=>{I(!0),S(s)},V=s=>{switch(n){case e.IDLE:u(e.READY);break;case e.READY:S(s);break;case e.REQUESTED:g();break}},x=o.useMemo(()=>{switch(n){case e.IDLE:return a.formatMessage(r.verifySms);case e.READY:return a.formatMessage(r.verifyNumber);case e.REQUESTED:return a.formatMessage(r.verifyCode);default:return null}},[n]),F=()=>{switch(n){case e.IDLE:return i(M,{theme:"muted"},void 0,i(c,{id:"sms_verification.modal.verify_help_text",defaultMessage:"Verify your phone number to start using {instance}.",values:{instance:y.title}}));case e.READY:return i(G,{labelText:i(c,{id:"sms_verification.phone.label",defaultMessage:"Phone number"})},void 0,i(N,{value:m,onChange:A,required:!0,autoFocus:!0}));case e.REQUESTED:return p.createElement(p.Fragment,null,i(M,{theme:"muted",size:"sm",align:"center"},void 0,i(c,{id:"sms_verification.modal.enter_code",defaultMessage:"We sent you a 6-digit code via SMS. Enter it below."})),i(q,{value:f,onChange:D,numInputs:6,isInputNum:!0,shouldAutoFocus:!0,isDisabled:b,containerStyle:"flex justify-center mt-2 space-x-4",inputStyle:"w-10i border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"}));default:return null}},g=()=>{E&&d(K(f)).then(()=>{u(e.SUCCESS),d(O(E)).then(()=>d(j("VERIFY_SMS")))}).catch(()=>l.error(a.formatMessage(r.verificationExpired)))};return o.useEffect(()=>{f.length===6&&g()},[f]),i(Q,{title:i(c,{id:"sms_verification.modal.verify_title",defaultMessage:"Verify your phone number"}),onClose:()=>v("VERIFY_SMS"),cancelAction:n===e.IDLE?()=>v("VERIFY_SMS"):void 0,cancelText:"Skip for now",confirmationAction:V,confirmationText:x,secondaryAction:n===e.REQUESTED?T:void 0,secondaryText:n===e.REQUESTED?i(c,{id:"sms_verification.modal.resend_code",defaultMessage:"Resend verification code?"}):void 0,secondaryDisabled:R},void 0,i(w,{space:4},void 0,F()))};export{W as default};
