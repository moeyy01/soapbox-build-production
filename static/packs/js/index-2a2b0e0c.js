import{u as E,c as j,t as J,b9 as K,f as Y,p as z,r as k,_ as e,bF as Q,R as N,ay as A,bG as b,K as i,bH as v,et as U,b_ as V,ak as X,al as m,am as g,bJ as Z,af as D,a2 as $,eu as ee,ev as te,n as ae,H as se,ew as le,ex as ie,bq as I}from"../index-961d4ed1.js";import{S as oe}from"./streamfield-e3bece9e.js";import{u as H}from"./useImageField-8e42d763.js";import{H as de,A as re}from"./header-picker-3bbb9670.js";import"./photo-plus-d58838d9.js";const ne=t=>t&&ee(t)?void 0:t,fe=t=>t&&te(t)?void 0:t,ce=t=>{let{pleroma:s}=t;return!!(s!=null&&s.hide_followers&&(s!=null&&s.hide_follows)&&(s!=null&&s.hide_followers_count)&&(s!=null&&s.hide_follows_count))},f=ae({heading:{id:"column.edit_profile",defaultMessage:"Edit profile"},header:{id:"edit_profile.header",defaultMessage:"Edit Profile"},metaFieldLabel:{id:"edit_profile.fields.meta_fields.label_placeholder",defaultMessage:"Label"},metaFieldContent:{id:"edit_profile.fields.meta_fields.content_placeholder",defaultMessage:"Content"},success:{id:"edit_profile.success",defaultMessage:"Profile saved!"},error:{id:"edit_profile.error",defaultMessage:"Profile update failed"},bioPlaceholder:{id:"edit_profile.fields.bio_placeholder",defaultMessage:"Tell us about yourself."},displayNamePlaceholder:{id:"edit_profile.fields.display_name_placeholder",defaultMessage:"Name"},websitePlaceholder:{id:"edit_profile.fields.website_placeholder",defaultMessage:"Display a Link"},locationPlaceholder:{id:"edit_profile.fields.location_placeholder",defaultMessage:"Location"},cancel:{id:"common.cancel",defaultMessage:"Cancel"}}),ue=t=>{var h,o,d,c,u,_;const s=ce(t);return{discoverable:t.discoverable,bot:t.bot,display_name:t.display_name,note:((h=t.source)==null?void 0:h.note)??"",locked:t.locked,fields_attributes:[...((o=t.source)==null?void 0:o.fields)??[]],stranger_notifications:((c=(d=t.pleroma)==null?void 0:d.notification_settings)==null?void 0:c.block_from_strangers)===!0,accepts_email_list:((u=t.pleroma)==null?void 0:u.accepts_email_list)===!0,hide_followers:s,hide_follows:s,hide_followers_count:s,hide_follows_count:s,website:t.website,location:t.location,birthday:((_=t.pleroma)==null?void 0:_.birthday)??void 0}},he=t=>{let{value:s,onChange:h}=t;const o=E(),d=c=>u=>{h({...s,[c]:u.currentTarget.value})};return e(se,{space:2,grow:!0},void 0,e(v,{type:"text",outerClassName:"w-2/5 grow",value:s.name,onChange:d("name"),placeholder:o.formatMessage(f.metaFieldLabel)}),e(v,{type:"text",outerClassName:"w-3/5 grow",value:s.value,onChange:d("value"),placeholder:o.formatMessage(f.metaFieldContent)}))},ve=()=>{var L;const t=E(),s=j(),h=J(),{account:o}=K(),d=Y(),c=h.pleroma.getIn(["metadata","fields_limits","max_fields"],4),u=(L=z(a=>a.instance.configuration.getIn(["media_attachments","supported_mime_types"])))==null?void 0:L.filter(a=>a.startsWith("image/")).toArray().join(","),[_,C]=k.useState(!1),[r,x]=k.useState({}),[S,T]=k.useState(!1),F=H({maxPixels:400*400,preview:ne(o==null?void 0:o.avatar)}),P=H({maxPixels:1920*1080,preview:fe(o==null?void 0:o.header)});k.useEffect(()=>{var a,l;if(o){const n=ue(o),M=((l=(a=o.pleroma)==null?void 0:a.notification_settings)==null?void 0:l.block_from_strangers)===!0;x(n),T(M)}},[o==null?void 0:o.id]);const p=(a,l)=>{x(n=>({...n,[a]:l}))},R=a=>{var M;const l=[],n={...r};((M=n.fields_attributes)==null?void 0:M.length)===0&&(n.fields_attributes=[{name:"",value:""}]),P.file!==void 0&&(n.header=P.file||""),F.file!==void 0&&(n.avatar=F.file||""),l.push(s(le(n,!0))),d.muteStrangers&&l.push(s(ie({block_from_strangers:S})).catch(console.error)),C(!0),Promise.all(l).then(()=>{C(!1),I.success(t.formatMessage(f.success))}).catch(()=>{C(!1),I.error(t.formatMessage(f.error))}),a.preventDefault()},w=a=>l=>{p(a,l.target.checked)},y=a=>l=>{p(a,l.target.value)},B=a=>{p("birthday",a)},W=a=>{const l=a.target.checked;x(n=>({...n,hide_followers:l,hide_follows:l,hide_followers_count:l,hide_follows_count:l}))},q=a=>{p("fields_attributes",a)},O=()=>{const l=[...r.fields_attributes||[],{name:"",value:""}];p("fields_attributes",l)},G=a=>{const n=[...r.fields_attributes||[]];n.splice(a,1),p("fields_attributes",n)};return e($,{label:t.formatMessage(f.header)},void 0,e(Q,{onSubmit:R},void 0,e("div",{className:"relative mb-12 flex"},void 0,N.createElement(de,A({accept:u,disabled:_},P)),N.createElement(re,A({className:"!sm:left-6 !left-4 !translate-x-0",accept:u,disabled:_},F))),e(b,{labelText:e(i,{id:"edit_profile.fields.display_name_label",defaultMessage:"Display name"})},void 0,e(v,{type:"text",value:r.display_name,onChange:y("display_name"),placeholder:t.formatMessage(f.displayNamePlaceholder)})),d.birthdays&&e(b,{labelText:e(i,{id:"edit_profile.fields.birthday_label",defaultMessage:"Birthday"})},void 0,e(U,{value:r.birthday,onChange:B})),d.accountLocation&&e(b,{labelText:e(i,{id:"edit_profile.fields.location_label",defaultMessage:"Location"})},void 0,e(v,{type:"text",value:r.location,onChange:y("location"),placeholder:t.formatMessage(f.locationPlaceholder)})),d.accountWebsite&&e(b,{labelText:e(i,{id:"edit_profile.fields.website_label",defaultMessage:"Website"})},void 0,e(v,{type:"text",value:r.website,onChange:y("website"),placeholder:t.formatMessage(f.websitePlaceholder)})),e(b,{labelText:e(i,{id:"edit_profile.fields.bio_label",defaultMessage:"Bio"})},void 0,e(V,{value:r.note,onChange:y("note"),autoComplete:"off",placeholder:t.formatMessage(f.bioPlaceholder)})),e(X,{},void 0,d.followRequests&&e(m,{label:e(i,{id:"edit_profile.fields.locked_label",defaultMessage:"Lock account"}),hint:e(i,{id:"edit_profile.hints.locked",defaultMessage:"Requires you to manually approve followers"})},void 0,e(g,{checked:r.locked,onChange:w("locked")})),d.hideNetwork&&e(m,{label:e(i,{id:"edit_profile.fields.hide_network_label",defaultMessage:"Hide network"}),hint:e(i,{id:"edit_profile.hints.hide_network",defaultMessage:"Who you follow and who follows you will not be shown on your profile"})},void 0,e(g,{checked:o?r.hide_followers&&r.hide_follows&&r.hide_followers_count&&r.hide_follows_count:!1,onChange:W})),d.bots&&e(m,{label:e(i,{id:"edit_profile.fields.bot_label",defaultMessage:"This is a bot account"}),hint:e(i,{id:"edit_profile.hints.bot",defaultMessage:"This account mainly performs automated actions and might not be monitored"})},void 0,e(g,{checked:r.bot,onChange:w("bot")})),d.muteStrangers&&e(m,{label:e(i,{id:"edit_profile.fields.stranger_notifications_label",defaultMessage:"Block notifications from strangers"}),hint:e(i,{id:"edit_profile.hints.stranger_notifications",defaultMessage:"Only show notifications from people you follow"})},void 0,e(g,{checked:S,onChange:a=>T(a.target.checked)})),d.profileDirectory&&e(m,{label:e(i,{id:"edit_profile.fields.discoverable_label",defaultMessage:"Allow account discovery"}),hint:e(i,{id:"edit_profile.hints.discoverable",defaultMessage:"Display account in profile directory and allow indexing by external services"})},void 0,e(g,{checked:r.discoverable,onChange:w("discoverable")})),d.emailList&&e(m,{label:e(i,{id:"edit_profile.fields.accepts_email_list_label",defaultMessage:"Subscribe to newsletter"}),hint:e(i,{id:"edit_profile.hints.accepts_email_list",defaultMessage:"Opt-in to news and marketing updates."})},void 0,e(g,{checked:r.accepts_email_list,onChange:w("accepts_email_list")}))),d.profileFields&&e(oe,{label:e(i,{id:"edit_profile.fields.meta_fields_label",defaultMessage:"Profile fields"}),hint:e(i,{id:"edit_profile.hints.meta_fields",defaultMessage:"You can have up to {count, plural, one {# custom field} other {# custom fields}} displayed on your profile.",values:{count:c}}),values:r.fields_attributes||[],onChange:q,onAddItem:O,onRemoveItem:G,component:he,maxItems:c}),e(Z,{},void 0,e(D,{to:"/settings",theme:"tertiary"},void 0,t.formatMessage(f.cancel)),e(D,{theme:"primary",type:"submit",disabled:_},void 0,e(i,{id:"edit_profile.save",defaultMessage:"Save"})))))};export{ve as default};
