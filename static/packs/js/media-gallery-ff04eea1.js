import{v as V}from"./volume-08f8a8f1.js";import{r as G,_ as c,R as F,a1 as M,d as K,aV as U,dn as B,dp as X,dq as Y,I as O,df as W,de as j,ay as J,dg as q}from"../index-961d4ed1.js";import{i as s,m as v,a as e,b as n,c as T}from"./media-aspect-ratio-df6a7bb1.js";const $=4,Q=45,Z=_=>_>=T&&_<=v,ee=_=>{const i=_.getIn(["meta","original","aspect"]);return i?!Z(i):!0},te=_=>{var d,z;let{attachment:i,index:N,onClick:P,standalone:k=!1,visible:C,dimensions:f,last:S,total:w}=_;const b=K().get("autoPlayGif")===!0,{mediaPreview:R}=U(),D=r=>{let{currentTarget:x}=r;E()&&x.play()},L=r=>{let{currentTarget:x}=r;E()&&(x.pause(),x.currentTime=0)},E=()=>!b&&i.type==="gifv",y=r=>{q()&&!r.target.autoPlay?(r.target.autoPlay=!0,r.preventDefault()):r.button===0&&!(r.ctrlKey||r.metaKey)&&(E()&&(r.target.pause(),r.target.currentTime=0),r.preventDefault(),P(N)),r.stopPropagation()},A=r=>{let{currentTarget:x}=r;x.playbackRate=3,x.play()},p=r=>{let{currentTarget:x}=r;x.pause(),x.currentTime=0};let l=100,g="100%",u="auto",m="auto",h="auto",I="auto",t="left",a="relative";f&&(l=f.w,g=f.h,u=f.t||"auto",I=f.r||"auto",h=f.b||"auto",m=f.l||"auto",t=f.float||"left",a=f.pos||"relative");let o="";if(i.type==="unknown"){const r=B(i.url,Q),x=c(O,{className:"h-16 w-16 text-gray-800 dark:text-gray-200",src:X[i.getIn(["pleroma","mime_type"])]||Y});return c("div",{className:M("media-gallery__item",{standalone:k,"rounded-md":w>1}),style:{position:a,float:t,left:m,top:u,right:I,bottom:h,height:g,width:`${l}%`}},i.id,c("a",{className:"media-gallery__item-thumbnail",href:i.url,target:"_blank",style:{cursor:"pointer"}},void 0,c(W,{hash:i.blurhash,className:"media-gallery__preview"}),c("span",{className:"media-gallery__item__icons"},void 0,x),c("span",{className:"media-gallery__filename__label"},void 0,r)))}else if(i.type==="image"){const r=w===1&&ee(i);o=c("a",{className:"media-gallery__item-thumbnail",href:i.url,onClick:y,target:"_blank"},void 0,c(j,{className:"h-full w-full",src:R?i.preview_url:i.url,alt:i.description,letterboxed:r,showExt:!0}))}else if(i.type==="gifv"){const r={};q()&&(r.playsInline=!0),b&&(r.autoPlay=!0),o=c("div",{className:M("media-gallery__gifv",{autoplay:b})},void 0,F.createElement("video",J({className:"media-gallery__item-gifv-thumbnail","aria-label":i.description,title:i.description,role:"application",src:i.url,onClick:y,onMouseEnter:D,onMouseLeave:L,loop:!0,muted:!0},r)),c("span",{className:"media-gallery__gifv__label"},void 0,"GIF"))}else if(i.type==="audio"){const r=(d=i.url.split(".").pop())==null?void 0:d.toUpperCase();o=c("a",{className:M("media-gallery__item-thumbnail"),href:i.url,onClick:y,target:"_blank",title:i.description},void 0,c("span",{className:"media-gallery__item__icons"},void 0,c(O,{src:V})),c("span",{className:"media-gallery__file-extension__label"},void 0,r))}else if(i.type==="video"){const r=(z=i.url.split(".").pop())==null?void 0:z.toUpperCase();o=c("a",{className:M("media-gallery__item-thumbnail"),href:i.url,onClick:y,target:"_blank",title:i.description},void 0,c("video",{muted:!0,loop:!0,onMouseOver:A,onMouseOut:p},void 0,c("source",{src:i.url})),c("span",{className:"media-gallery__file-extension__label"},void 0,r))}return c("div",{className:M("media-gallery__item",`media-gallery__item--${i.type}`,{standalone:k,"rounded-md":w>1}),style:{position:a,float:t,left:m,top:u,right:I,bottom:h,height:g,width:`${l}%`}},i.id,S&&w>$&&c("div",{className:"media-gallery__item-overflow"},void 0,"+",w-$+1),c(W,{hash:i.blurhash,className:"media-gallery__preview"}),C&&o)},se=_=>{const{media:i,defaultWidth:N=0,className:P,onOpenMedia:k,cacheWidth:C,compact:f,height:S}=_,[w,H]=G.useState(N),b=G.useRef(null),R=p=>{k(i,p)},D=()=>{const p=w||N,l=i.getIn([0,"meta","original","aspect"]);return{style:{height:(()=>l?e(l)?Math.floor(p/v):s(l)?Math.floor(p/T):Math.floor(p/l):p*9/16)()},itemsDimensions:[],size:1,width:w}},L=p=>{const l=w||N,g=Math.floor(l/v),u=`${Math.floor(l/v)}px`,m={};let h=[];const I=Array(p).fill(null).map((z,r)=>i.getIn([r,"meta","original","aspect"])),[t,a,o,d]=I;return p===2?(s(t)&&s(a)?m.height=l-l/v:e(t)&&e(a)?m.height=g*2:e(t)&&s(a)||s(t)&&e(a)||e(t)&&n(a)||n(t)&&e(a)?m.height=l*.6+l/v:m.height=l/2,s(t)&&s(a)?h=[{w:50,h:"100%",r:"2px"},{w:50,h:"100%",l:"2px"}]:e(t)&&e(a)?h=[{w:100,h:u,b:"2px"},{w:100,h:u,t:"2px"}]:e(t)&&s(a)||e(t)&&n(a)?h=[{w:100,h:`${l/v}px`,b:"2px"},{w:100,h:`${l*.6}px`,t:"2px"}]:s(t)&&e(a)||n(t)&&e(a)?h=[{w:100,h:`${l*.6}px`,b:"2px"},{w:100,h:`${l/v}px`,t:"2px"}]:h=[{w:50,h:"100%",r:"2px"},{w:50,h:"100%",l:"2px"}]):p===3?(e(t)&&e(a)&&e(o)?m.height=g*3:s(t)&&s(a)&&s(o)?m.height=Math.floor(l/T):m.height=l,e(t)&&n(a)&&n(o)?h=[{w:100,h:"50%",b:"2px"},{w:50,h:"50%",t:"2px",r:"2px"},{w:50,h:"50%",t:"2px",l:"2px"}]:e(t)&&e(a)&&e(o)?h=[{w:100,h:u,b:"4px"},{w:100,h:u},{w:100,h:u,t:"4px"}]:s(t)&&n(a)&&n(o)?h=[{w:50,h:"100%",r:"2px"},{w:50,h:"50%",b:"2px",l:"2px"},{w:50,h:"50%",t:"2px",l:"2px"}]:n(t)&&n(a)&&s(o)?h=[{w:50,h:"50%",b:"2px",r:"2px"},{w:50,h:"50%",l:"-2px",b:"-2px",pos:"absolute",float:"none"},{w:50,h:"100%",r:"-2px",t:"0px",b:"0px",pos:"absolute",float:"none"}]:n(t)&&s(a)&&n(o)||s(t)&&s(a)&&s(o)?h=[{w:50,h:"50%",b:"2px",r:"2px"},{w:50,h:"100%",l:"2px",float:"right"},{w:50,h:"50%",t:"2px",r:"2px"}]:e(t)&&e(a)&&n(o)||e(t)&&e(a)&&s(o)?h=[{w:50,h:u,b:"2px",r:"2px"},{w:50,h:u,b:"2px",l:"2px"},{w:100,h:`${l-g}px`,t:"2px"}]:n(t)&&e(a)&&e(o)||s(t)&&e(a)&&e(o)?h=[{w:100,h:`${l-g}px`,b:"2px"},{w:50,h:u,t:"2px",r:"2px"},{w:50,h:u,t:"2px",l:"2px"}]:h=[{w:50,h:"50%",b:"2px",r:"2px"},{w:50,h:"50%",b:"2px",l:"2px"},{w:100,h:"50%",t:"2px"}]):p>=4&&(s(t)&&s(a)&&s(o)&&s(d)||s(t)&&s(a)&&s(o)&&n(d)||s(t)&&s(a)&&n(o)&&s(d)||s(t)&&n(a)&&s(o)&&s(d)||n(t)&&s(a)&&s(o)&&s(d)?m.height=Math.floor(l/T):e(t)&&e(a)&&e(o)&&e(d)?m.height=g*2:e(t)&&e(a)&&n(o)&&n(d)||n(t)&&n(a)&&e(o)&&e(d)?m.height=g+l/2:m.height=l,e(t)&&e(a)&&n(o)&&n(d)?h=[{w:50,h:u,b:"2px",r:"2px"},{w:50,h:u,b:"2px",l:"2px"},{w:50,h:`${l/2}px`,t:"2px",r:"2px"},{w:50,h:`${l/2}px`,t:"2px",l:"2px"}]:n(t)&&n(a)&&e(o)&&e(d)?h=[{w:50,h:`${l/2}px`,b:"2px",r:"2px"},{w:50,h:`${l/2}px`,b:"2px",l:"2px"},{w:50,h:u,t:"2px",r:"2px"},{w:50,h:u,t:"2px",l:"2px"}]:s(t)&&n(a)&&n(o)&&n(d)||s(t)&&e(a)&&e(o)&&e(d)?h=[{w:67,h:"100%",r:"2px"},{w:33,h:"33%",b:"4px",l:"2px"},{w:33,h:"33%",l:"2px"},{w:33,h:"33%",t:"4px",l:"2px"}]:h=[{w:50,h:"50%",b:"2px",r:"2px"},{w:50,h:"50%",b:"2px",l:"2px"},{w:50,h:"50%",t:"2px",r:"2px"},{w:50,h:"50%",t:"2px",l:"2px"}]),{style:m,itemsDimensions:h,size:p,width:l}},y=(p=>{const l=w||N;if(l){if(p===1)return D();if(p>1)return L(p)}return{style:{height:S},itemsDimensions:[],size:p,width:l}})(i.size),A=i.take($).map((p,l)=>c(te,{onClick:R,attachment:p,index:l,size:y.size,displayWidth:y.width,visible:!!_.visible,dimensions:y.itemsDimensions[l],last:l===$-1,total:i.size},p.id));return G.useLayoutEffect(()=>{if(b.current){const{offsetWidth:p}=b.current;C&&C(p),H(p)}},[b.current]),F.createElement("div",{className:M(P,"media-gallery",{"media-gallery--compact":f}),style:y.style,ref:b},A)};export{se as default};
