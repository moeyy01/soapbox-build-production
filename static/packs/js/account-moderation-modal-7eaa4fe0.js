import{_ as t,G as V,aI as Q,ab as W,r as S,H as C,bk as F,ca as O,cb as P,cc as M,u as T,cd as X,n as A,ce as Y,c as L,bI as Z,cf as b,bq as _,b9 as k,f as ee,b4 as te,cg as se,aF as oe,bv as B,a8 as ae,ch as ne,b3 as de,ak as N,ci as re,al as v,K as f,am as R,af as I,cj as ie,ck as ue,cl as ge,cm as me}from"../index-961d4ed1.js";const ce=u=>{let{tag:r,onDelete:g}=u;return t("div",{className:"inline-flex items-center whitespace-nowrap rounded bg-primary-500 p-1"},void 0,t(V,{theme:"white"},void 0,r),t(Q,{iconClassName:"h-4 w-4",src:W,onClick:()=>g(r)}))},fe=u=>{let{tags:r,onChange:g,placeholder:i}=u;const[m,c]=S.useState(""),n=a=>{g(r.filter(s=>s!==a))},e=a=>{const{key:s}=a,d=m.trim();if(s==="Tab"&&a.preventDefault(),[",","Tab","Enter"].includes(s)&&d.length&&!r.includes(d)&&(a.preventDefault(),g([...r,d]),c("")),s==="Backspace"&&!m.length&&r.length){a.preventDefault();const o=[...r];o.pop(),g(o)}};return t("div",{className:"relative mt-1 grow shadow-sm"},void 0,t(C,{className:"block w-full rounded-md border-gray-400 bg-white p-2 pb-0 text-gray-900 placeholder:text-gray-600 focus:border-primary-500 focus:ring-primary-500 dark:border-gray-800 dark:bg-gray-900 dark:text-gray-100 dark:ring-1 dark:ring-gray-800 dark:placeholder:text-gray-600 dark:focus:border-primary-500 dark:focus:ring-primary-500 sm:text-sm",space:2,wrap:!0},void 0,r.map((a,s)=>t("div",{className:"mb-2"},void 0,t(ce,{tag:a,onDelete:n}))),t("input",{className:"mb-2 h-8 w-32 grow bg-transparent p-1 outline-none",value:m,placeholder:i,onChange:a=>c(a.target.value),onKeyDown:e})))};function pe(){const u=F(),r=O(),{transaction:g}=P();function i(n,e){const a=s=>(s.pleroma&&(s.pleroma.is_suggested=e),s);g({Accounts:n.reduce((s,d)=>({...s,[d]:a}),{})})}async function m(n,e){var s,d;const a=M(r(),n);i(n,!0);try{await u.patch("/api/v1/pleroma/admin/users/suggest",{nicknames:a}),(s=e==null?void 0:e.onSuccess)==null||s.call(e)}catch(o){(d=e==null?void 0:e.onError)==null||d.call(e,o),i(n,!1)}}async function c(n,e){var s,d;const a=M(r(),n);i(n,!1);try{await u.patch("/api/v1/pleroma/admin/users/unsuggest",{nicknames:a}),(s=e==null?void 0:e.onSuccess)==null||s.call(e)}catch(o){(d=e==null?void 0:e.onError)==null||d.call(e,o),i(n,!0)}}return{suggest:m,unsuggest:c}}function ve(){const u=F(),r=O(),{transaction:g}=P();function i(n,e){const a=s=>{if(s.pleroma){const d=s.pleroma.tags.filter(o=>o!=="verified");e&&d.push("verified"),s.pleroma.tags=d}return s.verified=e,s};g({Accounts:n.reduce((s,d)=>({...s,[d]:a}),{})})}async function m(n,e){var s,d;const a=M(r(),n);i(n,!0);try{await u.put("/api/v1/pleroma/admin/users/tag",{nicknames:a,tags:["verified"]}),(s=e==null?void 0:e.onSuccess)==null||s.call(e)}catch(o){(d=e==null?void 0:e.onError)==null||d.call(e,o),i(n,!1)}}async function c(n,e){var s,d;const a=M(r(),n);i(n,!1);try{await u.delete("/api/v1/pleroma/admin/users/tag",{data:{nicknames:a,tags:["verified"]}}),(s=e==null?void 0:e.onSuccess)==null||s.call(e)}catch(o){(d=e==null?void 0:e.onError)==null||d.call(e,o),i(n,!0)}}return{verify:m,unverify:c}}const le=A({placeholder:{id:"badge_input.placeholder",defaultMessage:"Enter a badgeâ€¦"}}),he=u=>{let{badges:r,onChange:g}=u;const i=T(),m=r.map(X);return t(fe,{tags:m,onChange:n=>{const e=n.map(Y);g(e)},placeholder:i.formatMessage(le.placeholder)})},_e=u=>u.admin?"admin":u.moderator?"moderator":"user",p=A({roleUser:{id:"account_moderation_modal.roles.user",defaultMessage:"User"},roleModerator:{id:"account_moderation_modal.roles.moderator",defaultMessage:"Moderator"},roleAdmin:{id:"account_moderation_modal.roles.admin",defaultMessage:"Admin"},promotedToAdmin:{id:"admin.users.actions.promote_to_admin_message",defaultMessage:"@{acct} was promoted to an admin"},promotedToModerator:{id:"admin.users.actions.promote_to_moderator_message",defaultMessage:"@{acct} was promoted to a moderator"},demotedToModerator:{id:"admin.users.actions.demote_to_moderator_message",defaultMessage:"@{acct} was demoted to a moderator"},demotedToUser:{id:"admin.users.actions.demote_to_user_message",defaultMessage:"@{acct} was demoted to a regular user"}}),Me=u=>{let{account:r}=u;const g=T(),i=L(),m=S.useMemo(()=>({user:g.formatMessage(p.roleUser),moderator:g.formatMessage(p.roleModerator),admin:g.formatMessage(p.roleAdmin)}),[]),c=e=>{const a=e.target.value;i(b(r.id,a)).then(()=>{let s;a==="admin"?s=p.promotedToAdmin:a==="moderator"&&r.admin?s=p.demotedToModerator:a==="moderator"?s=p.promotedToModerator:a==="user"&&(s=p.demotedToUser),s&&_.success(g.formatMessage(s,{acct:r.acct}))}).catch(()=>{})},n=_e(r);return t(Z,{items:m,defaultValue:n,onChange:c})},h=A({userVerified:{id:"admin.users.user_verified_message",defaultMessage:"@{acct} was verified"},userUnverified:{id:"admin.users.user_unverified_message",defaultMessage:"@{acct} was unverified"},setDonorSuccess:{id:"admin.users.set_donor_message",defaultMessage:"@{acct} was set as a donor"},removeDonorSuccess:{id:"admin.users.remove_donor_message",defaultMessage:"@{acct} was removed as a donor"},userSuggested:{id:"admin.users.user_suggested_message",defaultMessage:"@{acct} was suggested"},userUnsuggested:{id:"admin.users.user_unsuggested_message",defaultMessage:"@{acct} was unsuggested"},badgesSaved:{id:"admin.users.badges_saved_message",defaultMessage:"Custom badges updated."}}),ye=u=>{var x;let{onClose:r,accountId:g}=u;const i=T(),m=L(),{suggest:c,unsuggest:n}=pe(),{verify:e,unverify:a}=ve(),{account:s}=k(),d=ee(),{account:o}=te(g),D=o?se(o):[],[E,$]=S.useState(D),U=()=>r("ACCOUNT_MODERATION");if(!o||!s)return t(B,{onClose:U},void 0,t(oe,{}));const q=()=>{window.open(`/pleroma/admin/#/users/${o.id}/`,"_blank")},H=w=>{const{checked:l}=w.target,y=l?h.userVerified:h.userUnverified;(l?e:a)([o.id],{onSuccess:()=>_.success(i.formatMessage(y,{acct:o.acct}))})},K=w=>{const{checked:l}=w.target,y=l?h.userSuggested:h.userUnsuggested;(l?c:n)([o.id],{onSuccess:()=>_.success(i.formatMessage(y,{acct:o.acct}))})},j=()=>{m(ue(i,o.id))},z=()=>{m(ge(i,o.id))},G=()=>{m(me(o.id,D,E)).then(()=>_.success(i.formatMessage(h.badgesSaved))).catch(()=>{})};return t(B,{title:t(f,{id:"account_moderation_modal.title",defaultMessage:"Moderate @{acct}",values:{acct:o.acct}}),onClose:U},void 0,t(ae,{space:4},void 0,t(ne,{},void 0,t(de,{account:o,showProfileHoverCard:!1,withLinkToProfile:!1,hideActions:!0})),t(N,{},void 0,s.admin&&re(o)&&t(v,{label:t(f,{id:"account_moderation_modal.fields.account_role",defaultMessage:"Staff level"})},void 0,t("div",{className:"w-auto"},void 0,t(Me,{account:o}))),t(v,{label:t(f,{id:"account_moderation_modal.fields.verified",defaultMessage:"Verified account"})},void 0,t(R,{checked:o.verified,onChange:H})),d.suggestionsV2&&t(v,{label:t(f,{id:"account_moderation_modal.fields.suggested",defaultMessage:"Suggested in people to follow"})},void 0,t(R,{checked:((x=o.pleroma)==null?void 0:x.is_suggested)===!0,onChange:K})),t(v,{label:t(f,{id:"account_moderation_modal.fields.badges",defaultMessage:"Custom badges"})},void 0,t("div",{className:"grow"},void 0,t(C,{className:"w-full",alignItems:"center",space:2},void 0,t(he,{badges:E,onChange:$}),t(I,{onClick:G},void 0,t(f,{id:"save",defaultMessage:"Save"})))))),t(N,{},void 0,t(v,{label:t(f,{id:"account_moderation_modal.fields.deactivate",defaultMessage:"Deactivate account"}),onClick:j}),t(v,{label:t(f,{id:"account_moderation_modal.fields.delete",defaultMessage:"Delete account"}),onClick:z})),t(V,{theme:"subtle",size:"xs"},void 0,t(f,{id:"account_moderation_modal.info.id",defaultMessage:"ID: {id}",values:{id:o.id}})),d.adminFE&&t(C,{justifyContent:"center"},void 0,t(I,{icon:ie,size:"sm",theme:"secondary",onClick:q},void 0,t(f,{id:"account_moderation_modal.admin_fe",defaultMessage:"Open in AdminFE"})))))};export{ye as default};
