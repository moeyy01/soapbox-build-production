import{u as U,q as z,c as j,r as N,dH as L,R as F,a1 as H,_ as b,C as P,aJ as K,K as I,bw as A,dF as B,dI as J,dJ as V,dK as G,n as Q}from"../index-961d4ed1.js";var D=function(){function a(r,v){for(var m=0;m<v.length;m++){var c=v[m];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,c.key,c)}}return function(r,v,m){return v&&a(r.prototype,v),m&&a(r,m),r}}();function O(a,r){if(!(a instanceof r))throw new TypeError("Cannot call a class as a function")}(function(){if(typeof window>"u")return;var a=Array.prototype.slice,r=Element.prototype.matches||Element.prototype.msMatchesSelector,v=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","details","summary","iframe","object","embed","[contenteditable]"].join(","),m=function(){function o(t,e){O(this,o),this._inertManager=e,this._rootElement=t,this._managedNodes=new Set,this._rootElement.hasAttribute("aria-hidden")?this._savedAriaHidden=this._rootElement.getAttribute("aria-hidden"):this._savedAriaHidden=null,this._rootElement.setAttribute("aria-hidden","true"),this._makeSubtreeUnfocusable(this._rootElement),this._observer=new MutationObserver(this._onMutation.bind(this)),this._observer.observe(this._rootElement,{attributes:!0,childList:!0,subtree:!0})}return D(o,[{key:"destructor",value:function(){this._observer.disconnect(),this._rootElement&&(this._savedAriaHidden!==null?this._rootElement.setAttribute("aria-hidden",this._savedAriaHidden):this._rootElement.removeAttribute("aria-hidden")),this._managedNodes.forEach(function(e){this._unmanageNode(e.node)},this),this._observer=null,this._rootElement=null,this._managedNodes=null,this._inertManager=null}},{key:"_makeSubtreeUnfocusable",value:function(e){var n=this;_(e,function(f){return n._visitNode(f)});var i=document.activeElement;if(!document.body.contains(e)){for(var s=e,l=void 0;s;){if(s.nodeType===Node.DOCUMENT_FRAGMENT_NODE){l=s;break}s=s.parentNode}l&&(i=l.activeElement)}e.contains(i)&&(i.blur(),i===document.activeElement&&document.body.focus())}},{key:"_visitNode",value:function(e){if(e.nodeType===Node.ELEMENT_NODE){var n=e;n!==this._rootElement&&n.hasAttribute("inert")&&this._adoptInertRoot(n),(r.call(n,v)||n.hasAttribute("tabindex"))&&this._manageNode(n)}}},{key:"_manageNode",value:function(e){var n=this._inertManager.register(e,this);this._managedNodes.add(n)}},{key:"_unmanageNode",value:function(e){var n=this._inertManager.deregister(e,this);n&&this._managedNodes.delete(n)}},{key:"_unmanageSubtree",value:function(e){var n=this;_(e,function(i){return n._unmanageNode(i)})}},{key:"_adoptInertRoot",value:function(e){var n=this._inertManager.getInertRoot(e);n||(this._inertManager.setInert(e,!0),n=this._inertManager.getInertRoot(e)),n.managedNodes.forEach(function(i){this._manageNode(i.node)},this)}},{key:"_onMutation",value:function(e,n){e.forEach(function(i){var s=i.target;if(i.type==="childList")a.call(i.addedNodes).forEach(function(f){this._makeSubtreeUnfocusable(f)},this),a.call(i.removedNodes).forEach(function(f){this._unmanageSubtree(f)},this);else if(i.type==="attributes"){if(i.attributeName==="tabindex")this._manageNode(s);else if(s!==this._rootElement&&i.attributeName==="inert"&&s.hasAttribute("inert")){this._adoptInertRoot(s);var l=this._inertManager.getInertRoot(s);this._managedNodes.forEach(function(f){s.contains(f.node)&&l._manageNode(f.node)})}}},this)}},{key:"managedNodes",get:function(){return new Set(this._managedNodes)}},{key:"hasSavedAriaHidden",get:function(){return this._savedAriaHidden!==null}},{key:"savedAriaHidden",set:function(e){this._savedAriaHidden=e},get:function(){return this._savedAriaHidden}}]),o}(),c=function(){function o(t,e){O(this,o),this._node=t,this._overrodeFocusMethod=!1,this._inertRoots=new Set([e]),this._savedTabIndex=null,this._destroyed=!1,this.ensureUntabbable()}return D(o,[{key:"destructor",value:function(){if(this._throwIfDestroyed(),this._node&&this._node.nodeType===Node.ELEMENT_NODE){var e=this._node;this._savedTabIndex!==null?e.setAttribute("tabindex",this._savedTabIndex):e.removeAttribute("tabindex"),this._overrodeFocusMethod&&delete e.focus}this._node=null,this._inertRoots=null,this._destroyed=!0}},{key:"_throwIfDestroyed",value:function(){if(this.destroyed)throw new Error("Trying to access destroyed InertNode")}},{key:"ensureUntabbable",value:function(){if(this.node.nodeType===Node.ELEMENT_NODE){var e=this.node;if(r.call(e,v)){if(e.tabIndex===-1&&this.hasSavedTabIndex)return;e.hasAttribute("tabindex")&&(this._savedTabIndex=e.tabIndex),e.setAttribute("tabindex","-1"),e.nodeType===Node.ELEMENT_NODE&&(e.focus=function(){},this._overrodeFocusMethod=!0)}else e.hasAttribute("tabindex")&&(this._savedTabIndex=e.tabIndex,e.removeAttribute("tabindex"))}}},{key:"addInertRoot",value:function(e){this._throwIfDestroyed(),this._inertRoots.add(e)}},{key:"removeInertRoot",value:function(e){this._throwIfDestroyed(),this._inertRoots.delete(e),this._inertRoots.size===0&&this.destructor()}},{key:"destroyed",get:function(){return this._destroyed}},{key:"hasSavedTabIndex",get:function(){return this._savedTabIndex!==null}},{key:"node",get:function(){return this._throwIfDestroyed(),this._node}},{key:"savedTabIndex",set:function(e){this._throwIfDestroyed(),this._savedTabIndex=e},get:function(){return this._throwIfDestroyed(),this._savedTabIndex}}]),o}(),R=function(){function o(t){if(O(this,o),!t)throw new Error("Missing required argument; InertManager needs to wrap a document.");this._document=t,this._managedNodes=new Map,this._inertRoots=new Map,this._observer=new MutationObserver(this._watchForInert.bind(this)),h(t.head||t.body||t.documentElement),t.readyState==="loading"?t.addEventListener("DOMContentLoaded",this._onDocumentLoaded.bind(this)):this._onDocumentLoaded()}return D(o,[{key:"setInert",value:function(e,n){if(n){if(this._inertRoots.has(e))return;var i=new m(e,this);if(e.setAttribute("inert",""),this._inertRoots.set(e,i),!this._document.body.contains(e))for(var s=e.parentNode;s;)s.nodeType===11&&h(s),s=s.parentNode}else{if(!this._inertRoots.has(e))return;var l=this._inertRoots.get(e);l.destructor(),this._inertRoots.delete(e),e.removeAttribute("inert")}}},{key:"getInertRoot",value:function(e){return this._inertRoots.get(e)}},{key:"register",value:function(e,n){var i=this._managedNodes.get(e);return i!==void 0?i.addInertRoot(n):i=new c(e,n),this._managedNodes.set(e,i),i}},{key:"deregister",value:function(e,n){var i=this._managedNodes.get(e);return i?(i.removeInertRoot(n),i.destroyed&&this._managedNodes.delete(e),i):null}},{key:"_onDocumentLoaded",value:function(){var e=a.call(this._document.querySelectorAll("[inert]"));e.forEach(function(n){this.setInert(n,!0)},this),this._observer.observe(this._document.body||this._document.documentElement,{attributes:!0,subtree:!0,childList:!0})}},{key:"_watchForInert",value:function(e,n){var i=this;e.forEach(function(s){switch(s.type){case"childList":a.call(s.addedNodes).forEach(function(g){if(g.nodeType===Node.ELEMENT_NODE){var p=a.call(g.querySelectorAll("[inert]"));r.call(g,"[inert]")&&p.unshift(g),p.forEach(function(M){this.setInert(M,!0)},i)}},i);break;case"attributes":if(s.attributeName!=="inert")return;var l=s.target,f=l.hasAttribute("inert");i.setInert(l,f);break}},this)}}]),o}();function _(o,t,e){if(o.nodeType==Node.ELEMENT_NODE){var n=o;t&&t(n);var i=n.shadowRoot;if(i){_(i,t);return}if(n.localName=="content"){for(var s=n,l=s.getDistributedNodes?s.getDistributedNodes():[],f=0;f<l.length;f++)_(l[f],t);return}if(n.localName=="slot"){for(var g=n,p=g.assignedNodes?g.assignedNodes({flatten:!0}):[],M=0;M<p.length;M++)_(p[M],t);return}}for(var k=o.firstChild;k!=null;)_(k,t),k=k.nextSibling}function h(o){if(!o.querySelector("style#inert-style, link#inert-style")){var t=document.createElement("style");t.setAttribute("id","inert-style"),t.textContent=`
[inert] {
  pointer-events: none;
  cursor: default;
}

[inert], [inert] * {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
`,o.appendChild(t)}}if(!Element.prototype.hasOwnProperty("inert")){var C=new R(document);Object.defineProperty(Element.prototype,"inert",{enumerable:!0,get:function(){return this.hasAttribute("inert")},set:function(t){C.setInert(this,t)}})}})();const T=Q({confirm:{id:"confirmations.cancel.confirm",defaultMessage:"Discard"},cancelEditing:{id:"confirmations.cancel_editing.confirm",defaultMessage:"Cancel editing"}}),W=a=>!!a&&[a.text.length>0,a.spoiler_text.length>0,a.media_attachments.size>0,a.poll!==null].some(r=>r===!0),Y=a=>!!a&&[a.name.length>0,a.status.length>0,a.location!==null,a.banner!==null].some(r=>r===!0),X=a=>{let{children:r,onCancel:v,onClose:m,type:c}=a;const R=U(),_=z(),h=j(),[C,o]=N.useState(!!r),t=N.useRef(null),e=N.useRef(C?document.activeElement:null),n=N.useRef(),i=N.useRef(),s=L(r);L(c);const l=!!r,f=u=>{(u.key==="Escape"||u.key==="Esc"||u.keyCode===27)&&g()},g=()=>{h((u,d)=>{const E=d().compose.get("compose-modal"),w=W(E),x=Y(d().compose_event);if(w&&c==="COMPOSE"){const y=E.id!==null;h(P("CONFIRM",{icon:K,heading:y?b(I,{id:"confirmations.cancel_editing.heading",defaultMessage:"Cancel post editing"}):b(I,{id:"confirmations.cancel.heading",defaultMessage:"Discard post"}),message:y?b(I,{id:"confirmations.cancel_editing.message",defaultMessage:"Are you sure you want to cancel editing this post? All changes will be lost."}):b(I,{id:"confirmations.cancel.message",defaultMessage:"Are you sure you want to cancel creating this post?"}),confirm:R.formatMessage(T.confirm),onConfirm:()=>{h(A("COMPOSE")),h(B())},onCancel:()=>{h(A("CONFIRM"))}}))}else if(x&&c==="COMPOSE_EVENT"){const y=d().compose_event.id!==null;h(P("CONFIRM",{icon:K,heading:y?b(I,{id:"confirmations.cancel_event_editing.heading",defaultMessage:"Cancel event editing"}):b(I,{id:"confirmations.delete_event.heading",defaultMessage:"Delete event"}),message:y?b(I,{id:"confirmations.cancel_event_editing.message",defaultMessage:"Are you sure you want to cancel editing this event? All changes will be lost."}):b(I,{id:"confirmations.delete_event.message",defaultMessage:"Are you sure you want to delete this event?"}),confirm:R.formatMessage(y?T.cancelEditing:T.confirm),onConfirm:()=>{h(A("COMPOSE_EVENT")),h(J())},onCancel:()=>{h(A("CONFIRM"))}}))}else if((w||x)&&c==="CONFIRM")h(A("CONFIRM"));else if(c==="POLICY"){const y=V.getQueryData(G.policy);if(y!=null&&y.pending_policy_id)return;m()}else m()})},p=N.useCallback(u=>{if(u.key==="Tab"){const d=Array.from(t.current.querySelectorAll('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])')).filter(x=>window.getComputedStyle(x).display!=="none"),E=d.indexOf(u.target);let w;u.shiftKey?w=d[E-1]||d[d.length-1]:w=d[E+1]||d[0],w&&(w.focus(),u.stopPropagation(),u.preventDefault())}},[]),M=()=>{n.current=Date.now(),i.current=_.listen((u,d)=>{let{state:E}=u;E!=null&&E.soapboxModalKey?d==="POP"&&(g(),v&&v()):m()})},k=u=>{i.current&&i.current();const{state:d}=_.location;d&&d.soapboxModalKey===n.current&&_.goBack()},q=()=>{const{pathname:u,state:d}=_.location;(!d||d.soapboxModalKey!==n.current)&&_.push(u,{...d,soapboxModalKey:n.current})},S=()=>Array(...t.current.parentElement.childNodes).filter(u=>u.id!=="toaster").filter(u=>u!==t.current);return N.useEffect(()=>{if(l)return window.addEventListener("keyup",f,!1),window.addEventListener("keydown",p,!1),()=>{window.removeEventListener("keyup",f),window.removeEventListener("keydown",p)}},[l]),N.useEffect(()=>{var u;r&&!s?(e.current=document.activeElement,S().forEach(d=>d.setAttribute("inert","true")),M()):s||o(!1),!r&&s&&((u=e.current)==null||u.focus(),e.current=null,S().forEach(d=>d.removeAttribute("inert")),k()),r&&(requestAnimationFrame(()=>{o(!0)}),q())},[r]),l?F.createElement("div",{ref:t,className:H({"fixed top-0 left-0 z-[100] w-full h-full overflow-x-hidden overflow-y-auto":!0,"pointer-events-none":!l}),style:{opacity:C?1:0}},b("div",{role:"presentation",id:"modal-overlay",className:"fixed inset-0 bg-gray-500/90 backdrop-blur dark:bg-gray-700/90",onClick:g}),b("div",{role:"dialog",className:H({"my-2 mx-auto relative pointer-events-none flex items-center min-h-[calc(100%-3.5rem)]":!0,"p-4 md:p-0":c!=="MEDIA","!my-0":c==="MEDIA"})},void 0,r)):F.createElement("div",{className:"z-50 transition-all",ref:t,style:{opacity:0}})},$=X;export{$ as B,Y as a,W as c};
