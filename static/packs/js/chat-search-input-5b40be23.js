import{fi as Nt,fj as Qe,r as l,fk as It,fl as Rt,fm as St,fn as Et,fo as Je,fp as Tt,fq as Me,fr as Xe,fs as Y,ft as Dt,fu as At,fv as Pt,fw as Lt,fx as Ft,fy as Ot,_ as e,c1 as Bt,c7 as Z,dp as jt,dq as zt,c as le,a1 as S,df as Ht,ab as Ae,C as xe,Y as Ze,R as M,b_ as Kt,ay as Ne,H as O,u as Q,f as Ie,e_ as Re,p as ee,a8 as T,G as E,af as we,fz as Ut,aI as et,fA as Vt,n as J,fB as Gt,fC as $t,fa as qt,a as tt,em as Wt,fD as at,fE as Yt,fF as Qt,f0 as Ce,er as st,dJ as nt,fG as ot,fH as Jt,aJ as Ke,fI as Xt,bN as Zt,fJ as ea,di as Ue,cQ as rt,cs as it,bT as ta,bR as aa,fK as sa,cG as na,q as Pe,f2 as oa,fL as Ve,c9 as Se,b9 as ra,fM as ia,aE as lt,dV as la,bq as ct,eP as ca,fN as da,bk as ua,fO as ma,fP as ga,fQ as fa,cB as dt,e$ as ut,fR as ha,bH as mt,aA as gt,b as pa,f9 as va,bB as ba,fS as ya}from"../index-961d4ed1.js";import{V as Le}from"./index-c72bc579.js";import{v as xa}from"./mood-smile-6a052395.js";import{l as Ca}from"./lodash-d2d72341.js";import{u as ka}from"./useDebounce-0a090d55.js";import{P as wa}from"./pull-to-refresh-b67e1521.js";function _a({autoEscape:s,caseSensitive:t=!1,findChunks:a=ht,sanitize:n,searchWords:o,textToHighlight:r}){return pt({chunksToHighlight:ft({chunks:a({autoEscape:s,caseSensitive:t,sanitize:n,searchWords:o,textToHighlight:r})}),totalLength:r?r.length:0})}function ft({chunks:s}){return s.sort((t,a)=>t.start-a.start).reduce((t,a)=>{if(t.length===0)return[a];{const n=t.pop();if(a.start<=n.end){const o=Math.max(n.end,a.end);t.push({highlight:!1,start:n.start,end:o})}else t.push(n,a);return t}},[])}function ht({autoEscape:s,caseSensitive:t,sanitize:a=Ma,searchWords:n,textToHighlight:o}){return o=a(o||""),n.filter(r=>r).reduce((r,u)=>{u=a(u),s&&(u=Na(u));const g=new RegExp(u,t?"g":"gi");let c;for(;c=g.exec(o||"");){let f=c.index,d=g.lastIndex;d>f&&r.push({highlight:!1,start:f,end:d}),c.index===g.lastIndex&&g.lastIndex++}return r},[])}function pt({chunksToHighlight:s,totalLength:t}){const a=[];if(s.length===0)n(0,t,!1);else{let o=0;s.forEach(r=>{n(o,r.start,!1),n(r.start,r.end,!0),o=r.end}),n(o,t,!1)}return a;function n(o,r,u){r-o>0&&a.push({start:o,end:r,highlight:u})}}function Ma(s){return s}function Na(s){return s.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}var Ia={combineChunks:ft,fillInChunks:pt,findAll:_a,findChunks:ht},I="IDLE",$="SUGGESTING",ae="NAVIGATING",fe="INTERACTING",re="CLEAR",ue="CHANGE",Fe="INITIAL_CHANGE",j="NAVIGATE",Oe="SELECT_WITH_KEYBOARD",ie="SELECT_WITH_CLICK",he="ESCAPE",me="BLUR",_e="INTERACT",ge="FOCUS",Ee="OPEN_WITH_BUTTON",Be="OPEN_WITH_INPUT_CLICK",ye="CLOSE_WITH_BUTTON",Ra={initial:I,states:{[I]:{on:{[me]:I,[re]:I,[ue]:$,[Fe]:I,[ge]:$,[j]:ae,[Ee]:$,[Be]:$}},[$]:{on:{[ue]:$,[ge]:$,[j]:ae,[re]:I,[he]:I,[me]:I,[ie]:I,[_e]:fe,[ye]:I}},[ae]:{on:{[ue]:$,[ge]:$,[re]:I,[me]:I,[he]:I,[j]:ae,[ie]:I,[Oe]:I,[ye]:I,[_e]:fe}},[fe]:{on:{[re]:I,[ue]:$,[ge]:$,[me]:I,[he]:I,[j]:ae,[ye]:I,[ie]:I}}}},Sa=(s,t)=>{let a={...s,lastEventType:t.type};switch(t.type){case ue:case Fe:return{...a,navigationValue:null,value:t.value};case j:case Ee:case Be:return{...a,navigationValue:Ge(a,t)};case re:return{...a,value:"",navigationValue:null};case me:case he:return{...a,navigationValue:null};case ie:return{...a,value:t.isControlled?s.value:t.value,navigationValue:null};case Oe:return{...a,value:t.isControlled?s.value:s.navigationValue,navigationValue:null};case ye:return{...a,navigationValue:null};case _e:return a;case ge:return{...a,navigationValue:Ge(a,t)};default:return a}};function Ea(s){return[$,ae,fe].includes(s)}function Ge(s,t){return t.value?t.value:t.persistSelection?s.value:null}var je=Nt("ComboboxDescendantContext"),te=Qe("ComboboxContext",{}),vt=Qe("OptionContext",{}),bt=l.forwardRef(({onSelect:s,openOnFocus:t=!1,children:a,as:n="div","aria-label":o,"aria-labelledby":r,...u},g)=>{let[c,f]=It(),d=l.useRef(),p=l.useRef(),v=l.useRef(),y=l.useRef(!1),h=l.useRef(!1),w={value:"",navigationValue:null},[b,x,i]=Aa(Ra,Sa,w);Da(x.lastEventType,d);let _=Rt(u.id),F=_?St("listbox",_):"listbox",z=l.useRef(!1),P=Ea(b),H={ariaLabel:o,ariaLabelledby:r,autocompletePropRef:y,buttonRef:v,comboboxId:_,data:x,inputRef:d,isExpanded:P,listboxId:F,onSelect:s||Ot,openOnFocus:t,persistSelectionRef:h,popoverRef:p,state:b,transition:i,isControlledRef:z};return l.createElement(Et,{context:je,items:c,set:f},l.createElement(te.Provider,{value:H},l.createElement(n,{...u,"data-reach-combobox":"","data-state":He(b),"data-expanded":P||void 0,ref:g},Je(a)?a({id:_,isExpanded:P,navigationValue:x.navigationValue??null,state:b}):a)))});bt.displayName="Combobox";var yt=l.forwardRef(({as:s="input",selectOnClick:t=!1,autocomplete:a=!0,onClick:n,onChange:o,onKeyDown:r,onBlur:u,onFocus:g,value:c,...f},d)=>{let{current:p}=l.useRef(c),v=l.useRef(!1);Tt(()=>{v.current=!0},[c]);let{data:{navigationValue:y,value:h,lastEventType:w},inputRef:b,state:x,transition:i,listboxId:_,autocompletePropRef:F,openOnFocus:z,isExpanded:P,ariaLabel:H,ariaLabelledby:K,persistSelectionRef:q,isControlledRef:V}=l.useContext(te),G=Me(b,d),R=l.useRef(!1),D=ze(),B=_t(),m=typeof c<"u",A=typeof p<"u";!m&&A&&console.warn("ComboboxInput is changing from controlled to uncontrolled. ComboboxInput should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled ComboboxInput for the lifetime of the component. Check the `value` prop being passed in."),m&&!A&&console.warn("ComboboxInput is changing from uncontrolled to controlled. ComboboxInput should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled ComboboxInput for the lifetime of the component. Check the `value` prop being passed in."),l.useEffect(()=>{V.current=m},[m]),Xe(()=>{F.current=a},[a,F]);let L=l.useCallback(k=>{k.trim()===""?i(re,{isControlled:m}):k===p&&!v.current?i(Fe,{value:k}):i(ue,{value:k})},[p,i,m]);l.useEffect(()=>{m&&c!==h&&(c.trim()!==""||(h||"").trim()!=="")&&L(c)},[c,L,m,h]),l.useEffect(()=>{var X;let k=(X=b.current)==null?void 0:X.form;if(!k)return;function U(Te){i(re,{isControlled:m})}return k.addEventListener("reset",U),()=>{k==null||k.removeEventListener("reset",U)}},[b,m,i]);function se(k){let{value:U}=k.target;m||L(U)}function W(){t&&(R.current=!0),z&&w!==ie&&i(ge,{persistSelection:q.current})}function N(){var k;R.current&&(R.current=!1,(k=b.current)==null||k.select()),z&&x===I&&i(Be)}let C=a&&(x===ae||x===fe)?y||c||h:c||h;return l.createElement(s,{"aria-activedescendant":y?String(Mt(y)):void 0,"aria-autocomplete":"both","aria-controls":_,"aria-expanded":P,"aria-haspopup":"listbox","aria-label":H,"aria-labelledby":H?void 0:K,role:"combobox",...f,"data-reach-combobox-input":"","data-state":He(x),ref:G,onBlur:Y(u,B),onChange:Y(o,se),onClick:Y(n,N),onFocus:Y(g,W),onKeyDown:Y(r,D),value:C||""})});yt.displayName="ComboboxInput";var xt=l.forwardRef(({as:s="div",children:t,portal:a=!0,onKeyDown:n,onBlur:o,position:r=At,...u},g)=>{let{popoverRef:c,inputRef:f,isExpanded:d,state:p}=l.useContext(te),v=Me(c,g),y=ze(),h=_t(),w={"data-reach-combobox-popover":"","data-state":He(p),onKeyDown:Y(n,y),onBlur:Y(o,h),hidden:!d,tabIndex:-1,children:t};return a?l.createElement(Dt,{as:s,...u,ref:v,"data-expanded":d||void 0,position:r,targetRef:f,unstable_skipInitialPortalRender:!0,...w}):l.createElement(s,{ref:v,...u,...w})});xt.displayName="ComboboxPopover";var Ct=l.forwardRef(({persistSelection:s=!1,as:t="ul",...a},n)=>{let{persistSelectionRef:o,listboxId:r}=l.useContext(te);return s&&(o.current=!0),l.createElement(t,{role:"listbox",...a,ref:n,"data-reach-combobox-list":"",id:r})});Ct.displayName="ComboboxList";var kt=l.forwardRef(({as:s="li",children:t,index:a,value:n,onClick:o,...r},u)=>{let{onSelect:g,data:{navigationValue:c},transition:f,isControlledRef:d}=l.useContext(te),p=l.useRef(null),[v,y]=Pt(p,null),h=l.useMemo(()=>({element:v,value:n}),[n,v]),w=Lt(h,je,a),b=Me(u,y),x=c===n,i=()=>{g&&g(n),f(ie,{value:n,isControlled:d.current})};return l.createElement(vt.Provider,{value:{value:n,index:w}},l.createElement(s,{"aria-selected":x,role:"option",...r,"data-reach-combobox-option":"",ref:b,id:String(Mt(n)),"data-highlighted":x?"":void 0,tabIndex:-1,onClick:Y(o,i)},t?Je(t)?t({value:n,index:w}):t:l.createElement(wt,null)))});kt.displayName="ComboboxOption";function wt(){let{value:s}=l.useContext(vt),{data:{value:t}}=l.useContext(te),a=l.useMemo(()=>Ia.findAll({searchWords:Pa(t||"").split(/\s+/),textToHighlight:s}),[t,s]);return l.createElement(l.Fragment,null,a.length?a.map((n,o)=>{let r=s.slice(n.start,n.end);return l.createElement("span",{key:o,"data-reach-combobox-option-text":"","data-user-value":n.highlight?!0:void 0,"data-suggested-value":n.highlight?void 0:!0},r)}):s)}wt.displayName="ComboboxOptionText";var Ta=l.forwardRef(({as:s="button",onClick:t,onKeyDown:a,...n},o)=>{let{transition:r,state:u,buttonRef:g,listboxId:c,isExpanded:f}=l.useContext(te),d=Me(g,o),p=ze(),v=()=>{r(u===I?Ee:ye)};return l.createElement(s,{"aria-controls":c,"aria-haspopup":"listbox","aria-expanded":f,...n,"data-reach-combobox-button":"",ref:d,onClick:Y(t,v),onKeyDown:Y(a,p)})});Ta.displayName="ComboboxButton";function Da(s,t){Xe(()=>{var a;(s===j||s===he||s===ie||s===Ee)&&((a=t.current)==null||a.focus())},[t,s])}function ze(){let{data:{navigationValue:s},onSelect:t,state:a,transition:n,autocompletePropRef:o,persistSelectionRef:r,inputRef:u,isControlledRef:g}=l.useContext(te),c=Ft(je);return function(d){var x;let p=c.findIndex(({value:i})=>i===s);function v(){return p===c.length-1?o.current?null:h():c[(p+1)%c.length]}function y(){return p===0?o.current?null:w():p===-1?w():c[(p-1+c.length)%c.length]}function h(){return c[0]}function w(){return c[c.length-1]}let b=((x=u.current)==null?void 0:x.tagName.toUpperCase())==="TEXTAREA"&&u.current.value.includes(`
`);switch(d.key){case"ArrowDown":if(!c||!c.length)return;if(a===I){if(b)return;d.preventDefault(),n(j,{persistSelection:r.current})}else{d.preventDefault();let i=v();n(j,{value:i?i.value:null})}break;case"ArrowUp":if(!c||!c.length)return;if(a===I){if(b)return;d.preventDefault(),n(j,{persistSelection:r.current})}else{d.preventDefault();let i=y();n(j,{value:i?i.value:null})}break;case"Home":case"PageUp":if(d.preventDefault(),!c||c.length===0)return;a===I?n(j):n(j,{value:h().value});break;case"End":case"PageDown":if(d.preventDefault(),!c||c.length===0)return;a===I?n(j):n(j,{value:w().value});break;case"Escape":a!==I&&n(he);break;case"Enter":a===ae&&s!==null&&(d.preventDefault(),t&&t(s),n(Oe,{isControlled:g.current}));break}}}function _t(){let{state:s,transition:t,popoverRef:a,inputRef:n,buttonRef:o}=l.useContext(te);return function(u){let g=a.current,c=n.current,f=o.current,d=u.relatedTarget;d!==c&&d!==f&&g&&(g.contains(d)?s!==fe&&t(_e):t(me))}}function Aa(s,t,a){let[n,o]=l.useState(s.initial),[r,u]=l.useReducer(t,a);return[n,r,(c,f={})=>{let d=s.states[n],p=d&&d.on[c];if(p){u({type:c,state:n,nextState:n,...f}),o(p);return}}]}function Mt(s){let t=0;if(s.length===0)return t;for(let a=0;a<s.length;a++)t=(t<<5)-t+s.charCodeAt(a),t=t&t;return t}function He(s){return s.toLowerCase()}function Pa(s){return String(s).replace(/([.*+?=^!:${}()|[\]/\\])/g,"\\$1")}const La=s=>{let{progress:t}=s;return e("div",{className:"relative isolate inline-flex h-24 w-24 items-center justify-center overflow-hidden rounded-lg bg-gray-200 p-4 dark:bg-primary-900"},void 0,e(Bt,{progress:t,size:"sm"}))},Fa=zt,Oa=s=>{let{className:t,attachment:a}=s;const n=a.pleroma.get("mime_type");switch(a.type){case"image":case"gifv":return e("img",{className:"pointer-events-none h-full w-full object-cover",src:a.preview_url,alt:""});case"video":return e("video",{className:"pointer-events-none h-full w-full object-cover",src:a.preview_url,autoPlay:!0,playsInline:!0,controls:!1,muted:!0,loop:!0});default:return e("div",{className:"pointer-events-none flex h-full w-full items-center justify-center"},void 0,e(Z,{className:"mx-auto my-12 h-16 w-16 text-gray-800 dark:text-gray-200",src:jt[n||""]||Fa}))}},Ba=s=>{let{attachment:t,onDelete:a}=s;const n=le(),o=t.type!=="unknown",r=()=>{n(xe("MEDIA",{media:Ze.of(t),index:0}))};return e("div",{className:"relative isolate inline-block h-24 w-24 overflow-hidden rounded-lg bg-gray-200 dark:bg-primary-900"},void 0,e(Ht,{hash:t.blurhash,className:"absolute inset-0 -z-10 h-full w-full"}),e("div",{className:"absolute right-[6px] top-[6px]"},void 0,e(ja,{onClick:a})),e("button",{onClick:o?r:void 0,className:S("h-full w-full",{"cursor-zoom-in":o,"cursor-default":!o})},void 0,e(Oa,{attachment:t})))},ja=s=>{let{onClick:t}=s;return e("button",{type:"button",onClick:t,className:"flex h-5 w-5 items-center justify-center rounded-full bg-secondary-500 p-1"},void 0,e(Z,{className:"h-3 w-3 text-white",src:Ae}))},za=M.forwardRef((s,t)=>{let{attachments:a,onDeleteAttachment:n,uploadCount:o=0,uploadProgress:r=0,...u}=s;const g=o>0,c=f=>()=>{n&&n(f)};return e("div",{className:`
      block
      w-full
      rounded-md border border-gray-400
      bg-white text-gray-900
      shadow-sm placeholder:text-gray-600
      focus-within:border-primary-500
      focus-within:ring-1 focus-within:ring-primary-500 dark:border-gray-800 dark:bg-gray-800
      dark:text-gray-100 dark:ring-1 dark:ring-gray-800 dark:placeholder:text-gray-600 dark:focus-within:border-primary-500
      dark:focus-within:ring-primary-500 sm:text-sm
    `},void 0,(!!(a!=null&&a.length)||g)&&e(O,{className:"-ml-2 -mt-2 p-3 pb-0",wrap:!0},void 0,a==null?void 0:a.map((f,d)=>e("div",{className:"ml-2 mt-2 flex"},void 0,e(Ba,{attachment:f,onDelete:c(d)},f.id))),Array.from(Array(o)).map(()=>e("div",{className:"ml-2 mt-2 flex"},void 0,e(La,{progress:r})))),M.createElement(Kt,Ne({ref:t,theme:"transparent"},u)))}),ne=J({placeholder:{id:"chat.input.placeholder",defaultMessage:"Type a message"},send:{id:"chat.actions.send",defaultMessage:"Send"},retry:{id:"chat.retry",defaultMessage:"Retry?"},blocked:{id:"chat_message_list.blocked",defaultMessage:"You blocked this user"},unblock:{id:"chat_composer.unblock",defaultMessage:"Unblock"},unblockMessage:{id:"chat_settings.unblock.message",defaultMessage:"Unblocking will allow this profile to direct message you and view your content."},unblockHeading:{id:"chat_settings.unblock.heading",defaultMessage:"Unblock @{acct}"},unblockConfirm:{id:"chat_settings.unblock.confirm",defaultMessage:"Unblock"}}),De={list:[],tokenStart:0,token:""},Ha=M.forwardRef((s,t)=>{let{onKeyDown:a,onChange:n,value:o,onSubmit:r,errorMessage:u=!1,disabled:g=!1,onSelectFile:c,resetFileKey:f,resetContentKey:d,onPaste:p,attachments:v=[],onDeleteAttachment:y,uploadCount:h=0,uploadProgress:w}=s;const b=Q(),x=le(),i=Ie(),{chat:_}=Re(),F=ee(C=>{var k;return C.getIn(["relationships",(k=_==null?void 0:_.account)==null?void 0:k.id,"blocked_by"])}),z=ee(C=>{var k;return C.getIn(["relationships",(k=_==null?void 0:_.account)==null?void 0:k.id,"blocking"])}),P=ee(C=>C.instance.getIn(["configuration","chats","max_characters"])),H=ee(C=>C.instance.configuration.getIn(["chats","max_media_attachments"])),[K,q]=l.useState(De),V=K.list.length>0,G=h>0,R=v.length>0,D=P&&(o==null?void 0:o.length)>P,B=g||G||D||o.length===0&&!R,m=P?P-(o==null?void 0:o.length):"",A=C=>`${o.slice(0,K.tokenStart)}${C.native} ${o.slice(K.tokenStart+K.token.length)}`,L=C=>{n&&(n({target:{value:C}}),q(De))},se=C=>{const[k,U]=Gt(C.target.value,C.target.selectionStart,[":"]);if(U&&k){const X=$t(U.replace(":",""),{maxResults:5});q({list:X,token:U,tokenStart:k-1})}else q(De);n&&n(C)},W=C=>{C.key==="Enter"&&!C.shiftKey&&V||a&&a(C)},N=()=>{x(xe("CONFIRM",{heading:b.formatMessage(ne.unblockHeading,{acct:_==null?void 0:_.account.acct}),message:b.formatMessage(ne.unblockMessage),confirm:b.formatMessage(ne.unblockConfirm),confirmationTheme:"primary",onConfirm:()=>x(qt(_==null?void 0:_.account.id))}))};return z?e("div",{className:"mt-auto p-6 shadow-3xl dark:border-t-2 dark:border-solid dark:border-gray-800"},void 0,e(T,{space:3,alignItems:"center"},void 0,e(E,{align:"center",theme:"muted"},void 0,b.formatMessage(ne.blocked)),e(we,{theme:"secondary",onClick:N},void 0,b.formatMessage(ne.unblock)))):F?null:e("div",{className:"mt-auto px-4 shadow-3xl"},void 0,e("div",{className:"h-5"}),e(O,{alignItems:"stretch",justifyContent:"between",space:4},void 0,i.chatsMedia&&e(T,{justifyContent:"end",alignItems:"center",className:"mb-1.5 w-10"},void 0,e(Ut,{onSelectFile:c,resetFileKey:f,iconClassName:"h-5 w-5",className:"text-primary-500",disabled:G||v.length>=H})),e(T,{grow:!0},void 0,e(bt,{onSelect:L},void 0,M.createElement(yt,{key:d,as:za,autoFocus:!0,ref:t,placeholder:b.formatMessage(ne.placeholder),onKeyDown:W,value:o,onChange:se,onPaste:p,isResizeable:!1,autoGrow:!0,maxRows:5,disabled:g,attachments:v,onDeleteAttachment:y,uploadCount:h,uploadProgress:w}),V?e(xt,{},void 0,e(Ct,{},void 0,K.list.map(C=>e(kt,{value:A(C)},C.colons,e("span",{},void 0,C.native),e("span",{className:"ml-1"},void 0,C.colons))))):null)),e(T,{space:2,justifyContent:"end",alignItems:"center",className:"mb-1.5 w-10"},void 0,D?e(E,{size:"sm",theme:"danger"},void 0,m):null,e(et,{src:Vt,iconClassName:"h-5 w-5",className:"text-primary-500",disabled:B,onClick:r}))),e(O,{alignItems:"center",className:"h-5",space:1},void 0,u&&M.createElement(M.Fragment,null,e(E,{theme:"danger",size:"xs"},void 0,u),e("button",{onClick:r,className:"flex hover:underline"},void 0,e(E,{theme:"primary",size:"xs",tag:"span"},void 0,b.formatMessage(ne.retry))))))}),pe=s=>{let{isMyMessage:t=!1}=s;const a=Wt(160,220);return e(T,{"data-testid":"placeholder-chat-message",space:1,className:S({"max-w-[85%] animate-pulse":!0,"ml-auto":t})},void 0,e(O,{alignItems:"center",justifyContent:t?"end":"start"},void 0,e("div",{className:S({"text-ellipsis break-words relative rounded-md p-2":!0,"mr-2":t,"order-2 ml-2":!t})},void 0,e("div",{style:{width:a,height:20},className:"rounded-full bg-primary-50 dark:bg-primary-800"})),e("div",{className:S({"order-1":!t})},void 0,e(tt,{size:34}))),e(O,{alignItems:"center",space:2,className:S({"ml-auto":t})},void 0,e(E,{theme:"muted",size:"xs",className:S({"text-right":t,"order-2":!t})},void 0,e("span",{style:{width:50,height:12},className:"block rounded-full bg-primary-50 dark:bg-primary-800"})),e("div",{className:S({"order-1":!t})},void 0,e("div",{className:"ml-2 w-[34px]"}))))},Ka="/packs/assets/copy-292e64b6.svg",Ua=s=>{const{emojiReaction:t,onAddReaction:a,onRemoveReaction:n}=s,o=t.me;return e("button",{type:"button",onClick:()=>{o?n(t.name):a(t.name)},className:S({"w-12 rounded-lg flex justify-between text-sm border items-center border-solid text-gray-700 dark:text-gray-600 px-2 py-1 space-x-1.5 transition-colors hover:bg-gray-200 dark:hover:bg-gray-800 whitespace-nowrap":!0,"border-primary-500 dark:border-primary-400":t.me,"border-gray-300 dark:border-gray-800":!t.me})},void 0,e("span",{dangerouslySetInnerHTML:{__html:at(t.name)}}),e(E,{tag:"span",weight:"medium",size:"sm"},void 0,t.count))};function Va(s){const{onOpen:t,onSelect:a,children:n}=s,[o,r]=l.useState(!1),[u,g]=l.useState(null),c=d=>{a(d),r(!1)},f=()=>r(d=>!d);return l.useEffect(()=>{t(o)},[o]),e(M.Fragment,{},void 0,M.cloneElement(n,{ref:g,onClick:f}),o&&e(Yt,{},void 0,e(Qt,{visible:o,referenceElement:u,onReact:c,onClose:()=>r(!1),offsetOptions:{mainAxis:12,crossAxis:-10},all:!1})))}const ce=J({copy:{id:"chats.actions.copy",defaultMessage:"Copy"},delete:{id:"chats.actions.delete",defaultMessage:"Delete for both"},deleteForMe:{id:"chats.actions.deleteForMe",defaultMessage:"Delete for me"},more:{id:"chats.actions.more",defaultMessage:"More"},report:{id:"chats.actions.report",defaultMessage:"Report"}}),Ga=3,$a=s=>s.get("emojis",Ze()).reduce((t,a)=>t.set(`:${a.get("shortcode")}:`,a),na()),qa=s=>Ca.escape(s).replace(/(?:\r\n|\r|\n)/g,"<br>"),Wa=s=>{const t=s.content||"",a=s.pending,n=s.deleting,o=a&&!n?qa(t):t,r=$a(s);return at(o,r.toJS())},Ya=s=>{var R,D,B;const{chat:t,chatMessage:a}=s,n=le(),o=Ie(),r=Q(),u=ee(m=>m.me),{createReaction:g,deleteChatMessage:c,deleteReaction:f}=Ce(t.id),[d,p]=l.useState(!1),[v,y]=l.useState(!1),h=st(m=>c(m),{onSettled:()=>{nt.invalidateQueries(ot.chatMessages(t.id))}}),w=Wa(a),b=(D=(R=t.latest_read_message_by_account)==null?void 0:R.find(m=>m.id===t.account.id))==null?void 0:D.date,x=b?new Date(b):null,i=a.account_id===u,_=i&&x&&x>=new Date(a.created_at),F=l.useMemo(()=>{const m=document.createElement("div");return m.innerHTML=w,Jt(m,Ga,!1)},[]),z=l.useMemo(()=>a.emoji_reactions?a.emoji_reactions.reduce((m,A,L)=>(L%4===0?m.push([A]):m[m.length-1].push(A))&&m,[]):[],[a.emoji_reactions]),P=(m,A)=>{n(xe("MEDIA",{media:m,index:A}))},H=m=>m.media_attachments.size?e(aa,{fetchComponent:ta},void 0,A=>e(A,{className:S({"rounded-br-sm":i&&w,"rounded-bl-sm":!i&&w}),media:m.media_attachments,onOpenMedia:P,visible:!0})):null,K=m=>{if(navigator.clipboard){const A=sa(m.content);navigator.clipboard.writeText(A)}},q=m=>{if(!m)return;m.querySelectorAll('a[rel="ugc"]').forEach(L=>{L.classList.add("chat-link"),L.setAttribute("rel","ugc nofollow noopener"),L.setAttribute("target","_blank")})},V=m=>r.formatDate(new Date(m.created_at),{hour12:!1,year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"}),G=l.useMemo(()=>{const m=[];return navigator.clipboard&&a.content&&m.push({text:r.formatMessage(ce.copy),action:()=>K(a),icon:Ka}),i?m.push({text:r.formatMessage(ce.delete),action:()=>h.mutate(a.id),icon:Ke,destructive:!0}):(o.reportChats&&m.push({text:r.formatMessage(ce.report),action:()=>n(Xt(Zt.CHAT_MESSAGE,t.account,{chatMessage:a})),icon:ea}),m.push({text:r.formatMessage(ce.deleteForMe),action:()=>h.mutate(a.id),icon:Ke,destructive:!0})),m},[a,t]);return e("div",{className:S({"group relative px-4 py-2 hover:bg-gray-200/40 dark:hover:bg-gray-800/40":!0,"bg-gray-200/40 dark:bg-gray-800/40":v||d}),"data-testid":"chat-message"},void 0,e("div",{className:S({"p-1 flex items-center space-x-0.5 z-10 absolute opacity-0 transition-opacity group-hover:opacity-100 focus:opacity-100 rounded-md shadow-lg bg-white dark:bg-gray-900 dark:ring-2 dark:ring-primary-700":!0,"top-2 right-2":!i,"top-2 left-2":i,"!opacity-100":v||d})},void 0,o.chatEmojiReactions&&e(Va,{onOpen:p,onSelect:m=>g.mutate({emoji:m,messageId:a.id,chatMessage:a})},void 0,e("button",{title:r.formatMessage(ce.more),className:S({"p-1.5 hover:bg-gray-200 dark:hover:bg-gray-800 rounded-md text-gray-600 dark:text-gray-600 hover:text-gray-700 dark:hover:text-gray-500 focus:text-gray-700 dark:focus:text-gray-500 focus:ring-0":!0,"!text-gray-700 dark:!text-gray-500":d})},void 0,e(Z,{src:xa,className:"h-4 w-4"}))),G.length>0&&e(rt,{items:G,onOpen:()=>y(!0),onClose:()=>y(!1)},void 0,e("button",{title:r.formatMessage(ce.more),className:S({"p-1.5 hover:bg-gray-200 dark:hover:bg-gray-800 rounded-md text-gray-600 dark:text-gray-600 hover:text-gray-700 dark:hover:text-gray-500 focus:text-gray-700 dark:focus:text-gray-500 focus:ring-0":!0,"!text-gray-700 dark:!text-gray-500":v}),"data-testid":"chat-message-menu"},void 0,e(Z,{src:it,className:"h-4 w-4"})))),e(T,{space:1.5,className:S({"ml-auto":i})},void 0,e(O,{alignItems:"center",justifyContent:i?"end":"start",className:S({"opacity-50":a.pending})},void 0,e(T,{space:.5,className:S({"max-w-[85%]":!0,"flex-1":!!a.media_attachments.size,"order-3":i,"order-1":!i}),alignItems:i?"end":"start"},void 0,H(a),w&&e(O,{alignItems:"bottom",className:"max-w-full"},void 0,M.createElement("div",{title:V(a),className:S({"text-ellipsis break-words relative rounded-md py-2 px-3 max-w-full space-y-2 [&_.mention]:underline":!0,"rounded-tr-sm":!!a.media_attachments.size&&i,"rounded-tl-sm":!!a.media_attachments.size&&!i,"[&_.mention]:text-primary-600 dark:[&_.mention]:text-accent-blue":!i,"[&_.mention]:text-white dark:[&_.mention]:white":i,"bg-primary-500 text-white":i,"bg-gray-200 dark:bg-gray-800 text-gray-900 dark:text-gray-100":!i,"!bg-transparent !p-0 emoji-lg":F}),ref:q,tabIndex:0},e(E,{size:"sm",theme:"inherit",className:"break-word-nested",dangerouslySetInnerHTML:{__html:w}}))))),(B=a.emoji_reactions)!=null&&B.length?e("div",{className:S({"space-y-1":!0,"ml-auto":i,"mr-auto":!i})},void 0,z==null?void 0:z.map((m,A)=>e(O,{className:S({"flex items-center gap-1":!0,"flex-row-reverse":i})},A,m.map((L,se)=>e(Ua,{emojiReaction:L,onAddReaction:W=>g.mutate({emoji:W,messageId:a.id,chatMessage:a}),onRemoveReaction:W=>f.mutate({emoji:W,messageId:a.id})},se))))):null,e(O,{alignItems:"center",space:2,className:S({"ml-auto":i})},void 0,e("div",{className:S({"text-right":i,"order-2":!i})},void 0,e("span",{className:"flex items-center space-x-1.5"},void 0,e(E,{theme:"muted",size:"xs"},void 0,r.formatTime(a.created_at)),i&&o.chatsReadReceipts?M.createElement(M.Fragment,null,_?e("span",{className:"flex flex-col items-center justify-center rounded-full border border-solid border-primary-500 bg-primary-500 p-0.5 text-white dark:border-primary-400 dark:bg-primary-400 dark:text-primary-900"},void 0,e(Z,{src:Ue,strokeWidth:3,className:"h-2.5 w-2.5"})):e("span",{className:"flex flex-col items-center justify-center rounded-full border border-solid border-primary-500 bg-transparent p-0.5 text-primary-500 dark:border-primary-400 dark:text-primary-400"},void 0,e(Z,{src:Ue,strokeWidth:3,className:"h-2.5 w-2.5"}))):null)))))},Qa="/packs/assets/clock-29a0b6f1.svg",oe=J({leaveChatHeading:{id:"chat_message_list_intro.leave_chat.heading",defaultMessage:"Leave Chat"},leaveChatMessage:{id:"chat_message_list_intro.leave_chat.message",defaultMessage:"Are you sure you want to leave this chat? Messages will be deleted for you and this chat will be removed from your inbox."},leaveChatConfirm:{id:"chat_message_list_intro.leave_chat.confirm",defaultMessage:"Leave Chat"},intro:{id:"chat_message_list_intro.intro",defaultMessage:"wants to start a chat with you"},accept:{id:"chat_message_list_intro.actions.accept",defaultMessage:"Accept"},leaveChat:{id:"chat_message_list_intro.actions.leave_chat",defaultMessage:"Leave chat"},report:{id:"chat_message_list_intro.actions.report",defaultMessage:"Report"},messageLifespan:{id:"chat_message_list_intro.actions.message_lifespan",defaultMessage:"Messages older than {day, plural, one {# day} other {# days}} are deleted."}}),Ja=()=>{const s=le(),t=Q(),a=Ie(),n=Pe(),{chat:o,isUsingMainChatPage:r,needsAcceptance:u}=Re(),{acceptChat:g,deleteChat:c}=Ce(o==null?void 0:o.id),f=()=>{s(xe("CONFIRM",{heading:t.formatMessage(oe.leaveChatHeading),message:t.formatMessage(oe.leaveChatMessage),confirm:t.formatMessage(oe.leaveChatConfirm),confirmationTheme:"primary",onConfirm:()=>{c.mutate(void 0,{onSuccess(){r&&n.push("/chats")}})}}))};return!o||!a.chatAcceptance?null:e(T,{"data-testid":"chat-message-list-intro",justifyContent:"center",alignItems:"center",space:4,className:S({"w-3/4 mx-auto":u,"py-6":!0})},void 0,e(T,{alignItems:"center",space:2},void 0,e(Ve,{to:`/@${o.account.acct}`},void 0,e(Se,{src:o.account.avatar_static,size:75})),e(E,{size:"lg",align:"center"},void 0,u?M.createElement(M.Fragment,null,e(E,{tag:"span",weight:"semibold"},void 0,"@",o.account.acct)," ",e(E,{tag:"span"},void 0,t.formatMessage(oe.intro))):e(Ve,{to:`/@${o.account.acct}`},void 0,e(E,{tag:"span",theme:"inherit",weight:"semibold"},void 0,"@",o.account.acct)))),u?e(O,{alignItems:"center",space:2,className:"w-full"},void 0,e(we,{theme:"primary",block:!0,onClick:()=>g.mutate(),disabled:g.isLoading},void 0,t.formatMessage(oe.accept)),e(we,{theme:"danger",block:!0,onClick:f},void 0,t.formatMessage(oe.leaveChat))):e(O,{justifyContent:"center",alignItems:"center",space:1,className:"shrink-0"},void 0,e(Z,{src:Qa,className:"h-4 w-4 text-gray-600"}),o.message_expiration&&e(E,{size:"sm",theme:"muted"},void 0,t.formatMessage(oe.messageLifespan,{day:oa(o.message_expiration)}))))},ve=J({today:{id:"chats.dividers.today",defaultMessage:"Today"},more:{id:"chats.actions.more",defaultMessage:"More"},delete:{id:"chats.actions.delete",defaultMessage:"Delete for both"},copy:{id:"chats.actions.copy",defaultMessage:"Copy"},report:{id:"chats.actions.report",defaultMessage:"Report"},deleteForMe:{id:"chats.actions.deleteForMe",defaultMessage:"Delete for me"},blockedBy:{id:"chat_message_list.blockedBy",defaultMessage:"You are blocked by"},networkFailureTitle:{id:"chat_message_list.network_failure.title",defaultMessage:"Whoops!"},networkFailureSubtitle:{id:"chat_message_list.network_failure.subtitle",defaultMessage:"We encountered a network failure."},networkFailureAction:{id:"chat_message_list.network_failure.action",defaultMessage:"Try again"}}),Xa=(s,t)=>{const a=new Date(s.created_at).getDate(),n=new Date(t.created_at).getDate(),o=new Date().getDate();return a!==n?n===o?"today":"date":null},$e=1e4,Za=M.forwardRef((s,t)=>{const{context:a,...n}=s;return M.createElement("div",Ne({ref:t},n,{className:"mb-2"}))}),es=M.forwardRef((s,t)=>{const{style:a,context:n,...o}=s;return M.createElement("div",Ne({},o,{ref:t,style:{...a,scrollbarGutter:"stable"}}))}),ts=s=>{var V,G;let{chat:t}=s;const a=Q(),{account:n}=ra(),o=(G=(V=t.latest_read_message_by_account)==null?void 0:V.find(R=>R.id===(n==null?void 0:n.id)))==null?void 0:G.date,r=o?new Date(o):null,u=l.useRef(null),[g,c]=l.useState($e-20),{markChatAsRead:f}=Ce(t.id),{data:d,fetchNextPage:p,hasNextPage:v,isError:y,isFetching:h,isFetchingNextPage:w,isLoading:b,refetch:x}=ia(t),i=d||[],_=ee(R=>R.getIn(["relationships",t.account.id,"blocked_by"])),F=d?d[d.length-1]:null;l.useEffect(()=>{if(!d)return;const R=$e-d.length;c(R)},[F]);const P=(()=>{if(!d)return[];const R=new Date().getFullYear();return d.reduce((D,B,m)=>{const A=i[m-1],L=new Date(B.created_at);if(A)switch(Xa(A,B)){case"today":D.push({type:"divider",text:a.formatMessage(ve.today)});break;case"date":D.push({type:"divider",text:a.formatDate(L,{weekday:"short",hour:"numeric",minute:"2-digit",month:"short",day:"numeric",year:L.getFullYear()!==R?"2-digit":void 0})});break}return D.push(B),D},[])})(),H=l.useMemo(()=>({initialTopMostItemIndex:P.length-1,firstItemIndex:Math.max(0,g)}),[P.length,g]),K=l.useCallback(()=>(v&&!h&&p(),!1),[g,v,h]),q=(R,D)=>e(la,{text:D,textSize:"xs"},R);return l.useEffect(()=>{const R=i[i.length-1];if(!R)return;const D=R.id,B=R.pending,m=r?r>=new Date(R.created_at):!1;!B&&!m&&f(D)},[i.length]),_?e(T,{alignItems:"center",justifyContent:"center",className:"h-full grow"},void 0,e(T,{alignItems:"center",space:2},void 0,e(Se,{src:t.account.avatar,size:75}),e(E,{align:"center"},void 0,M.createElement(M.Fragment,null,e(E,{tag:"span"},void 0,a.formatMessage(ve.blockedBy))," ",e(E,{tag:"span",theme:"primary"},void 0,"@",t.account.acct))))):y?e(T,{alignItems:"center",justifyContent:"center",className:"h-full grow"},void 0,e(T,{space:4},void 0,e(T,{space:1},void 0,e(E,{size:"lg",weight:"bold",align:"center"},void 0,a.formatMessage(ve.networkFailureTitle)),e(E,{theme:"muted",align:"center"},void 0,a.formatMessage(ve.networkFailureSubtitle))),e("div",{className:"mx-auto"},void 0,e(we,{theme:"primary",onClick:()=>x()},void 0,a.formatMessage(ve.networkFailureAction))))):b?e("div",{className:"flex grow flex-col justify-end pb-4"},void 0,e("div",{className:"px-4"},void 0,e(pe,{isMyMessage:!0}),e(pe,{}),e(pe,{isMyMessage:!0}),e(pe,{isMyMessage:!0}),e(pe,{}))):e("div",{className:"flex h-full grow flex-col space-y-6"},void 0,e("div",{className:"flex grow flex-col justify-end"},void 0,M.createElement(Le,Ne({ref:u,alignToBottom:!0},H,{data:P,startReached:K,followOutput:"auto",itemContent:(R,D)=>D.type==="divider"?q(R,D.text):e(Ya,{chat:t,chatMessage:D}),components:{List:Za,Scroller:es,Header:()=>v||w?e(lt,{withText:!1}):!v&&!b?e(Ja,{}):null}}))))},be=()=>Math.floor(Math.random()*65536),qe=J({failedToSend:{id:"chat.failed_to_send",defaultMessage:"Message failed to send."},uploadErrorLimit:{id:"upload_error.limit",defaultMessage:"File upload limit exceeded."}}),as=s=>{var a;const t=(a=Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value"))==null?void 0:a.set;if(t){t.call(s,"");const n=new Event("input",{bubbles:!0});s.dispatchEvent(n)}},ps=s=>{let{chat:t,inputRef:a,className:n}=s;const o=Q(),r=le(),{createChatMessage:u,acceptChat:g}=Ce(t.id),c=ee(N=>N.instance.configuration.getIn(["chats","max_media_attachments"])),[f,d]=l.useState(""),[p,v]=l.useState([]),[y,h]=l.useState(0),[w,b]=l.useState(0),[x,i]=l.useState(be()),[_,F]=l.useState(be()),[z,P]=l.useState(),H=f.length===0&&p.length===0,K=()=>{u.mutate({chatId:t.id,content:f,mediaIds:p.map(N=>N.id)},{onSuccess:()=>{P(void 0)},onError:(N,C,k)=>{var X,Te;const U=(Te=(X=N.response)==null?void 0:X.data)==null?void 0:Te.error;P(U||o.formatMessage(qe.failedToSend)),d(k.prevContent)}}),q()},q=()=>{a!=null&&a.current&&as(a.current),d(""),v([]),h(0),b(0),F(be()),i(be())},V=()=>{!H&&!u.isLoading&&(K(),t.accepted||g.mutate())},G=()=>d(f+`
`),R=N=>{N.key==="Enter"&&N.shiftKey?(N.preventDefault(),G()):N.key==="Enter"&&(N.preventDefault(),V())},D=N=>{d(N.target.value)},B=N=>{H&&N.clipboardData&&N.clipboardData.files.length===1&&W(N.clipboardData.files)},m=()=>{},A=()=>m(),L=N=>{const C=[...p];C.splice(N,1),v(C),F(be())},se=N=>{const{loaded:C,total:k}=N;b(C/k)},W=N=>{if(N.length+p.length>c){ct.error(qe.uploadErrorLimit);return}h(N.length);const C=Array.from(N).map(async k=>{const U=new FormData;U.append("file",k);const X=await r(ca(U,se));return da(X.data)});return Promise.all(C).then(k=>{v([...p,...k]),h(0)}).catch(()=>h(0))};return l.useEffect(()=>{a!=null&&a.current&&a.current.focus()},[t.id,a==null?void 0:a.current]),e(T,{className:S("flex grow overflow-hidden",n),onMouseOver:A},void 0,e("div",{className:"flex h-full grow justify-center overflow-hidden"},void 0,e(ts,{chat:t})),M.createElement(Ha,{ref:a,onKeyDown:R,value:f,onChange:D,onSubmit:V,errorMessage:z,onSelectFile:W,resetFileKey:_,resetContentKey:x,onPaste:B,attachments:p,onDeleteAttachment:L,uploadCount:y,uploadProgress:w}))};function ss(s){const t=ua(),a=async(r,u)=>{const c=(u==null?void 0:u.link)||"/api/v1/accounts/search",f=await t.get(c,{params:{q:r,limit:10,followers:!0}}),{data:d}=f,p=fa(f);return{result:d,link:p,hasMore:!!p}},n=ma(["search","accounts",s],({pageParam:r})=>a(s,r),{keepPreviousData:!0,getNextPageParam:r=>{if(r.hasMore)return{link:r.link}}}),o=ga(n.data);return{...n,data:o}}const We=J({title:{id:"chat_search.blankslate.title",defaultMessage:"Start a chat"},body:{id:"chat_search.blankslate.body",defaultMessage:"Search for someone to chat with."}}),ns=()=>{const s=Q();return e(T,{justifyContent:"center",alignItems:"center",space:2,className:"mx-auto h-full w-2/3"},void 0,e(E,{weight:"bold",size:"lg",align:"center"},void 0,s.formatMessage(We.title)),e(E,{theme:"muted",align:"center"},void 0,s.formatMessage(We.body)))},Ye=J({title:{id:"chat_search.empty_results_blankslate.title",defaultMessage:"No matches found"},body:{id:"chat_search.empty_results_blankslate.body",defaultMessage:"Try searching for another name."}}),os=()=>{const s=Q();return e(T,{justifyContent:"center",alignItems:"center",space:2,className:"mx-auto h-full w-2/3"},void 0,e(E,{weight:"bold",size:"lg",align:"center","data-testid":"no-results"},void 0,s.formatMessage(Ye.title)),e(E,{theme:"muted",align:"center"},void 0,s.formatMessage(Ye.body)))},rs=s=>{let{accountSearchResult:t,onSelect:a}=s;const{data:n,isFetching:o,hasNextPage:r,fetchNextPage:u}=t,[g,c]=l.useState(!1),[f,d]=l.useState(!0),p=()=>{r&&!o&&u()},v=l.useCallback((y,h)=>e("button",{type:"button",className:"flex w-full flex-col rounded-lg px-2 py-3 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>a(h.id),"data-testid":"account"},h.id,e(O,{alignItems:"center",space:2},void 0,e(Se,{src:h.avatar,size:40}),e(T,{alignItems:"start"},void 0,e("div",{className:"flex grow items-center space-x-1"},void 0,e(E,{weight:"bold",size:"sm",truncate:!0},void 0,h.display_name),h.verified&&e(dt,{})),e(E,{size:"sm",weight:"medium",theme:"muted",truncate:!0},void 0,"@",h.acct)))),[]);return e("div",{className:"relative grow"},void 0,e(Le,{data:n,itemContent:(y,h)=>e("div",{className:"px-2"},void 0,v(y,h)),endReached:p,atTopStateChange:y=>d(y),atBottomStateChange:y=>c(y)}),M.createElement(M.Fragment,null,e("div",{className:S("pointer-events-none absolute inset-x-0 top-0 flex justify-center rounded-t-lg bg-gradient-to-b from-white to-transparent pb-12 pt-8 transition-opacity duration-500 dark:from-gray-900",{"opacity-0":f,"opacity-100":!f})}),e("div",{className:S("pointer-events-none absolute inset-x-0 bottom-0 flex justify-center rounded-b-lg bg-gradient-to-t from-white to-transparent pb-8 pt-12 transition-opacity duration-500 dark:from-gray-900",{"opacity-0":g,"opacity-100":!g})})))},is=J({placeholder:{id:"chat_search.placeholder",defaultMessage:"Type a name"}}),vs=s=>{const t=Q(),{isMainPage:a=!1}=s,n=ka,o=Pe(),{changeScreen:r}=Re(),{getOrCreateChatByAccountId:u}=ut(),[g,c]=l.useState(""),f=n(g,300),d=ss(f),{data:p,isFetching:v}=d,y=f&&f.length>0,h=(p||[]).length>0,w=st(i=>u(i),{onError:i=>{var F;const _=(F=i.response)==null?void 0:F.data;ct.error(_==null?void 0:_.error)},onSuccess:i=>{a?o.push(`/chats/${i.data.id}`):r(ha.CHAT,i.data.id),nt.invalidateQueries(ot.chatSearch())}}),b=()=>h?e(rs,{accountSearchResult:d,onSelect:i=>{w.mutate(i),x()}}):y&&!h&&!v?e(os,{}):e(ns,{}),x=()=>{y&&c("")};return e(T,{space:4,className:"h-full grow"},void 0,e("div",{className:"px-4"},void 0,e(mt,{"data-testid":"search",type:"text",autoFocus:!0,placeholder:t.formatMessage(is.placeholder),value:g||"",onChange:i=>c(i.target.value),outerClassName:"mt-0",theme:"search",append:e("button",{onClick:x},void 0,e(Z,{src:y?Ae:gt,className:"h-4 w-4 text-gray-700 dark:text-gray-600","aria-hidden":"true"}))})),e(T,{className:"grow"},void 0,b()))},ke=()=>e("div",{className:"flex w-full animate-pulse flex-col px-4 py-2"},void 0,e(O,{alignItems:"center",space:2},void 0,e(tt,{size:40}),e(T,{alignItems:"start"},void 0,e(pa,{minLength:3,maxLength:15})))),de=J({blockedYou:{id:"chat_list_item.blocked_you",defaultMessage:"This user has blocked you"},blocking:{id:"chat_list_item.blocking",defaultMessage:"You have blocked this user"},leaveMessage:{id:"chat_settings.leave.message",defaultMessage:"Are you sure you want to leave this chat? Messages will be deleted for you and this chat will be removed from your inbox."},leaveHeading:{id:"chat_settings.leave.heading",defaultMessage:"Leave Chat"},leaveConfirm:{id:"chat_settings.leave.confirm",defaultMessage:"Leave Chat"},leaveChat:{id:"chat_settings.options.leave_chat",defaultMessage:"Leave Chat"}}),ls=s=>{var y,h,w,b,x;let{chat:t,onClick:a}=s;const n=le(),o=Q(),r=Ie(),u=Pe(),{isUsingMainChatPage:g}=Re(),{deleteChat:c}=Ce(t==null?void 0:t.id),f=ee(i=>i.getIn(["relationships",t.account.id,"blocked_by"])),d=ee(i=>{var _;return i.getIn(["relationships",(_=t==null?void 0:t.account)==null?void 0:_.id,"blocking"])}),p=l.useMemo(()=>[{text:o.formatMessage(de.leaveChat),action:i=>{i.stopPropagation(),n(xe("CONFIRM",{heading:o.formatMessage(de.leaveHeading),message:o.formatMessage(de.leaveMessage),confirm:o.formatMessage(de.leaveConfirm),confirmationTheme:"primary",onConfirm:()=>{c.mutate(void 0,{onSuccess(){g&&u.push("/chats")}})}}))},icon:va}],[]);return e("div",{role:"button",onClick:()=>a(t),onKeyDown:i=>{(i.key==="Enter"||i.key===" ")&&a(t)},className:"group flex w-full flex-col rounded-lg px-2 py-3 hover:bg-gray-100 focus:shadow-inset-ring dark:hover:bg-gray-800","data-testid":"chat-list-item",tabIndex:0},t.id,e(O,{alignItems:"center",justifyContent:"between",space:2,className:"w-full"},void 0,e(O,{alignItems:"center",space:2,className:"overflow-hidden"},void 0,e(Se,{src:(y=t.account)==null?void 0:y.avatar,size:40,className:"flex-none"}),e(T,{alignItems:"start",className:"overflow-hidden"},void 0,e("div",{className:"flex w-full grow items-center space-x-1"},void 0,e(E,{weight:"bold",size:"sm",align:"left",truncate:!0},void 0,((h=t.account)==null?void 0:h.display_name)||`@${t.account.username}`),((w=t.account)==null?void 0:w.verified)&&e(dt,{})),f||d?e(E,{align:"left",size:"sm",weight:"medium",theme:"muted",truncate:!0,className:"pointer-events-none h-5 w-full italic","data-testid":"chat-last-message"},void 0,o.formatMessage(f?de.blockedYou:de.blocking)):M.createElement(M.Fragment,null,((b=t.last_message)==null?void 0:b.content)&&e(E,{align:"left",size:"sm",weight:"medium",theme:t.last_message.unread?"default":"muted",truncate:!0,className:"truncate-child pointer-events-none h-5 w-full","data-testid":"chat-last-message",dangerouslySetInnerHTML:{__html:(x=t.last_message)==null?void 0:x.content}})))),e(O,{alignItems:"center",space:2},void 0,r.chatsDelete&&e("div",{className:"hidden text-gray-600 hover:text-gray-100 group-hover:block"},void 0,e(rt,{items:p},void 0,e(et,{src:it,title:"Settings",className:"text-gray-600 hover:text-gray-700 dark:text-gray-600 dark:hover:text-gray-500",iconClassName:"h-4 w-4"}))),t.last_message&&M.createElement(M.Fragment,null,t.last_message.unread&&e("div",{className:"h-2 w-2 rounded-full bg-secondary-500","data-testid":"chat-unread-indicator"}),e(ba,{timestamp:t.last_message.created_at,align:"right",size:"xs",theme:t.last_message.unread?"default":"muted",truncate:!0})))))},bs=s=>{let{onClickChat:t,useWindowScroll:a=!1,searchValue:n}=s;const o=le(),r=l.useRef(null),{chatsQuery:{data:u,isFetching:g,hasNextPage:c,fetchNextPage:f}}=ut(n),[d,p]=l.useState(!1),[v,y]=l.useState(!0),h=()=>{c&&!g&&f()},w=()=>o(ya()),b=()=>g?e(T,{space:2},void 0,e(ke,{}),e(ke,{}),e(ke,{})):null;return e("div",{className:"relative h-full"},void 0,e(wa,{onRefresh:w},void 0,M.createElement(Le,{ref:r,atTopStateChange:x=>y(x),atBottomStateChange:x=>p(x),useWindowScroll:a,data:u,endReached:h,itemContent:(x,i)=>e("div",{className:"px-2"},void 0,e(ls,{chat:i,onClick:t})),components:{ScrollSeekPlaceholder:()=>e(ke,{}),Footer:()=>c?e(lt,{withText:!1}):null,EmptyPlaceholder:b}})),M.createElement(M.Fragment,null,e("div",{className:S("pointer-events-none absolute inset-x-0 top-0 flex justify-center rounded-t-lg bg-gradient-to-b from-white to-transparent pb-12 pt-8 transition-opacity duration-500 dark:from-gray-900",{"opacity-0":v,"opacity-100":!v})}),e("div",{className:S("pointer-events-none absolute inset-x-0 bottom-0 flex justify-center rounded-b-lg bg-gradient-to-t from-white to-transparent pb-8 pt-12 transition-opacity duration-500 dark:from-gray-900",{"opacity-0":d,"opacity-100":!d})})))},cs=J({searchPlaceholder:{id:"chats.search_placeholder",defaultMessage:"Search inbox"}}),ys=s=>{let{value:t,onChange:a,onClear:n}=s;const o=Q();return e(mt,{"data-testid":"chat-search-input",type:"text",autoFocus:!0,placeholder:o.formatMessage(cs.searchPlaceholder),className:"rounded-full",value:t,onChange:a,outerClassName:"mt-0",theme:"search",append:e("button",{onClick:n},void 0,e(Z,{src:t.length?Ae:gt,className:"h-4 w-4 text-gray-700 dark:text-gray-600","aria-hidden":"true"}))})};export{ps as C,os as E,vs as a,ys as b,bs as c};
